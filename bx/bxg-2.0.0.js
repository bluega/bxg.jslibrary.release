"BXG.LICENSE.ID=0000_0000_0000";"Copyright â“’ 2009-2012 BLUEGA Inc. All rights reserved.";window.bxg={version:"unknown",packageType:"unknown",c:{},g:{},objectMgrs:[],levels:{},$7L:{},$6c:{},$9Y:{$6b:5000,$EF:20},$Hp:false};bxg.$E7=1;bxg.$E8=2;bxg.$HtL=4;bxg.$6a=function(c,b,a){return function(){return c.apply(b,a)}};bxg.init=function(g,d){if(bx.UX.$DF.debug){bxg.$6j=true;bxg.Trace.level(bxg.Trace.DEBUG)}if(bxg.world){bxg.Trace.log("BXG","warning","bxg.init() was already executed.","bxg.init")}if(!g){bxg.Trace.log("BXG","errorParameter","playground="+g,"bxg.init");return}d=d||{};if(d.renderer=="Acanvas"&&!d.onInit){bxg.Trace.log("BXG","error","In case of Acanvas, init() needs to be called asynchronously with options.onInit()","bxg.init")}if(g&&(""+g).indexOf("HTML")!=-1&&(""+g).indexOf("Element")!=-1){bxg.world=g;bxg.playGround=g;bxg.area=bx.HCL.getElementRect(g);if(bxg.$Hp){bxg.geo=bxg.area}}else{if(d.world){bxg.world=bx.UX.$52.tagVP.$TAG("div",{id:"bxg$SYS_world"},{position:"relative",left:d.world.x+"px",top:d.world.y+"px",width:d.world.w+"px",height:d.world.h+"px"})}else{bxg.world=bx.UX.$52.tagVP.$TAG("div",{id:"bxg$SYS_world"},{position:"relative",left:"0px",top:"0px",width:bx.UX.width+"px",height:bx.UX.height+"px"})}bxg.playGround=bxg.world.$TAG("div",{id:"bxg$SYS_playground"},{overflow:"hidden",position:"relative",left:g.x+"px",top:g.y+"px",width:g.w+"px",height:g.h+"px"});bxg.playGround.style.display="block";bxg.area={};bxg.area.x=g.x;bxg.area.y=g.y;bxg.area.w=g.w;bxg.area.h=g.h;if(bxg.$Hp){bxg.geo=bxg.area}}if(bx.HCL.DV.isAndroid()){function c(){window.scrollTo(0,0)}bx.Event.add(window,"scroll",c,false)}if(d.align&&d.align.x=="center"){if(bxg.area.w<bx.UX.width){bxg.area.x=Math.round((bx.UX.width-bxg.area.w)/2);bxg.playGround.style.left=bxg.area.x+"px"}}if(d.align&&d.align.y=="center"){if(bxg.area.h<bx.UX.height){bxg.area.y=Math.round((bx.UX.height-bxg.area.h)/2);bxg.playGround.style.top=bxg.area.y+"px"}}bxg.$C9=d.rootURI;if(d&&d.execEnv=="editor"){bxg.$B1=true}if(location.protocol=="file:"||location.protocol=="widget:"){bxg.$CA="local"}if(bx.Loader.$6d){bxg.$CA="bxg"}if(d&&d.execEnv){bxg.$CA=d.execEnv}bxg.imageLoader=new bxg.CImageLoader();bxg.images=bxg.imageLoader.$HO();bxg.game=new bxg.CGameLoop();bxg.$DL={};function a(i){if(!i){i=window.event}bx.Event.preventDefault(i);if(!bx.Event.isLeftButton(i)){return false}bxg.__worldArea=bxg.__worldArea||bx.HCL.getElementRect(bxg.world);if(i.type=="touchstart"||i.type=="mousedown"){bx.Event.mouseDrag(bxg.world,i,e,f)}if(i.type!="mouseup"||i.type!="touchend"||i.type!="touchcancel"){bxg.$DM(i)}}function e(){}function f(i,m,l,n,k,p,o,j,q){bxg.$DM(q)}function b(i){if(i.bx$Event){switch(i.bx$Event.action){case"onPause":case"onStop":if(bxg.game){bxg.game.$CB();bxg.$HtM(bx.UX.EVENT_HIDDEN)}break;case"onResume":if(bxg.game){bxg.game.$CC();if(bxg.$E9&&bxg.$E9._Iupdated){bxg.$E9._Iupdated()}bxg.$HtM(bx.UX.EVENT_VISIBLE)}break}}}if(bx.HCL.DV.hasTouchEvent()){bx.UX.$52.tag.ontouchstart=function(){};bx.Event.add(bxg.world,"touchstart",a,false);bx.Event.add(bxg.world,"touchend",a,false);bx.Event.add(bxg.world,"touchcancel",a,false);bx.Event.add(bxg.world,"touchmove",a,false)}else{bx.Event.add(bxg.world,"mousedown",a,false);bx.Event.add(bxg.world,"mouseup",a,false);bx.Event.add(bxg.world,"mousemove",a,false)}bx.Event.add(document,"bx_activity_state",b,true);function h(i){bxg.$HtM(i)}bx.UX.setEventListener(h);bxg.buffer=document.body.$TAG("div",{id:"bxg$SYS_buffer"},{display:"none"});bxg.TransitionTag=new bx.CTransition();bxg.ObjectFactory.$7C();if(d.renderer=="canvas"){bxg.$9I=bxg.$E8}else{if(d.renderer=="Acanvas"){bxg.$9I=bxg.$HtL}else{if(d.renderer=="DOMcanvas"){bxg.$9I=bxg.$E8|bxg.$E7}else{if(d.renderer!="DOM"){bxg.Trace.log("BXG","errorParameter","Invalid options.renderer="+d.renderer,"bxg.init")}bxg.$9I=bxg.$E7}}}if(bxg.$9I&bxg.$E8){if(!bx.HCL.DV.supportCanvas()){bxg.$9I=bxg.$E7;bxg.Trace.log("BXG","debug","Rendering mode changed to 'tag' mode, because WebCore doesn't support HTMLCanvas.","bxg.init")}}if(bxg.$9I&bxg.$E7){if(!bxg.$HtN){bxg.Trace.log("BXG","unknownClass","DOM Renderer","bxg.init")}bxg.$E9=new bxg.$HtN()}else{if(bxg.$9I&bxg.$HtL){if(!bxg.$HtO){bxg.Trace.log("BXG","unknownClass","Acanvas Renderer","bxg.init")}bxg.$E9=new bxg.$HtO();document.body.style.backgroundColor="transparent";bxg.world.style.backgroundColor="transparent";bxg.playGround.style.backgroundColor="transparent"}else{if(!bxg.$HtP){bxg.Trace.log("BXG","unknownClass","Canvas Renderer","bxg.init")}bxg.$E9=new bxg.$HtP()}}if(bxg.$E9){bxg.$E9.$EC({$8p:bxg.playGround,$GF:bxg.area},d.onInit)}};bxg.load=function(a){if(window.onBxInit){bx.Loader.load({UXoptions:a})}else{if(!bxg.onGame){bxg.Trace.log("BXG","error","bxg.onGame() should be implemented to run game.","bxg.load")}else{function b(){bx.UX.init(a)}if(bxg.packageType=="unknown"){if(bxg.CTileMap){bxg.packageType="full"}else{bxg.packageType="core"}}bx.Loader.load({onInit:b,onRun:bxg.onGame})}}};bxg.EVENT_NONE=0;bxg.EVENT_POINTER_START=1;bxg.EVENT_POINTER_MOVE=2;bxg.EVENT_POINTER_END=4;bxg.EVENT_SCREEN_SHOW=8;bxg.EVENT_SCREEN_HIDE=16;bxg.$HtM=function(a){if(bxg.game&&(bxg.game.$66==1||bxg.game.$66==2)){for(bxg.$HtM.$BY=0;bxg.$HtM.$BY<bxg.game.$6e.length;bxg.$HtM.$BY++){if(!bxg.game.$6e[bxg.$HtM.$BY].$79||!bxg.game.$6e[bxg.$HtM.$BY].$79.onSysEvent){continue}if(a==bx.UX.EVENT_HIDDEN||a==bx.UX.EVENT_VISIBLE){var b={};if(a==bx.UX.EVENT_HIDDEN){b.type=bxg.EVENT_SCREEN_HIDE}else{if(a==bx.UX.EVENT_VISIBLE){b.type=bxg.EVENT_SCREEN_SHOW}}bxg.game.$6e[bxg.$HtM.$BY].$79.onSysEvent(bxg.game.$6e[bxg.$HtM.$BY],b)}}}};bxg.$DM=function(a){bxg.$DM.$DN=0;if(bxg.game&&(bxg.game.$66==1||bxg.game.$66==2)){for(bxg.$DM.$BY=0;bxg.$DM.$BY<bxg.game.$6e.length;bxg.$DM.$BY++){if(!bxg.game.$6e[bxg.$DM.$BY].$79||!bxg.game.$6e[bxg.$DM.$BY].$79.onSysEvent){continue}if(bxg.game.$6e[bxg.$DM.$BY].$79.onSysEvent.listenEvents===undefined){bxg.game.$6e[bxg.$DM.$BY].$79.onSysEvent.listenEvents=bxg.EVENT_POINTER_START|bxg.EVENT_POINTER_MOVE|bxg.EVENT_POINTER_END}if(!bxg.$DM.$DN){bxg.$DM.$DN=1;switch(a.type){case"touchstart":bxg.$DM.$DN=2;case"mousedown":bxg.$DL.type=bxg.EVENT_POINTER_START;break;case"touchmove":bxg.$DM.$DN=2;case"mousemove":bxg.$DL.type=bxg.EVENT_POINTER_MOVE;break;case"touchend":case"touchcancel":bxg.$DM.$DN=2;case"mouseup":bxg.$DL.type=bxg.EVENT_POINTER_END;break;default:return}if(bxg.$DM.$DN==2){if(a.targetTouches.length){bxg.$DL.scrX=a.targetTouches[0].clientX-bx.HCL.$0C(bxg.world);bxg.$DL.scrY=a.targetTouches[0].clientY-bx.HCL.$0D(bxg.world)}}else{bxg.$DL.scrX=a.clientX-bx.HCL.$0C(bxg.world);bxg.$DL.scrY=a.clientY-bx.HCL.$0D(bxg.world)}bxg.$DL.scrX+=bx.HCL.getScrollX();bxg.$DL.scrY+=bx.HCL.getScrollY();bxg.$DL.gameX=bxg.$DL.scrX-bxg.area.x;bxg.$DL.gameY=bxg.$DL.scrY-bxg.area.y;bxg.$DL.event=a}if((bxg.$DL.gameX>=0&&bxg.$DL.gameX<bxg.area.w)&&(bxg.$DL.gameY>=0&&bxg.$DL.gameY<bxg.area.h)){bxg.$DL.playGround=true}else{bxg.$DL.playGround=false}if(bxg.game.$6e[bxg.$DM.$BY].$79.onSysEvent.listenEvents&bxg.$DL.type){bxg.game.$6e[bxg.$DM.$BY].$79.onSysEvent(bxg.game.$6e[bxg.$DM.$BY],bxg.$DL)}}}};bxg.resize=function(a,b){if(!bxg.playGround){return}if(b){bxg.world.$CSS({left:b.x+"px",top:b.y+"px",width:b.w+"px",height:b.h+"px"})}bxg.playGround.$CSS({left:a.x+"px",top:a.y+"px",width:a.w+"px",height:a.h+"px"});bxg.area.x=a.x;bxg.area.y=a.y;bxg.area.w=a.w;bxg.area.h=a.h};bxg.shake=function(c,d,e,b){if(!bxg.game){return}if(!c||!d||!e){return}if(bxg.$7N){return}function a(){if(c<0){bxg.playGround.style.left=bxg.area.x+"px";bxg.playGround.style.top=bxg.area.y+"px";bxg.game.clearTimer(bxg.$7N);bxg.$7N=null}else{if(!b||b=="d"||b=="h"){bxg.playGround.style.left=(bxg.area.x+e*(c%2==0?-1:1))+"px"}if(!b||b=="d"||b=="v"){bxg.playGround.style.top=(bxg.area.y+e*(c%2==0?-1:1))+"px"}c--}}bxg.$7N=bxg.game.setTimer({callback:a,time:d})};bxg.random=function(a){if(a){bxg.random.$ED=a+12378757||12378757}bxg.random.$ED=parseInt(bxg.random.$ED*bxg.random.$ED/100)%100000;return bxg.random.$ED/100001};bxg.random.$ED=12378757;bxg.getZindexTop=function(a){if(a!==undefined){return(a+1)*bxg.$9Y.$6b*bxg.$9Y.$EF}else{if(bxg.game){a=0;for(var b=0;b<bxg.game.$6e.length;b++){if(a<bx.$checkNaN(bxg.game.$6e[b].$DF.zIndex)){a=bx.$checkNaN(bxg.game.$6e[b].$DF.zIndex)}}return a+bxg.$9Y.$6b*bxg.$9Y.$EF}else{return 0}}};bxg.getInspectCanvas=function(){if(bxg.$E9){return bxg.$E9.$HtQ()}};bxg.CImageLoader=function(b,a){if(bx.inClassing){return}this.$7O=b||{};this.$6V=a;this.$6W=0;this.$9L=0;this.$6X=0};bxg.CImageLoader.prototype.$HO=function(){return this.$7O};bxg.CImageLoader.prototype.$_getImageElement=function(a){if(this.$7O[a]){return this.$7O[a].$9M}else{return null}};bxg.CImageLoader.prototype.load=function(e,j,k){function b(m,p,n){var o;var i="000000000000000000000000000000000000000000000000000000";var l=m;if((o=m.indexOf("$$"))!=-1){if(n>1){p=i.substring(0,n-(""+p).length)+p}l=m.substring(0,o)+p+m.substring(o+2)}return l}var f;if(e){this.$6X=0}else{e=this.$7O;j=this.$6V}for(var a in e){var d;if(e[a].count){var c;for(var d=0;d<e[a].count;d++){c=d+bx.$checkNaN(e[a].start);e[a+c]={url:b(e[a].url,c,bx.$checkNaN(e[a].zero)),opacity:e[a].opacity};if(e[a].type){e[a+c].type=e[a].type}}delete e[a]}else{if(e[a].sprite){var h=0,g=0;for(var d=0;d<e[a].sprite.count;d++){g=e[a].sprite.size.h*Math.floor(d/e[a].sprite.cols);h=e[a].sprite.size.w*(d%e[a].sprite.cols);e[a+(d+1)]={url:e[a].url,size:{w:e[a].sprite.size.w,h:e[a].sprite.size.h},position:{x:-h,y:-g},opacity:e[a].opacity};if(e[a].type){e[a+(d+1)].type=e[a].type}}delete e[a]}}}for(var a in e){this.$6X++}if(this.$6X==0){if(j){j(0,0)}return true}this.$6W=0;this.$9L=0;for(a in e){if((bxg.$9I&bxg.$HtL)&&!e[a].type){this._Acanvas_load(e,a,j,k)}else{this.$HtR(e,a,j,k)}}return true};bxg.CImageLoader.prototype.$HtR=function(f,e,a,c){var d=this;var b=new Image();b.$HtS=e;b.onload=bxg.$6a(function(h,i,g){this.$60(h,i,g,c)},this,[b,e,a]);b.onerror=function(){d.$9L++;if((d.$6W+d.$9L)==d.$6X){if(a){a(d.$6W,d.$9L)}}bxg.Trace.log("BXG","errorImage",this.$HtS+" url="+this.src,"CImageLoader.load")};this.$7O[e]=f[e];b.src=f[e].url};bxg.CImageLoader.prototype.$60=function(a,d,b,c){this.$7O[d].$AZ=d;this.$7O[d].$9M=a;this.$7O[d].w=a.width;this.$7O[d].h=a.height;this.$6W++;if(this.$7O[d].size&&this.$7O[d].position){if(((this.$7O[d].size.w-this.$7O[d].position.x)>a.width)||((this.$7O[d].size.h-this.$7O[d].position.y)>a.height)){bxg.Trace.log("BXG","errorImage",this.$7O[d].$HtS+" sprite.size overflows real image file. url="+a.src,"CImageLoader.load");this.$6W--;this.$9L++}}if(c){c(this.$6W,this.$6X)}if((this.$6W+this.$9L)==this.$6X){if(b){b(this.$6W,this.$9L)}}};bxg.CImageLoader.prototype.unload=function(f,d){if(!f||!(typeof f=="string"||f instanceof Array)){bxg.Trace.log("BXG","errorParameter","id="+f,"CImageLoader.unload");return false}var c;var b=[];if(f instanceof Array){b=f}else{if(d&&d.count>0){d.start=d.start||0;for(c=0;c<d.count;c++){b.push(f+(c+bx.$checkNaN(d.start)))}}else{b.push(f)}}var e=[];var a=[];for(c=0;c<b.length;c++){if(this.$7O[b[c]]){e.push(b[c]);if((bxg.$9I&bxg.$HtL)&&!this.$7O[b[c]].type){this._Acanvas_unload(this.$7O[b[c]])}else{delete this.$7O[b[c]].$9M;delete this.$7O[b[c]]}}else{a.push(b[c])}}if(a.length>0){bxg.Trace.log("BXG","warning","Unload failed, count="+a.length,"CImageLoader.unload");return false}else{return true}};bxg.CImageLoader.Acanvas_onLoad=function(d,b,a,c){if(b>=0){bxg.imageLoader.$60({id:b,width:a,height:c},d,bxg.imageLoader.$HtT,bxg.imageLoader.$HtU)}else{bxg.imageLoader.$9L++;if((bxg.imageLoader.$6W+bxg.imageLoader.$9L)==bxg.imageLoader.$6X){if(bxg.imageLoader.$HtT){bxg.imageLoader.$HtT(bxg.imageLoader.$6W,bxg.imageLoader.$9L)}}}};bxg.CImageLoader.prototype._Acanvas_load=function(d,c,a,b){this.$HtT=a;this.$HtU=b;this.$7O[c]=d[c];bxg.Acanvas.loadImage(c,d[c].url,"bxg.CImageLoader.Acanvas_onLoad")};bxg.CImageLoader.prototype._Acanvas_unload=function(a){bxg.Acanvas.unloadImage(a.id)};bxg.CGameLoop=function(a){if(bx.inClassing){return}if(!bxg.playGround){bxg.Trace.log("BXG","error","new bxg.CGameLoop() is called prior to initializing bxg.init().","bxg.CGameLoop");return}if(bxg.game){bxg.Trace.log("BXG","warning","CGameLoop was created in bxg.init(). So don't creat CGameLoop on outside BXG.","CGameLoop()");if(a.tick){bxg.game.setTickInterval(a.tick)}return}this.$DF=a||{tick:100};this.tickInterval=this.$DF.tick;this.$6e=[];this.$63=[];this.$64=null;this.$9J=0;this.$66;this.$6R=[];this.$6f=[];return this};bxg.CGameLoop.prototype.init=function(a){if(a&&a.tick){this.tickInterval=a.tick}this.$CC();this.$9J=0;this.$66=0;return this};bxg.CGameLoop.prototype.$6k=function(a){this.$6f.push(a)};bxg.CGameLoop.prototype.$CC=function(){var c=this;var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;if(!this.$64){if(b){function a(d){if(c.$6h.$5J){if(d-c.$6h.$5J>=c.tickInterval*0.8){c.$6h.$5J=d;c.$78()}}else{c.$6h.$5J=d;c.$78()}b(a)}this.$6h=this.$6h||{};b(a)}else{this.$64=setInterval(function(){c.$78()},c.tickInterval)}}};bxg.CGameLoop.prototype.$CB=function(){if(this.$64){if(this.$6h){this.$6h.$5J=0}else{clearInterval(this.$64)}delete this.$64}};bxg.CGameLoop.prototype.setTickInterval=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","time="+a,"CGameLoop.setTickInterval");return}this.$CB();this.tickInterval=a;this.$CC()};bxg.CGameLoop.prototype.run=function(){if(this.$66===undefined){bxg.Trace.log("BXG","error","bxg.game.run() is called prior to initializing bxg.game.","CGameLoop.run");return}if(bxg.game.$6l){bxg.game.$6k({$6s:bxg.CGameLoop.prototype.run,$6o:this});return}if(this.$66==1||this.$66==2){this.end()}for(var a=0;a<this.$6e.length;a++){this.$6e[a].$7A(this.$9J)}this.$66=1;this.$78();if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Game started and CControl reset.","CGameLoop.run")}if(bxg.Inspector.$DV){bxg.Inspector.$DW()}};bxg.CGameLoop.prototype.pause=function(){this.$66=2;if(bxg.Inspector.$DV){bxg.Inspector.$DX()}};bxg.CGameLoop.prototype.resume=function(){if(this.$66==2){this.$66=1}if(bxg.Inspector.$DV){bxg.Inspector.$DW()}};bxg.CGameLoop.prototype.end=function(){if(bxg.game.$6l){bxg.game.$6k({$6s:bxg.CGameLoop.prototype.end,$6o:this});return}this.pause();this.$66=3;for(var a=0;a<this.$6e.length;a++){this.$6e[a].$CQ(this.$9J)}if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Game ended.","CGameLoop.end")}if(bxg.Inspector.$DV){bxg.Inspector.$DX()}};bxg.CGameLoop.prototype.addControl=function(b,a){if(!b||!(b instanceof bxg.CControl)){bxg.Trace.log("BXG","errorParameter","cntrl is not CControl or null","CGameLoop.addControl");return this}if(this.$66==1||this.$66==2){bxg.Trace.log("BXG","error","bxg.game.addControl() is called when bxg.game is in running state.","CGameLoop.addControl");return}if(a){this.removeAllControl()}this.$6e.push(b);function c(e,d){return e.$DF.zIndex-d.$DF.zIndex}this.$6e.sort(c);b.$HW(this);return this};bxg.CGameLoop.prototype.removeControl=function(b){if(!b||!(b instanceof bxg.CControl)){bxg.Trace.log("BXG","errorParameter","cntrl is not CControl or null","CGameLoop.removeControl");return}if(this.$66==1||this.$66==2){bxg.Trace.log("BXG","error","bxg.game.removeControl() is called when bxg.game is in running state.","CGameLoop.removeControl");return}for(var a=0;a<this.$6e.length;a++){if(this.$6e[a]==b){this.$6e[a].$HX();this.$6e.splice(a,1);break}}};bxg.CGameLoop.prototype.removeAllControl=function(){if(this.$66!==undefined&&(this.$66==1||this.$66==2)){bxg.Trace.log("BXG","error","bxg.game.removeAllControl() is called when bxg.game is in running state.","CGameLoop.removeAllControl");return}for(var a=0;a<this.$6e.length;a++){this.$6e[a].$HX()}this.$6e.length=0};bxg.CGameLoop.prototype.getControl=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","CControl name="+a,"CGameLoop.getControl");return null}for(var b=0;b<this.$6e.length;b++){if(this.$6e[b].name&&this.$6e[b].name==a){return this.$6e[b]}}return null};bxg.CGameLoop.prototype.addInputDevice=function(a){if(!a||!(a instanceof bxg.CInputDevice)){bxg.Trace.log("BXG","errorParameter","device="+a,"CGameLoop.addInputDevice");return}if(this.$66==1||this.$66==2){bxg.Trace.log("BXG","error","Cannot call this function when bxg.game is in running state.","CGameLoop.addInputDevice");return}this.$63.push(a)};bxg.CGameLoop.prototype.getTick=function(){return this.$9J};bxg.CGameLoop.prototype.$78=function(){if(this.$6l){return}if(!this.$6e.length){return}if(this.$66!=1){return}this.$6l=true;if(bxg.Inspector.$DV){bxg.Inspector.$E1.LP.msORs=new Date().getTime()}for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){for(this.$9t in this.$6e[this.$9s].$68){this.$6i=this.$6e[this.$9s].$68[this.$9t];if(this.$6i.$6D!=this.$6i.$HtV){this.$6i.$HtV=this.$6i.$6D}if(this.$6i.active&&!this.$6i.$EL){this.$6i.$EL=true}if(this.$6i.$EL&&!this.$6i.$CE){this.$6i.tick(this.$9J)}}}}for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){for(this.$9t in this.$6e[this.$9s].$67){this.$6i=this.$6e[this.$9s].$67[this.$9t];if(this.$6i.$EL){if(this.$6i.$7P){this.$6i.render()}}}}}if(bxg.$E9&&bxg.$E9.$EG){bxg.$E9.$EG()}for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){if(!(bxg.$E9.$D9&bxg.$GI)){if(this.$6e[this.$9s].$EM.$EK){this.$6e[this.$9s].$EM.$EK()}}}}if(bxg.$E9&&bxg.$E9.$EQ){bxg.$E9.$EQ()}if(bxg.Inspector.$DV){bxg.Inspector.$E1.LP.msOR=new Date().getTime()-bxg.Inspector.$E1.LP.msORs}if(bxg.Inspector.$DV){bxg.Inspector.$E1.LP.msICCs=new Date().getTime()}for(this.$9t=0;this.$9t<this.$63.length;this.$9t++){this.$ER=this.$63[this.$9t].$6M(this.$9J);if(this.$ER){for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){if(this.$6e[this.$9s].$79&&this.$6e[this.$9s].$79.onInputEvent){this.$6e[this.$9s].$79.onInputEvent(this.$6e[this.$9s],this.$ER)}if(bxg.$Hp){for(this.$9u in this.$6e[this.$9s].$69){if(this.$6e[this.$9s].$69[this.$9u].$EL&&!this.$6e[this.$9s].$69[this.$9u].$CE){this.$6e[this.$9s].$69[this.$9u].$79.onInputEvent(this.$6e[this.$9s].$69[this.$9u],this.$ER)}}}}}this.$63[this.$9t].$6N()}}for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){for(this.$9u in this.$6e[this.$9s].$6B){this.$6e[this.$9s].$6B[this.$9u].$7E()}}}for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){for(this.$9t in this.$6e[this.$9s].$6A){if(this.$6e[this.$9s].$6A[this.$9t].$EL&&!this.$6e[this.$9s].$6A[this.$9t].$CE&&this.$6e[this.$9s].$6A[this.$9t].$HtV){this.$6e[this.$9s].$6A[this.$9t].$9K()}}}}for(this.$9s=0;this.$9s<this.$6e.length;this.$9s++){if(this.$6e[this.$9s].$HY==bxg.CControl.RUNSTATE.RUNNING){this.$6e[this.$9s].$7D()}}if(bxg.Inspector.$DV){bxg.Inspector.$E1.LP.msICC=new Date().getTime()-bxg.Inspector.$E1.LP.msICCs}this.$9J++;if(this.$DO){this.$H0()}if(bxg.TransitionTag.count){bxg.TransitionTag.run()}this.$6l=false;if(this.$6f.length){while(this.$6n=this.$6f.shift()){this.$6n.$6s.call(this.$6n.$6o,this.$6n.$Hq)}}};bxg.CGameLoop.prototype.setTimer=function(c){if(!c||!c.time||!c.callback){bxg.Trace.log("BXG","errorParameter","event="+c,"CGameLoop.setTimer");bxg.Trace.data(c);return 0}var b=false;this.$6S=this.$6S||1;c.id=this.$6S++;c.after=(new Date()).getTime()+c.time;for(var a=0;a<this.$6R.length;a++){if(this.$6R[a].id==-1){this.$6R[a].id=c.id;this.$6R[a].time=c.time;this.$6R[a].after=c.after;this.$6R[a].callback=c.callback;this.$6R[a].once=c.once;b=true;break}}if(!b){this.$6R.push(c)}if(!this.$DO){this.$DO=1}else{this.$DO++}return c.id};bxg.CGameLoop.prototype.setTimeout=function(a,b){return this.setTimer({callback:a,time:b,once:true})};bxg.CGameLoop.prototype.setInterval=function(a,b){return this.setTimer({callback:a,time:b})};bxg.CGameLoop.prototype.clearTimer=function(b){for(var a=0;a<this.$6R.length;a++){if(this.$6R[a].id==b){this.$6R[a].id=-1;this.$DO--;break}}};bxg.CGameLoop.prototype.clearTimeout=function(a){this.clearTimer(a)};bxg.CGameLoop.prototype.clearInterval=bxg.CGameLoop.prototype.clearTimeout;bxg.CGameLoop.prototype.$H0=function(){if(!this.$DO){return}bxg.CGameLoop.prototype.$H0.$DP=(new Date()).getTime();for(bxg.CGameLoop.prototype.$H0.$9S=0;bxg.CGameLoop.prototype.$H0.$9S<this.$6R.length;bxg.CGameLoop.prototype.$H0.$9S++){if(this.$6R[bxg.CGameLoop.prototype.$H0.$9S].id>0&&bxg.CGameLoop.prototype.$H0.$DP>this.$6R[bxg.CGameLoop.prototype.$H0.$9S].after){this.$6R[bxg.CGameLoop.prototype.$H0.$9S].callback(this.$6R[bxg.CGameLoop.prototype.$H0.$9S].id);this.$6R[bxg.CGameLoop.prototype.$H0.$9S].after=bxg.CGameLoop.prototype.$H0.$DP+this.$6R[bxg.CGameLoop.prototype.$H0.$9S].time;if(this.$6R[bxg.CGameLoop.prototype.$H0.$9S].once){this.clearTimer(this.$6R[bxg.CGameLoop.prototype.$H0.$9S].id)}}}};bxg.CGameLoop.prototype.adjustByTick=function(b,c,a){if(!this.tickInterval){bxg.Trace.log("BXG","noGameLoop","because tickInterval="+this.tickInterval,"CGameLoop.adjustByTick");return 0}if(!b||c===undefined){bxg.Trace.log("BXG","errorParameter","tick="+b+" value="+c,"CGameLoop.adjustByTick");return 0}if(a){return Math.ceil(this.tickInterval/b*c)}else{return this.tickInterval/b*c}};bxg.CGameLoop.prototype.tickAfter=function(a,b){if(!b){bxg.Trace.log("BXG","errorParameter","msec="+b,"CGameLoop.tickAfter");return 0}if(a===undefined||a===null){return this.$9J+Math.ceil(b/this.tickInterval)}else{return a+Math.ceil(b/this.tickInterval)}};bxg.CControl=function(c,b,a){if(bx.inClassing){return}if(!bxg.area){bxg.Trace.log("BXG","error","new bxg.CControl() is called prior to initializing bxg.init().","bxg.CControl");return this}this.name=a;this.$DF=b||{};if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){this.$DF.renderer=this.$DF.renderer||{};if(this.$DF.renderer.buffering!=false){this.$DF.renderer.buffering=true}}if(!this.$DF.zIndex){this.$DF.zIndex=0}else{this.$DF.zIndex*=(bxg.$9Y.$6b*bxg.$9Y.$EF)}this.$HM=null;this.level=null;if(bxg.$Hp){this.map=null}this.logic=null;this.$67={};this.$68={};this.$69={};this.$6A={};this.$6B={};this.$6p=[];this.$6q={};this.$79=c;this.area={x:bxg.area.x,y:bxg.area.y,w:bxg.area.w,h:bxg.area.h};this.$HY=bxg.CControl.RUNSTATE.STOP;this.scrollPos={x:0,y:0};this.scrollSize={w:this.area.w,h:this.area.h};this.$DF.$ET=this.$DF.$ET||{$D9:bxg.$EU,$GF:bx.$copyObject({},this.area)};this.$DF.$ET.$EX=this.$EY||bxg.playGround;this.$DF.$ET.$F6=this.$DF.zIndex;if(this.$DF.$ET.$6r===undefined){this.$DF.$ET.$6r=0}if(this.$DF.renderer&&this.$DF.renderer.buffering){this.$DF.$ET.$6r|=bxg.$6t}if(this.$DF.renderer&&this.$DF.renderer.saveMemory){this.$DF.$ET.$6r|=bxg.$6u}this.$DF.$ET.$Hr={w:bxg.area.w,h:bxg.area.h};this.$EM=new bxg.$E9.$EZ(this.$DF.$ET);this.data={};return this};bxg.CControl.CLASS_GAME_OBJECT=10;bxg.CControl.CLASS_GAME_IMAGE=20;bxg.CControl.prototype.create=function(){if(this.$7Q){return this}this.$EM.$F0(bxg.$E9);this.$7Q=true;return this};bxg.CControl.prototype.$HtW=function(a){if(!this.$7Q){if(!a){bxg.Trace.log("BXG","errorInvalidState","not created","CControl")}return false}if(this.$7Q){return true}};bxg.CControl.prototype.destroy=function(){if(this.$HM){this.$HM.removeControl(this)}for(var a in this.$67){this.remove(a)}for(a in this.$6q){this.remove(a)}if(this.level){this.level.destroy();if(bxg.$Hp){delete this.map}delete this.level}if(this.$EM){this.$EM.$F1();delete this.$EM}delete this.$67;delete this.$68;delete this.$69;delete this.$6A;delete this.$6B;this.$HM=null;delete this.logic;return null};bxg.CControl.prototype.$DQ=function(c,b,e,d,a){a.$DR=true;a.$8I=b+this.scrollPos.x;a.$8J=e+this.scrollPos.y;a.$8K=d+this.scrollPos.z};bxg.CControl.prototype.add=function(c,a){var b;if(!c){bxg.Trace.log("BXG","errorParameter","obj="+c,"CControl.add");return c}if(c instanceof bxg.CImage){b=bxg.CControl.CLASS_GAME_IMAGE}else{if(c instanceof bxg.CObject){b=bxg.CControl.CLASS_GAME_OBJECT}else{bxg.Trace.log("BXG","errorParameter","obj="+c,"CControl.add");return c}}if(b==bxg.CControl.CLASS_GAME_IMAGE){if(!this.$6q[c.id]){this.$6q[c.id]=c}else{bxg.Trace.log("BXG","warning","Same CImage is alreay in this CControl, type="+c.type,"CControl.add");return c}}else{if(!this.$67[c.id]){this.$67[c.id]=c;if(c.$CT){this.$68[c.id]=c}if(c.$6C){this.$6B[c.id]=c}if(c.$79&&c.$79.onInputEvent){this.$69[c.id]=c}if(c.$79&&(c.$79.onCollision||c.$79.onCollisionAnalysis)&&c.$6C){this.$6A[c.id]=c}}else{bxg.Trace.log("BXG","warning","Same CGameObject is alreay in this CControl, id="+c.id,"CControl.add");return c}}if(a!==undefined&&a!==true&&a!==false){a=undefined}c.$6v(this,a);if(c.$F3){if(this.$EM.$F5){this.$EM.$F5(c.$F3,c.$DF.baseLayer)}}else{if(c.tag){if(!c.$HtX){(this.$EY||bxg.playGround).appendChild(c.tag)}}}c.setZindex(undefined,true);if(b==bxg.CControl.CLASS_GAME_IMAGE){if(this.$HZ){if(c.$F3.$F4){c.$F3.$F4(true)}}}return c};bxg.CControl.prototype.remove=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","object="+a,"CControl.remove");return a}var c;if(typeof a=="string"){c=a}else{c=a.id}var b;if(this.$6q[c]){b=this.$6q[c];if(this.$EM.$F7){this.$EM.$F7(this.$6q[c].$F3)}delete this.$6q[c];b.$6w(this)}else{if(this.$67[c]){b=this.$67[c];if(b.active){b.deactivate()}if(this.$68[c]){delete this.$68[c]}if(this.$6B[c]){delete this.$6B[c]}if(this.$69[c]){delete this.$69[c]}if(this.$6A[c]){delete this.$6A[c]}if(b.$F3){if(this.$EM.$F7){this.$EM.$F7(b.$F3)}}else{if(b.tag){if(b.tag.parentNode){if(!b.$HtX){b.tag.parentNode.removeChild(b.tag)}}}}b.$6w(this);delete this.$67[c]}else{bxg.Trace.log("BXG","warning","Try to remove unregistered Game Object, type="+a.type,"CControl.remove")}}return a};bxg.CControl.prototype.removeAll=function(a){var b;var e;var c;var d=false;if(a&&a instanceof Array){d=true}for(e in this.$6q){c=this.$6q[e];if(d){a.push(c)}if(this.$EM.$F7){this.$EM.$F7(c.$F3)}delete this.$6q[e];c.$6w(this)}for(e in this.$67){c=this.$67[e];if(c.active){c.deactivate()}if(d){a.push(c)}if(c.$F3){if(this.$EM.$F7){this.$EM.$F7(c.$F3)}}else{if(c.tag){if(c.tag.parentNode){c.tag.parentNode.removeChild(c.tag)}}}c.$6w(this);delete this.$67[e]}this.$68={};this.$6B={};this.$69={};this.$6A={};if(d){return a}else{return null}};bxg.CControl.prototype.toControlScreenPosition=function(a,c,b){if(a===undefined||c===undefined){bxg.Trace.log("BXG","errorParameter","x="+a+" y="+c,"CControl.toControlScreenPosition");return{x:0,y:0}}b=b||{};b.x=a-this.scrollPos.x;b.y=c-this.scrollPos.y;return b};bxg.CControl.prototype.getZindexBase=function(){return this.$DF.zIndex};bxg.CControl.prototype.getZindexTop=function(){return this.$DF.zIndex+(bxg.$9Y.$6b-1)*bxg.$9Y.$EF};bxg.CControl.prototype.getRunState=function(){return this.$HY};bxg.CControl.prototype.$7D=function(){if(this.$79&&this.$79.onTick){this.$79.onTick(this,bxg.game.$9J)}};bxg.CControl.RUNSTATE={};bxg.CControl.RUNSTATE.STOP=0;bxg.CControl.RUNSTATE.RUNNING=1;bxg.CControl.RUNSTATE.PAUSE=2;bxg.CControl.prototype.$7A=function(a){if(this.$EM.$F8){this.$EM.$F8()}var b;for(b in this.$6q){if(this.$6q[b].$F3.$F4){this.$6q[b].$F3.$F4(true)}}this.$HZ=true;this.$HY=bxg.CControl.RUNSTATE.RUNNING;this.scrollReset();if(this.$79&&this.$79.onReset){this.$79.onReset(this,a)}};bxg.CControl.prototype.$CQ=function(a){var b;for(b in this.$67){if(this.$67[b].active){this.$67[b].deactivate()}}for(b in this.$6q){if(this.$6q[b].$F3.$F4){this.$6q[b].$F3.$F4(true)}}this.$HZ=false;this.$HY=bxg.CControl.RUNSTATE.STOP;if(this.$79&&this.$79.onEnd){this.$79.onEnd(this,a)}};bxg.CControl.prototype.pause=function(){if(this.$HY==bxg.CControl.RUNSTATE.RUNNING){this.$HY=bxg.CControl.RUNSTATE.PAUSE;return true}else{bxg.Trace.log("BXG","warning","not bxg.CControl.RUNSTATE.RUNNING. ignored.","bxg.CControl.pause()");return false}};bxg.CControl.prototype.resume=function(){if(this.$HY==bxg.CControl.RUNSTATE.PAUSE){this.$HY=bxg.CControl.RUNSTATE.RUNNING;return true}else{bxg.Trace.log("BXG","warning","not bxg.CControl.RUNSTATE.PAUSE. ignored.","bxg.CControl.resume()");return false}};bxg.CControl.prototype.$HW=function(a){this.$HM=a;if(this.$HZ){this.$HY=bxg.CControl.RUNSTATE.RUNNING}};bxg.CControl.prototype.$HX=function(){for(var a in this.$67){this.$67[a].deactivate()}for(var a in this.$6q){if(this.$6q[a].$F3.$F4){this.$6q[a].$F3.$F4(false)}}if(this.$EM.$F9){this.$EM.$F9()}this.$HZ=false;this.$HY=bxg.CControl.RUNSTATE.STOP};bxg.CControl.prototype.$CG=function(b){this.level=b;if(bxg.$Hp){this.map=b}var a;if(b&&(a=b.getSize())){this.setScrollSize(a.w,a.h)}};bxg.CControl.prototype.detectCollision=function(b,d,a){if(!bxg.CObject.$Ha(b)){bxg.Trace.log("BXG","errorParameter","geo="+b,"CControl.detectCollision");return null}if(a&&!(a instanceof Function||a instanceof Array)){bxg.Trace.log("BXG","errorParameter","multi="+a,"CControl.detectCollision");return null}if(a&&a instanceof Array){a.length=0}if(d){this.$FA=null}for(this.$FB in this.$6B){if(this.$6B[this.$FB].active&&this.$6B[this.$FB].$HtV){if(this.$6B[this.$FB].$7F(b)){if(a&&a instanceof Function){a(this.$6B[this.$FB])}else{if(!a&&!d){return this.$6B[this.$FB]}else{if(!a&&d){if(!this.$FA||this.$FA.$DF.zIndex<this.$6B[this.$FB].$DF.zIndex){this.$FA=this.$6B[this.$FB]}}else{if(a){a.push(this.$6B[this.$FB])}}}}}}}if(a&&a instanceof Array){if(d){function c(f,e){return e.$DF.zIndex-f.$DF.zIndex}a.sort(c)}return a}return this.$FA};bxg.CControl.SCROLL_UP=0;bxg.CControl.SCROLL_DOWN=4;bxg.CControl.SCROLL_LEFT=2;bxg.CControl.SCROLL_RIGHT=6;bxg.CControl.prototype.$CM=function(b,c,a){this.scrollPos.x=b;this.scrollPos.y=c;if(a){a.x=b;a.y=c}};bxg.CControl.prototype.scroll=function(c,b,a){if(b!==undefined){b=parseInt(b);if(isNaN(b)){bxg.Trace.log("BXG","errorNaN","dy="+b,"CControl.scroll");b=this.scrollPos.y}else{b=this.scrollPos.y+b}}else{b=this.scrollPos.y}if(c!==undefined){c=parseInt(c);if(isNaN(c)){bxg.Trace.log("BXG","errorNaN","dx="+c,"CControl.scroll");c=this.scrollPos.x}else{c=this.scrollPos.x+c}}else{c=this.scrollPos.x}this.$CM(c,b,a);if(this.level&&this.level.$Hs){this.level.$Hs()}};bxg.CControl.prototype.scrollReset=function(){this.$CM(0,0)};bxg.CControl.prototype.$CK=function(){return false};bxg.CControl.prototype.setScrollSize=function(a,b){if(a<this.area.w||b<this.area.h){bxg.Trace.log("BXG","error","Scroll area size is smaller than view screen size.","CControl.setScrollSize")}this.scrollSize.w=Math.max(this.area.w,a);this.scrollSize.h=Math.max(this.area.h,b)};bxg.CScrollControl=function(c,b,a){if(bx.inClassing){return}b=b||{};if(!b.size||typeof b.size!="object"){b.size={w:bxg.area.w,h:bxg.area.h}}else{if(bx.$checkNaN(parseInt(b.size.w))<bxg.area.w){b.size.w=bxg.area.w}if(bx.$checkNaN(parseInt(b.size.h))<bxg.area.h){b.size.h=bxg.area.h}if(bx.$checkNaN(parseInt(b.size.w))<=bxg.area.w&&bx.$checkNaN(parseInt(b.size.h))<=bxg.area.h){b.size={w:bxg.area.w,h:bxg.area.h}}}b.$ET=b.$ET||{$D9:bxg.$FI};b.$ET.$GF={x:0,y:0,w:b.size.w,h:b.size.h};bxg.CControl.call(this,c,b,a);this.scrollSize={w:this.$DF.size.w,h:this.$DF.size.h}};bx.$Inherit(bxg.CScrollControl,bxg.CControl);bxg.CScrollControl.prototype.$DQ=function(c,b,e,d,a){a.$DR=true;a.$8I=b;a.$8J=e;a.$8K=d};bxg.CScrollControl.prototype.$CM=function(b,c,a){if(a){a.x=0;a.y=0}if((c==0||c)&&this.scrollSize.h>=this.area.h){if(c>0){c=0}else{if(c<-(this.scrollSize.h-this.area.h)){c=-(this.scrollSize.h-this.area.h)}}if(a){a.y=c-this.scrollPos.y}this.scrollPos.y=c}if((b==0||b)&&this.scrollSize.w>=this.area.w){if(b>0){b=0}else{if(b<-(this.scrollSize.w-this.area.w)){b=-(this.scrollSize.w-this.area.w)}}if(a){a.x=b-this.scrollPos.x}this.scrollPos.x=b}if(b!==undefined||c!==undefined){this.$EM.$CM(b,c)}};bxg.CScrollControl.prototype.$CK=function(){return true};bxg.CScrollControl.prototype.setScrollSize=function(a,b){bxg.CControl.prototype.setScrollSize.call(this,a,b);this.$EM.$FJ({x:0,y:0,w:this.scrollSize.w,h:this.scrollSize.h})};bxg.CBufferedScrollControl=function(c,b,a){if(bx.inClassing){return}b=b||{};b.renderer=b.renderer||{};if(b.renderer.buffering!=false){b.renderer.buffering=true}if(bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL){b.$ET={$D9:bxg.$6x}}else{bxg.Trace.log("BXG","warning","CBufferedScrollControl is not supported on DOM-only rendering mode. Performance will drop with huge area map.","CBufferedScrollControl()");b.$ET={$D9:bxg.$FI}}bxg.CScrollControl.call(this,c,b,a)};bx.$Inherit(bxg.CBufferedScrollControl,bxg.CScrollControl);bxg.C2WayBufferedScrollControl=function(c,b,a){if(bx.inClassing){return}b=b||{};b.dir=b.dir||"horizontal";if(b.dir=="vertical"){this.$6y=true}else{if(b.dir=="horizontal"){this.$6y=false}else{bxg.Trace.log("BXG","errorParameter","Invalid options.dir="+b.dir,"bxg.C2WayBufferedScrollControl()")}}if(bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL){if(this.$6y){b.$ET={$D9:bxg.$6z}}else{b.$ET={$D9:bxg.$7a}}}else{bxg.Trace.log("BXG","warning","CBufferedScrollControl is not supported on DOM-only rendering mode. Performance will drop with huge area map.","bxg.C2WayBufferedScrollControl()");b.$ET={$D9:bxg.$FI}}b.size=b.size||{w:bxg.area.w,h:bxg.area.h};if(this.$6y){b.size.w=bxg.area.w}else{b.size.h=bxg.area.h}bxg.CScrollControl.call(this,c,b,a)};bx.$Inherit(bxg.C2WayBufferedScrollControl,bxg.CScrollControl);bxg.C1WayBufferedScrollControl=function(c,b,a){if(bx.inClassing){return}b=b||{};b.renderer=b.renderer||{};if(b.renderer.buffering!=false){b.renderer.buffering=true}b.dir=b.dir||"down";b.size=parseInt(b.size);if(isNaN(b.size)||b.size<=0){bxg.Trace.log("BXG","warning","'size' is supposed to be a valid positive number, options.size="+b.size,"C1WayBufferedScrollControl()");b.size=0}if(b.dir=="up"){b.dir=bxg.CControl.SCROLL_UP;if(b.size<=bxg.area.h){b.size=bxg.area.h}b.$ET={$D9:bxg.$7b,$GF:{x:0,y:0,w:bxg.area.w,h:b.size}}}else{if(b.dir=="left"){b.dir=bxg.CControl.SCROLL_LEFT;if(b.size<=bxg.area.w){b.size=bxg.area.w}b.$ET={$D9:bxg.$7c,$GF:{x:0,y:0,w:b.size,h:bxg.area.h}}}else{if(b.dir=="right"){b.dir=bxg.CControl.SCROLL_RIGHT;if(b.size<=bxg.area.w){b.size=bxg.area.w}b.$ET={$D9:bxg.$7d,$GF:{x:0,y:0,w:b.size,h:bxg.area.h}}}else{if(b.dir!="down"){bxg.Trace.log("BXG","errorParameter","Invalid options.dir="+b.dir,"bxg.C1WayBufferedScrollControl()")}b.dir=bxg.CControl.SCROLL_DOWN;if(b.size<=bxg.area.h){b.size=bxg.area.h}b.$ET={$D9:bxg.$7e,$GF:{x:0,y:0,w:bxg.area.w,h:b.size}}}}}b.$ET.$FL=this;this.$EY=bxg.buffer;bxg.CControl.call(this,c,b,a);if(b.dir==bxg.CControl.SCROLL_LEFT){this.scrollSize.w=b.size;this.scrollSize.h=bxg.area.h}else{if(b.dir==bxg.CControl.SCROLL_RIGHT){this.scrollSize.w=b.size;this.scrollSize.h=bxg.area.h}else{if(b.dir==bxg.CControl.SCROLL_UP){this.scrollSize.w=bxg.area.w;this.scrollSize.h=b.size}else{this.scrollSize.w=bxg.area.w;this.scrollSize.h=b.size}}}this.$6Z=[];this.$Hs0=undefined};bx.$Inherit(bxg.C1WayBufferedScrollControl,bxg.CScrollControl);bxg.C1WayBufferedScrollControl.prototype.scrollReset=function(){if(this.$DF.dir==bxg.CControl.SCROLL_LEFT){this.scrollPos.x=0;this.scrollPos.y=0}else{if(this.$DF.dir==bxg.CControl.SCROLL_RIGHT){this.scrollPos.x=-(this.$DF.size-bxg.area.w);this.scrollPos.y=0}else{if(this.$DF.dir==bxg.CControl.SCROLL_UP){this.scrollPos.x=0;this.scrollPos.y=0}else{this.scrollPos.x=0;this.scrollPos.y=-(this.$DF.size-bxg.area.h)}}}this.$Hs1=undefined};bxg.C1WayBufferedScrollControl.prototype.$DQ=function(c,b,e,d,a){if(bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL){if(!(bxg.$9I&bxg.$E7)){return bxg.CScrollControl.prototype.$DQ.call(this,c,b,e,d,a)}if(c.$DF.baseLayer){return bxg.CScrollControl.prototype.$DQ.call(this,c,b,e,d,a)}}a.$DR=false;if(!c.$F3){return}this.$HtY=c.$F3;this.$Hb=e+this.$HtY.$HQ.y;this.$Hc=b+this.$HtY.$HQ.x;if(this.$DF.dir==bxg.CControl.SCROLL_DOWN){for(this.$GY=0;this.$GY<this.$6Z.length;this.$GY++){if((this.$Hb>=this.$DF.size-(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize&&this.$Hb<this.$DF.size-this.$6Z[this.$GY].$A9*this.$DF.paneSize)||(this.$Hb+this.$HtY.$HQ.h>=this.$DF.size-(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize&&this.$Hb+this.$HtY.$HQ.h<this.$DF.size-this.$6Z[this.$GY].$A9*this.$DF.paneSize)){this.$Hs2=this.$GY;a.$8I=b;a.$8J=e-(this.$DF.size-(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize);a.$DR=true;break}}}else{if(this.$DF.dir==bxg.CControl.SCROLL_UP){for(this.$GY=0;this.$GY<this.$6Z.length;this.$GY++){if((this.$Hb>=this.$6Z[this.$GY].$A9*this.$DF.paneSize&&this.$Hb<(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize)||(this.$Hb+this.$HtY.$HQ.h>=this.$6Z[this.$GY].$A9*this.$DF.paneSize&&this.$Hb+this.$HtY.$HQ.h<(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize)){this.$Hs2=this.$GY;a.$8I=b;a.$8J=e-this.$6Z[this.$GY].$A9*this.$DF.paneSize;a.$DR=true;break}}}else{if(this.$DF.dir==bxg.CControl.SCROLL_LEFT){for(this.$GY=0;this.$GY<this.$6Z.length;this.$GY++){if((this.$Hc>=this.$6Z[this.$GY].$A9*this.$DF.paneSize&&this.$Hc<(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize)||(this.$Hc+this.$HtY.$HQ.w>=this.$6Z[this.$GY].$A9*this.$DF.paneSize&&this.$Hc+this.$HtY.$HQ.w<(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize)){this.$Hs2=this.$GY;a.$8I=b-this.$6Z[this.$GY].$A9*this.$DF.paneSize;a.$8J=e;a.$DR=true;break}}}else{if(this.$DF.dir==bxg.CControl.SCROLL_RIGHT){for(this.$GY=0;this.$GY<this.$6Z.length;this.$GY++){if((this.$Hc>=this.$DF.size-(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize&&this.$Hc<this.$DF.size-this.$6Z[this.$GY].$A9*this.$DF.paneSize)||(this.$Hc+this.$HtY.$HQ.w>=this.$DF.size-(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize&&this.$Hc+this.$HtY.$HQ.w<this.$DF.size-this.$6Z[this.$GY].$A9*this.$DF.paneSize)){this.$Hs2=this.$GY;a.$8I=b-(this.$DF.size-(this.$6Z[this.$GY].$A9+1)*this.$DF.paneSize);a.$8J=e;a.$DR=true;break}}}}}}if(this.$HtY.$FO){if(!a.$DR){bxg.buffer.appendChild(this.$HtY.$FO)}else{if(this.$HtY.$FO.parentNode!=this.$6Z[this.$Hs2]){this.$6Z[this.$Hs2].appendChild(this.$HtY.$FO)}}}};bxg.C1WayBufferedScrollControl.prototype.$7A=function(a){bxg.CScrollControl.prototype.$7A.call(this,a);this.$Hs0=undefined;if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){return this}this.$CP();return this};bxg.C1WayBufferedScrollControl.prototype.$HX=function(){bxg.CScrollControl.prototype.$HX.call(this);if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){return}if(this.$6Z[0]){this.$6Z[0].style.display="none"}if(this.$6Z[1]){this.$6Z[1].style.display="none"}};bxg.C1WayBufferedScrollControl.prototype.create=function(){if(this.$7Q){return this}bxg.CScrollControl.prototype.create.call(this);if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){return this}this.$CP(true);return this};bxg.C1WayBufferedScrollControl.prototype.destroy=function(){bxg.CScrollControl.prototype.destroy.call(this);if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){return null}for(var a=0;a<this.$6Z.length;a++){this.$6Z[a].parentNode.removeChild(this.$6Z[a]);delete this.$6Z[a]}delete this.$6Z;return null};bxg.C1WayBufferedScrollControl.prototype.$CP=function(b){if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){return}var a;if(this.$DF.dir==bxg.CControl.SCROLL_DOWN||this.$DF.dir==bxg.CControl.SCROLL_UP){if(!this.$DF.paneSize||this.$DF.paneSize<this.area.h){this.$DF.paneSize=this.area.h}a=this.$DF.paneSize;if(this.$DF.dir==bxg.CControl.SCROLL_DOWN){if(b){this.$6Z.push(bxg.playGround.$TAG("div",{id:"1"},{position:"absolute",left:"0px",top:(this.area.h-a)+"px",width:this.area.w+"px",height:a+"px",overflow:"visible"}));this.$6Z.push(bxg.playGround.$TAG("div",{id:"2"},{position:"absolute",left:"0px",top:(this.area.h-a-a)+"px",width:this.area.w+"px",height:a+"px",overflow:"visible"}))}else{this.$6Z[0].style.top=(this.area.h-a)+"px";this.$6Z[1].style.top=(this.area.h-a-a)+"px"}}else{if(b){this.$6Z.push(bxg.playGround.$TAG("div",{},{position:"absolute",left:"0px",top:"0px",width:this.area.w+"px",height:a+"px",overflow:"visible"}));this.$6Z.push(bxg.playGround.$TAG("div",{},{position:"absolute",left:"0px",top:a+"px",width:this.area.w+"px",height:a+"px",overflow:"visible"}))}else{this.$6Z[0].style.top="0px";this.$6Z[1].style.top=a+"px"}}}else{if(!this.$DF.paneSize||this.$DF.paneSize<this.area.w){this.$DF.paneSize=this.area.w}a=this.$DF.paneSize;if(this.$DF.dir==bxg.CControl.SCROLL_RIGHT){if(b){this.$6Z.push(bxg.playGround.$TAG("div",{},{position:"absolute",left:(this.area.w-a)+"px",top:"0px",width:a+"px",height:this.area.h+"px",overflow:"visible"}));this.$6Z.push(bxg.playGround.$TAG("div",{},{position:"absolute",left:(this.area.w-a-a)+"px",top:"0px",width:a+"px",height:this.area.h+"px",overflow:"visible"}))}else{this.$6Z[0].style.left=(this.area.w-a)+"px";this.$6Z[1].style.left=(this.area.w-a-a)+"px"}}else{if(b){this.$6Z.push(bxg.playGround.$TAG("div",{},{position:"absolute",left:"0px",top:"0px",width:a+"px",height:this.area.h+"px",overflow:"visible"}));this.$6Z.push(bxg.playGround.$TAG("div",{},{position:"absolute",left:a+"px",top:"0px",width:a+"px",height:this.area.h+"px",overflow:"visible"}))}else{this.$6Z[0].style.left="0px";this.$6Z[1].style.left=a+"px"}}}this.$6Z[0].style.display="block";this.$6Z[1].style.display="block"};bxg.C1WayBufferedScrollControl.prototype.setScrollSize=function(a,b){bxg.CScrollControl.prototype.setScrollSize.call(this,a,b);if(this.$DF.dir==bxg.CControl.SCROLL_DOWN||this.$DF.dir==bxg.CControl.SCROLL_UP){this.$DF.size=this.scrollSize.h;if(this.$6Z[0]){this.$6Z[0].style.width=this.scrollSize.w+"px"}if(this.$6Z[1]){this.$6Z[1].style.width=this.scrollSize.w+"px"}}else{this.$DF.size=this.scrollSize.w;if(this.$6Z[0]){this.$6Z[0].style.height=this.scrollSize.h+"px"}if(this.$6Z[1]){this.$6Z[1].style.height=this.scrollSize.h+"px"}}};bxg.C1WayBufferedScrollControl.prototype.$7f=function(a){for(var b in this.$67){if(this.$67[b].active&&!this.$67[b].$CE){this.$67[b].render()}}for(b in this.$6q){this.$6q[b].move(this.$6q[b].$7g,this.$6q[b].$7h)}if(this.$6Z[a%2]){if(this.$6Z[a%2].style.backgroundImage&&this.$6Z[a%2].$9v){if(this.$DF.dir==bxg.CControl.SCROLL_UP){this.$6Z[a%2].style.backgroundPosition="0px "+((this.$DF.paneSize-this.$DF.paneSize*a)%this.$6Z[a%2].$9v.h)+"px"}else{if(this.$DF.dir==bxg.CControl.SCROLL_DOWN){this.$6Z[a%2].style.backgroundPosition="0px "+((this.$DF.paneSize*a)%this.$6Z[a%2].$9v.h)+"px"}else{if(this.$DF.dir==bxg.CControl.SCROLL_LEFT){this.$6Z[a%2].style.backgroundPosition=((this.$DF.paneSize-this.$DF.paneSize*a)%this.$6Z[a%2].$9v.w)+"px 0px"}else{if(this.$DF.dir==bxg.CControl.SCROLL_RIGHT){this.$6Z[a%2].style.backgroundPosition=((this.$DF.paneSize*a)%this.$6Z[a%2].$9v.w)+"px 0px"}}}}}}};bxg.C1WayBufferedScrollControl.prototype.$7i=function(){if((bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)&&!(bxg.$9I&bxg.$E7)){return}if(this.$DF.dir==bxg.CControl.SCROLL_LEFT||this.$DF.dir==bxg.CControl.SCROLL_RIGHT){if(parseInt(this.$6Z[0].style.top)!=this.scrollPos.y){this.$6Z[0].style.top=this.scrollPos.y+"px"}if(parseInt(this.$6Z[1].style.top)!=this.scrollPos.y){this.$6Z[1].style.top=this.scrollPos.y+"px"}}else{if(parseInt(this.$6Z[0].style.left)!=this.scrollPos.x){this.$6Z[0].style.left=this.scrollPos.x+"px"}if(parseInt(this.$6Z[1].style.left)!=this.scrollPos.x){this.$6Z[1].style.left=this.scrollPos.x+"px"}}if(this.$DF.dir==bxg.CControl.SCROLL_LEFT||this.$DF.dir==bxg.CControl.SCROLL_RIGHT){if(this.$Hs1!=this.scrollPos.x){this.$Hs1=this.scrollPos.x}else{return}}else{if(this.$Hs1!=this.scrollPos.y){this.$Hs1=this.scrollPos.y}else{return}}this.$AC=1;if(this.$DF.dir==bxg.CControl.SCROLL_DOWN){this.$Hs4=Math.floor((this.scrollSize.h+this.scrollPos.y-this.area.h)/this.area.h);this.$Hs5=Math.floor(this.$Hs4)%2;this.$6Z[this.$Hs5].style.top=((this.scrollSize.h+this.scrollPos.y)%this.area.h)+"px";this.$6Z[(this.$Hs5+1)%2].style.top=(parseInt(this.$6Z[this.$Hs5].style.top)-this.area.h)+"px"}else{if(this.$DF.dir==bxg.CControl.SCROLL_UP){this.$Hs4=Math.floor(Math.abs(this.scrollPos.y)/this.area.h);this.$Hs5=Math.floor(this.$Hs4)%2;this.$6Z[this.$Hs5].style.top=(this.scrollPos.y%this.area.h)+"px";this.$6Z[(this.$Hs5+1)%2].style.top=(this.scrollPos.y%this.area.h+this.area.h)+"px"}else{if(this.$DF.dir==bxg.CControl.SCROLL_RIGHT){this.$Hs4=Math.floor((this.scrollSize.w+this.scrollPos.x-this.area.w)/this.area.w);this.$Hs5=Math.floor(this.$Hs4)%2;this.$6Z[this.$Hs5].style.left=((this.scrollSize.w+this.scrollPos.x)%this.area.w)+"px";this.$6Z[(this.$Hs5+1)%2].style.left=(parseInt(this.$6Z[this.$Hs5].style.left)-this.area.w)+"px"}else{this.$Hs4=Math.floor(Math.abs(this.scrollPos.x)/this.area.w);this.$Hs5=Math.floor(this.$Hs4)%2;this.$6Z[this.$Hs5].style.left=(this.scrollPos.x%this.area.w)+"px";this.$6Z[(this.$Hs5+1)%2].style.left=(this.scrollPos.x%this.area.w+this.area.w)+"px"}}}if(this.$Hs4>this.$Hs0||this.$Hs0===undefined){this.$6Z[this.$Hs5].$A9=this.$Hs4;this.$7f(this.$Hs4);this.$Hs0=this.$Hs4}if(this.$Hs4+1>this.$Hs0||this.$Hs0===undefined){this.$6Z[(this.$Hs5+1)%2].$A9=this.$Hs4+1;this.$7f(this.$Hs4+1);this.$Hs0=this.$Hs4+1}};bxg.C1WayBufferedScrollControl.prototype.scroll=function(c,b,a){if(b===undefined){bxg.Trace.log("BXG","warning","C1WayBufferedScrollControl.scroll(delta) is deprecated. Please, call in CScrollControl.scroll() specification.","C1WayBufferedScrollControl.scroll");return}if(this.$DF.dir==bxg.CControl.SCROLL_LEFT){if(c>0){bxg.Trace.log("BXG","warning","Sign of dx should be a minus value.","C1WayBufferedScrollControl.scroll");return}}else{if(this.$DF.dir==bxg.CControl.SCROLL_RIGHT){if(c<0){bxg.Trace.log("BXG","warning","Sign of dx should be a plus value.","C1WayBufferedScrollControl.scroll");return}}else{if(this.$DF.dir==bxg.CControl.SCROLL_UP){if(b>0){bxg.Trace.log("BXG","warning","Sign of dy should be a minus value.","C1WayBufferedScrollControl.scroll");return}}else{if(this.$DF.dir==bxg.CControl.SCROLL_DOWN){if(b<0){bxg.Trace.log("BXG","warning","Sign of dy should be a plus value.","C1WayBufferedScrollControl.scroll");return}}}}}bxg.CScrollControl.prototype.scroll.call(this,c,b,a)};bxg.C1WayBufferedScrollControl.prototype.$CK=function(){return true};bxg.CObject=function(k,d,o,n,a){if(bx.inClassing){return}if(!k){bxg.Trace.log("BXG","errorParameter","type="+k,"CObject()");return}if(!d&&!(this instanceof bxg.CTagObject)){bxg.Trace.log("BXG","errorParameter","type="+k+",info="+d,"CObject()");return}var c=0;if(!(this instanceof bxg.CCompositeObject)&&d instanceof Object&&!(d instanceof bxg.$Ht1)){c=1}else{if(this instanceof bxg.CCompositeObject&&d instanceof Object&&d.sprites){c=2}else{if(!bxg.$Hp&&this instanceof bxg.CTagObject&&!d){c=3}}}var g,f;if(c){this.type=k;var l=bxg.ObjectFactory.$HA(k);var b=false;if(l&&l.$Hd){b=true}this.$DF=o||{};if(c==1){if(b){this.$He=bx.$copyObject({},d)}else{this.$He=d}var h={};var m=false;for(g in this.$He){if(this.$He[g].sprite&&this.$He[g].sprite.length){h[g]=this.$He[g].sprite;if(this.$He[g].speed!==undefined){h[g].speed=this.$He[g].speed}if(this.$He[g].noLoop!==undefined){h[g].noLoop=this.$He[g].noLoop}m=true}else{bxg.Trace.log("BXG","noProperty","No 'sprite' of state="+g+" of obj="+k,"CObject()")}if(this.$He[g].cdShape){if(!(this.$He[g].cdShape instanceof Array)||!this.$He[g].cdShape.length){bxg.Trace.log("BXG","noProperty","Type or data error in 'cdShape' of state="+g+" of obj="+k,"CObject()");delete this.$He[g].cdShape}else{for(f=0;f<this.$He[g].cdShape.length;f++){if(!bxg.CObject.$Ha(this.$He[g].cdShape[f])){bxg.Trace.log("BXG","error","Collision detection shape format error in state="+g+",object="+this.type,"CObject()");bxg.Trace.data(this.$He[g].cdShape[f])}}}}if(this.$He[g].offset){if(isNaN(Number(this.$He[g].offset.x))||isNaN(Number(this.$He[g].offset.y))){bxg.Trace.log("BXG","noProperty","No numeric value in 'offset' of state="+g+" of obj="+k,"CObject()");this.$He[g].offset.x=0;this.$He[g].offset.y=0}}}if(m){if(b){this.$Hta(h)}this.sprites=new bxg.$Ht1(h)}else{bxg.Trace.log("BXG","noProperty","No sprites in info of obj="+k,"CObject()")}}else{if(c==2){this.$He=d;this.sprites=d.sprites;var e;for(g in this.sprites){if(this.sprites[g].sprite){if(b){this.$Hta(this.sprites[g].sprite)}this.sprites[g].sprite=new bxg.$Ht1(this.sprites[g].sprite)}else{bxg.Trace.log("BXG","noProperty","No 'sprite' of state="+g+" of obj="+k,"CObject()")}}}else{}}this.id=bxg.ObjectFactory.$Hl++;this.$Htb()}else{this.$DF=a||{};this.$DF.cdShape=o;this.$DF.manager=n;if(this.$DF.recycle!==false){this.$DF.recycle=true}this.id=k;this.sprites=d;this.type=this.$DF.type}this.control=null;if(bxg.$Hp){this.level=null}this.size={w:0,h:0};this.$7Z={x:0,y:0,z:0};this.$Htc={x:0,y:0,z:0};this.$7Y={x:0,y:0};this.$Htd();this.$DY();this.$7H={x:0,y:0,z:0};this.$Hte={x:0,y:0,z:0};this.$6E={};if(!(this instanceof bxg.CCompositeObject)){if(this.sprites&&this.sprites instanceof bxg.$Ht1){this.$CT=this.sprites.$CT()}}else{if(this.sprites){var g;for(g in this.sprites){if(this.sprites[g].sprite&&this.sprites[g].sprite instanceof bxg.$Ht1){this.$CT=this.sprites[g].sprite.$CT()}if(this.$CT){break}}}}if(this.$79&&this.$79.onTick){this.$CT=true}};bxg.CObject.prototype.$Htb=function(){if(this.sprites){this.sprites.setSpeed(1);this.sprites.setLoop(true);if(this.$DF.sprite){if(this.$DF.sprite.speed){this.sprites.setSpeed(this.$DF.sprite.speed)}if(this.$DF.sprite.noLoop||this.$DF.sprite.loop===false){this.sprites.setLoop(false)}}this.sprites.$7n(undefined,true)}if(this.$H1){delete this.$H1}};bxg.CObject.prototype.$Htd=function(){this.$FQ(this.$DF.zIndex);if(this.$DF.baseLayer){if(!(bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)){this.$DF.baseLayer=false}}this.$Htf=false;this.$Htg=false;if(this.$DF.noRecycle){this.$DF.recycle=false}else{if((bxg.$9I&bxg.$E8)&&(bxg.$9I&bxg.$E7)&&this.$DF.baseLayer){this.$DF.recycle=false}else{this.$DF.recycle=true}}if(this.$DF.cdShape){this.$Hth=this.$DF.cdShape;this.$6C=this.$Hth;if(this.$6C&&this.$6C.length){for(var a=0;a<this.$6C.length;a++){if(!bxg.CObject.$Ha(this.$6C[a])){bxg.Trace.log("BXG","error","Collision detection shape format error in object="+this.type,"CGameObject()");bxg.Trace.data(this.$6C[a])}}}}else{if(this.$6C){delete this.$6C}if(this.$Hth){delete this.$Hth}}if(this.$DF.manager){this.$79=this.$DF.manager}else{if(this.$79){delete this.$79}}this.manager=this.$79};bxg.CObject.prototype.$DY=function(){this.active=false;this.$EL=false;this.$6D=true;this.$HtV=true;this.$CE=false;this.$7P=false;this.$FV=false;this.$Hm=false;if(bxg.$Hp){this.data={bxgState:0,$FZ:{}}}else{this.data={$FZ:{}}}this.$7Z.x=this.$7Z.y=this.$7Z.z=0;this.$Htc.x=this.$Htc.y=this.$Htc.z=0;this.$7Y.x=this.$7Y.y=0};bxg.CObject.COLLISION_OBJECT=1;bxg.CObject.COLLISION_TILE=2;bxg.CObject.$Ha=function(a){if(!a||!(a instanceof Object)){return false}if(!a.shape&&(a.rect||a.circle||a.point)){a.data=a.rect||a.circle||a.point;if(a.rect){a.shape="rect"}if(a.circle){a.shape="circle"}if(a.point){a.shape="point"}a.data.x0=a.data.x;a.data.y0=a.data.y}if(!a.shape||!a.data){return false}if(a.shape=="circle"){if(isNaN(Number(a.data.x0))||isNaN(Number(a.data.y0))||isNaN(Number(a.data.r))){return false}}else{if(a.shape=="rect"){if(isNaN(Number(a.data.x0))||isNaN(Number(a.data.y0))||isNaN(Number(a.data.w))||isNaN(Number(a.data.h))){return false}}else{if(a.shape=="point"){if(isNaN(Number(a.data.x0))||isNaN(Number(a.data.y0))){return false}}else{return false}}}return true};bxg.CObject.prototype.addChild=function(c,a){if(this.$FV){bxg.Trace.log("BXG","errorInvalidState","destroyed","CGameObject.addChild");return}if(!c){bxg.Trace.log("BXG","errorParameter","no object","CGameObject.addChild");return}if(c.parent){bxg.Trace.log("BXG","warning",c.type+" is alreay a child object, it cannot be child to the other without removing from the current parent","CGameObject.addChild");c.parent.removeChild(c)}this.$AD=this.$AD||[];var b=a||{};b.object=c;c.parent=this;this.$AD.push(b)};bxg.CObject.prototype.removeChild=function(c){if(this.$FV){bxg.Trace.log("BXG","errorInvalidState","destroyed","CGameObject.removeChild");return}var a;var b=false;if(this.$AD){for(a=0;a<this.$AD.length;a++){if(typeof c=="string"){if(this.$AD[a].object.id==c){if(this.$AD[a].parent){delete this.$AD[a].parent}c=this.$AD[a].object;this.$AD.splice(a,1);b=true;break}}else{if(this.$AD[a].object==c){if(c.parent){delete c.parent}this.$AD.splice(a,1);b=true;break}}}}if(!b){bxg.Trace.log("BXG","unknownObject",c.type?(c.type+":"+c.id):c,"CGameObject.removeChild");return}};bxg.CObject.prototype.getChildList=function(){return this.$AD};bxg.CObject.prototype.hasChild=function(){if(!this.$AD){return false}if(this.$AD.length>0){return true}return false};bxg.CObject.prototype.$Hta=function(c){var a;for(var b in c){for(a=0;a<c[b].length;a++){c[b][a]=this.type+"_"+c[b][a]}}};bxg.CObject.prototype.$FQ=function(a){if(a){this.$DF.zIndex=a*bxg.$9Y.$EF}else{this.$DF.zIndex=0}};bxg.CObject.prototype.$__getSpriteStatesInfo=function(){if(this.sprites){return this.sprites.$7q}};bxg.CObject.prototype.setZindex=function(b,a){if(this.$FV){bxg.Trace.log("BXG","errorInvalidState","destroyed","CGameObject.setZindex");return}if(b!==undefined){this.$FQ(b)}if(this.$F3){if(this.control){this.$F3.$FQ(this.control.getZindexBase()+this.$DF.zIndex)}else{this.$F3.$FQ(this.$DF.zIndex)}}else{if(this.tag){if(this.control){this.tag.style.zIndex=(this.control.getZindexBase()+this.$DF.zIndex)}else{this.tag.style.zIndex=this.$DF.zIndex}}}};bxg.CObject.prototype.getZindex=function(){return parseInt(this.$DF.zIndex/bxg.$9Y.$EF)};bxg.CObject.prototype.activate=function(a){if(this.$FV){bxg.Trace.log("BXG","errorInvalidState","destroyed","CGameObject.activate");return this}if(!this.$HtW()){return}if(this.active){return this}if(!this.control&&!a){bxg.Trace.log("BXG","warnObjectNoControl","activate.(type="+this.type+")","CGameObject.activate")}if(bxg.$6c[this.type]&&bxg.$6c[this.type].images&&!bxg.$6c[this.type].$B5){bxg.Trace.log("BXG","warnObjectUnloaded",this.type+":"+this.id,"CGameObject.activate")}this.active=true;this.$CE=false;if(bxg.game.$6l){this.$EL=false}else{this.$EL=true}this.useCollisionDetection(true);if(bxg.$Hp){this.data.bxgState=0}if(this.sprites){this.setCurSpriteState(undefined,true)}if(this.$79&&this.$79.onActivate){this.$79.onActivate(this,bxg.game.$9J)}if(this.$AD){var b;for(b=0;b<this.$AD.length;b++){if(this.$AD[b].life){this.$AD[b].object.activate(a)}}}return this};bxg.CObject.prototype.show=function(){if(!this.activate){bxg.Trace.log("BXG","warning","Object is not activated. object.type="+this.type,"CGameObject.show")}if(this.$3K){return this}this.$3K=true;if(this.$F3){if(this.$F3.$F4){this.$F3.$F4(true)}}else{if(this.tag){this.tag.style.display="block"}}if(this instanceof bxg.CCompositeObject){if(this.$D0&&this.$CX&&this.$CX[this.$D0]){for(var a in this.$CX[this.$D0]){if(this.$CX[this.$D0][a].hide){continue}if(this.$CX[this.$D0][a].group){this.sprites[a].$G5=true;if(this.sprites[a].$F3&&this.sprites[a].$F3.$F4){this.sprites[a].$F3.$F4(true)}}}}}this.$Hti(bxg.game.$9J);this.render(true);if(this.$AD){var b;for(b=0;b<this.$AD.length;b++){if(this.$AD[b].life){this.$AD[b].object.show()}}}return this};bxg.CObject.prototype.hide=function(){if(!this.$3K){return this}this.$3K=false;if(this.$F3){if(this.$F3.$F4){this.$F3.$F4(false)}}else{if(this.tag){this.tag.style.display="none"}}if(this instanceof bxg.CCompositeObject){for(var a in this.sprites){this.sprites[a].$G5=false;if(this.sprites[a].$F3&&this.sprites[a].$F3.$F4){this.sprites[a].$F3.$F4(false)}}}return this};bxg.CObject.prototype.deactivate=function(){if(!this.active){return this}this.hide();this.active=false;this.$EL=false;if(this.$79&&this.$79.onDeactivate){this.$79.onDeactivate(this,bxg.game.$9J)}if(this.$AD){var a;for(a=0;a<this.$AD.length;a++){if(this.$AD[a].life){this.$AD[a].object.deactivate()}}}return this};bxg.CObject.prototype.pause=function(){this.$CE=true;return this};bxg.CObject.prototype.resume=function(){this.$CE=false;return this};bxg.CObject.prototype.render=function(a){if(this.$FV){bxg.Trace.log("BXG","errorInvalidState","destroyed","CGameObject.render");return this}if(!this.$HtW(a)){return}bxg.CObject.prototype.render.$DU=bxg.CObject.prototype.render.$DU||{};if(this.control){this.control.$DQ(this,(this.$7Z.x+this.$7Y.x),(this.$7Z.y+this.$7Y.y),this.$7Z.z,bxg.CObject.prototype.render.$DU)}else{bxg.CObject.prototype.render.$DU.$DR=true;bxg.CObject.prototype.render.$DU.$8I=(this.$7Z.x+this.$7Y.x);bxg.CObject.prototype.render.$DU.$8J=(this.$7Z.y+this.$7Y.y)}if(bxg.CObject.prototype.render.$DU.$DR){if(this.$F3){this.$F3.$FY(bxg.CObject.prototype.render.$DU.$8I,bxg.CObject.prototype.render.$DU.$8J)}else{if(this.tag){this.tag.style.left=bxg.CObject.prototype.render.$DU.$8I+"px";this.tag.style.top=bxg.CObject.prototype.render.$DU.$8J+"px"}}}this.$7P=false;return};bxg.CObject.prototype.useCollisionDetection=function(a){this.$6D=a;if(!bxg.game.$6l){this.$HtV=a}};bxg.CObject.prototype.tick=function(a){if(a===undefined){this.$H8=this.$H8||1;a=this.$H8++}if(!this.active){return}if(this.$79&&this.$79.onOutView){if(this.overViewScreen(null,true)){this.$79.onOutView(this)}}if(!this.active){return}if(this.$79&&this.$79.onTick){this.$79.onTick(this,a)}if(!this.active){return}if(!this.$Htf||!this.$Htg){this.$Hti(a);if(this.$Htf){this.$Htg=true}}};bxg.CObject.prototype.move=function(a,d,c){if(!isNaN(parseInt(d))){if(this.$7Z.y!=d){this.$Htc.y=this.$7Z.y;this.$7Z.y=d;this.$7P=true}}if(!isNaN(parseInt(a))){if(this.$7Z.x!=a){this.$Htc.x=this.$7Z.x;this.$7Z.x=a;this.$7P=true}}if(!isNaN(parseInt(c))){if(this.$7Z.z!=c){this.$Htc.z=this.$7Z.z;this.$7Z.z=c;this.$7P=true}}if(this.$AD){var b;for(b=0;b<this.$AD.length;b++){if(this.$AD[b].move){this.$AD[b].object.move((!isNaN(parseInt(a)))&&this.$AD[b].offset&&this.$AD[b].offset.x?a+this.$AD[b].offset.x:a,(!isNaN(parseInt(d)))&&this.$AD[b].offset&&this.$AD[b].offset.y?d+this.$AD[b].offset.y:d,(!isNaN(parseInt(c)))&&this.$AD[b].offset&&this.$AD[b].offset.z?c+this.$AD[b].offset.z:c)}}}if(this.$3K&&this.control&&this.$Htj){this.$Htn=this.$Htn||bxg.playGround.$TAG("DIV",{style:"position:absolute;border:solid 1px #000000;background-color:#ffffff"});this.$Htn.style.left=this.position(true).x+"px";this.$Htn.style.top=this.position(true).y+"px";if(this.$Htn.innerHTML!=this.$Htj){this.$Htn.innerHTML=this.$Htj}}};bxg.CObject.prototype.$Htk=function(){this.$7P=true};bxg.CObject.prototype.moveBy=function(c,b,a){this.move(!isNaN(parseInt(c))?this.$7Z.x+c:undefined,!isNaN(parseInt(b))?this.$7Z.y+b:undefined,!isNaN(parseInt(a))?this.$7Z.z+a:undefined);if(this.$AD){var d;for(d=0;d<this.$AD.length;d++){if(this.$AD[d].moveBy||this.$AD[d].move){this.$AD[d].object.moveBy(c,b,a)}}}};bxg.CObject.$FG=function(a,b){if(b.position){if(!a.$FH){a.src=bx.c.bx$nullImage}if(!a.$FH){a.style.width=b.size.w+"px"}if(!a.$FH){a.style.height=b.size.h+"px"}a.style.backgroundImage="url('"+b.url+"')";a.style.backgroundPosition=b.position.x+"px "+b.position.y+"px";a.$FH=true}else{a.src=b.url}if(b.opacity!==undefined){a.$CSS({opacity:b.opacity})}else{a.$CSS({opacity:1})}};bxg.CObject.prototype.position=function(a){if(this.control&&a){this.$7H.x=this.$7Z.x+this.control.scrollPos.x;this.$7H.y=this.$7Z.y+this.control.scrollPos.y}else{this.$7H.x=this.$7Z.x;this.$7H.y=this.$7Z.y}this.$7H.z=this.$7Z.z;return this.$7H};bxg.CObject.prototype.prevPosition=function(a){if(this.control&&a){this.$Hte.x=this.$Htc.x+this.control.scrollPos.x;this.$Hte.y=this.$Htc.y+this.control.scrollPos.y}else{this.$Hte.x=this.$Htc.x;this.$Hte.y=this.$Htc.y}this.$Hte.z=this.$Htc.z;return this.$Hte};bxg.CObject.prototype.center=function(a){this.position(a);this.$7I=this.$7I||{};this.$7I.x=this.$7H.x+Math.round(this.size.w/2);this.$7I.y=this.$7H.y+Math.round(this.size.h/2);return this.$7I};bxg.CObject.prototype.changeCollisionShape=function(a){if(!a||!(a instanceof Array)){bxg.Trace.log("BXG","errorParameter","cdShape="+a,"CGameObject.setCollisionShape");return}if(!this.$Hth){bxg.Trace.log("BXG","error","To use setCollisionShape(), the object should have chShape in creation time","CGameObject.setCollisionShape");return}for(var b=0;b<a.length;b++){if(!bxg.CObject.$Ha(a[b])){bxg.Trace.log("BXG","error","Collision detection shape format error in object="+this.type,"CGameObject()");bxg.Trace.data(a[b]);return}}this.$Hth=a};bxg.CObject.prototype.$Hti=function(a){if(this.sprites&&this.sprites instanceof bxg.$Ht1){this.$AE=this.sprites.$7D(a);if(this.$AE&&(this.$H1!=this.$AE)){this.$H1=this.$AE;if(this.$F3){this.$F3.$FF(this.$H1)}else{if(this.tag){bxg.CObject.$FG(this.tag,this.$H1)}}}if(this.$He&&this.$He[this.sprites.$7w]){if(this.$He[this.sprites.$7w].offset){if(this.$7Y.x!=this.$He[this.sprites.$7w].offset.x||this.$7Y.y!=this.$He[this.sprites.$7w].offset.y){this.$7Y.x=this.$He[this.sprites.$7w].offset.x;this.$7Y.y=this.$He[this.sprites.$7w].offset.y;this.$7P=true}}else{if(this.$DF.size&&!isNaN(parseInt(this.$DF.size.w))&&!isNaN(parseInt(this.$DF.size.h))){this.$Htm=this.$Htl=0;if(this.$H1.position){if(this.$H1.size){if(this.$H1.size.w!=this.$DF.size.w){this.$Htm=Math.round((this.$DF.size.w-this.$H1.size.w)/2)}if(this.$H1.size.h!=this.$DF.size.h){this.$Htl=Math.round((this.$DF.size.h-this.$H1.size.h)/2)}}}else{if(this.$H1.w!=this.$DF.size.w){this.$Htm=Math.round((this.$DF.size.w-this.$H1.w)/2)}if(this.$H1.h!=this.$DF.size.h){this.$Htl=Math.round((this.$DF.size.h-this.$H1.h)/2)}}if(this.$7Y.x!=this.$Htm||this.$7Y.y!=this.$Htl){this.$7Y.x=this.$Htm;this.$7Y.y=this.$Htl;this.$7P=true}}else{if(this.$7Y.x||this.$7Y.y){this.$7Y.x=0;this.$7Y.y=0;this.$7P=true}}}if(this.$6C){if(this.$He[this.sprites.$7w].cdShape){if(this.$He[this.sprites.$7w].cdShape!=this.$6C){this.$6C=this.$He[this.sprites.$7w].cdShape}}else{if(this.$6C!=this.$Hth){this.$6C=this.$Hth}}}}}};bxg.CObject.prototype.$7E=function(a){this.position(a?false:true);this.$6E.x=this.$7H.x;this.$6E.y=this.$7H.y;this.$6E.w=this.size.w;this.$6E.h=this.size.h;for(var b=0;b<this.$6C.length;b++){this.$6C[b].data.x=this.$6C[b].data.x0+this.$6E.x;this.$6C[b].data.y=this.$6C[b].data.y0+this.$6E.y}};bxg.CObject.prototype.$7F=function(a){if(!a){return false}for(this.data.$FZ.$FB=0;this.data.$FZ.$FB<this.$6C.length;this.data.$FZ.$FB++){this.data.$FZ.$81=bxg.CObject.$G0[this.$6C[this.data.$FZ.$FB].shape+"_"+a.shape];return this.data.$FZ.$81(this.$6C[this.data.$FZ.$FB].data,a.data)}return false};bxg.CObject.prototype.$G1=function(a,b){a.data.$FZ.$80=true;if(this.$6C.length==1&&this.$6C[0].shape=="rect"&&a.$6C.length==1&&a.$6C[0].shape=="rect"){a.data.$FZ.$80=false}if(a.data.$FZ.$80&&!bxg.Geometry.intersect_rect_rect(a.$6E,this.$6E)){return false}for(a.data.$FZ.$FB=0;a.data.$FZ.$FB<this.$6C.length;a.data.$FZ.$FB++){for(a.data.$FZ.$FA=0;a.data.$FZ.$FA<a.$6C.length;a.data.$FZ.$FA++){a.data.$FZ.$81=bxg.CObject.$G0[this.$6C[a.data.$FZ.$FB].shape+"_"+a.$6C[a.data.$FZ.$FA].shape];if(a.data.$FZ.$81(this.$6C[a.data.$FZ.$FB].data,a.$6C[a.data.$FZ.$FA].data,b)){return true}}}return false};bxg.CObject.prototype.$9K=function(a){this.data.$FZ.ret=false;for(this.data.$FZ.k2=0;this.data.$FZ.k2<bxg.game.$6e.length;this.data.$FZ.k2++){for(this.data.$FZ.j in bxg.game.$6e[this.data.$FZ.k2].$6B){if(bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j]!=this&&bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j].active&&bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j].$HtV){if(this.$79.onCollisionAnalysis){this.data.$FZ.$G3=this.data.$FZ.$G3||{};if(this.$G1(bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j],this.data.$FZ.$G3)){if(!a){this.data.$FZ.$G3.type=bxg.CObject.COLLISION_OBJECT;this.$79.onCollisionAnalysis(this,bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j],this.data.$FZ.$G3)}else{if(this.$79.onCollisionCheck){this.data.$FZ.ret=this.$79.onCollisionCheck(this,bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j])}else{this.data.$FZ.ret=true}}}}else{if(this.$G1(bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j])){if(!a){this.$79.onCollision(this,bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j])}else{if(this.$79.onCollisionCheck){this.data.$FZ.ret=this.$79.onCollisionCheck(this,bxg.game.$6e[this.data.$FZ.k2].$6B[this.data.$FZ.j])}else{this.data.$FZ.ret=true}}}}}}}return this.data.$FZ.ret};bxg.CObject.prototype.overViewScreen=function(b,a,c){if(this.control){return this.$7K(b,this.control.area,true,a,c)}else{return false}};bxg.CObject.prototype.overControlScreen=function(b,a,c){if(this.control){return this.$7K(b,this.control.scrollSize,false,a,c)}else{return false}};bxg.CObject.prototype.$7K=function(c,d,f,a,e){this.position(f);var b=false;if(c){c.x=0;c.y=0}if(!a){if(this.$7H.x<(0+(e&&e.left?e.left:0))){if(c){c.x=1}b=true}else{if(this.$7H.x>(d.w-this.size.w-(e&&e.right?e.right:0))){if(c){c.x=2}b=true}}if(this.$7H.y<(0+(e&&e.top?e.top:0))){if(c){c.y=1}b=true}else{if(this.$7H.y>(d.h-this.size.h-(e&&e.bottom?e.bottom:0))){if(c){c.y=2}b=true}}}else{if(this.$7H.x+this.size.w<0){if(c){c.x=1}b=true}else{if(this.$7H.x>d.w){if(c){c.x=2}b=true}}if(this.$7H.y+this.size.h<0){if(c){c.y=1}b=true}else{if(this.$7H.y>d.h){if(c){c.y=2}b=true}}}return b};bxg.CObject.prototype.$6v=function(c,a){this.$HtW();this.control=c;if(bxg.$Hp){this.level=c}if(a!==undefined){if(this instanceof bxg.CTagObject){bxg.Trace.log("BXG","warning","Cannot change baseLayer option for bxg.CTagObject, type="+this.type,"CControl.add")}else{if(bxg.$9I&bxg.$E7){bxg.Trace.log("BXG","warning","Cannot change baseLayer option in DOM or DOMcanvas renderer mode, type="+this.type,"CControl.add")}else{this.$DF.baseLayer=this.$Htf=a}}}if(this.$AD){var b;for(b=0;b<this.$AD.length;b++){if(this.$AD[b].life){c.add(this.$AD[b].object)}}}};bxg.CObject.prototype.$6w=function(b){if(bxg.$Hp){if(this.level){delete this.level}}if(this.control){delete this.control}this.$Htf=this.$Htg=false;if(this.$AD){var a;for(a=0;a<this.$AD.length;a++){if(this.$AD[a].life){b.remove(this.$AD[a].object)}}}};bxg.CObject.prototype.isInBaseLayer=function(){if(this.$Htf){return true}else{return false}};bxg.CObject.prototype.canSetBaseLayer=function(){if(bxg.$9I&bxg.$E7){return false}return true};bxg.CObject.prototype.setBaseLayer=function(a){if(a===undefined){return false}if(bxg.$9I&bxg.$E7){bxg.Trace.log("BXG","warning","Not support baseLayer option in DOM or DOMcanvas renderer mode, type="+this.type,"CGameObject.setBaseLayer");return false}if(this.$DF.baseLayer==a){return false}if(a){this.$DF.baseLayer=true}else{this.$DF.baseLayer=false}if(!this.control){return false}if(this.$F3){if(this.control.$EM.$F7){this.control.$EM.$F7(this.$F3)}if(this.control.$EM.$F5){this.control.$EM.$F5(this.$F3,this.$Hto)}}this.$Htf=this.$DF.baseLayer;this.$Htg=false;return true};bxg.CObject.prototype.$HtW=function(a){if(!this.$7Q){if(!a){bxg.Trace.log("BXG","errorInvalidState","not created. type="+this.type,"CGameObject")}return false}if(this.$7Q){return true}};bxg.CObject.prototype.create=function(){if(this.$7Q){return}if(!this.sprites){bxg.Trace.log("BXG","error","sprites=null of "+this.type,"CObject.create");return}this.$7C();var b;if(!(b=this.sprites.$7k())){bxg.Trace.log("BXG","emptySprite","of "+this.type,"CObject.create");return}var a=bxg.$FT;if(this.$DF.baseLayer){a|=bxg.$7t}this.$F3=bxg.$E9.$7l({$GJ:b,$F6:this.$DF.zIndex,$D9:a});this.$7Q=true;return this};bxg.CObject.prototype.$7C=function(){var a;if(this.$DF.size){this.size.w=this.$DF.size.w;this.size.h=this.$DF.size.h}else{if(this.sprites){a=this.sprites.$7k()}if(a){this.size.w=a.size?a.size.w:a.w;this.size.h=a.size?a.size.h:a.h}}if(this.$79&&this.$79.onInit){this.$79.onInit(this)}return this};bxg.CObject.prototype.destroy=function(){if(this.$FV){return}if(bxg.game.$6l){bxg.game.$6k({$6s:bxg.CObject.prototype.destroy,$6o:this});return}if(this.$AD){var a;for(a=0;a<this.$AD.length;a++){if(this.$AD[a].destroy){this.$AD[a].object.destroy()}}delete this.$AD}this.deactivate();if(this.control){this.control.remove(this)}this.$Hm=false;if(!bxg.ObjectFactory.$FW(this)){if(this.$F3){this.$F3.$F1();delete this.$F3}else{if(this.tag){delete this.tag}}this.$FV=true;return}this.$FV=true;this.$Hm=true};bxg.CObject.prototype.setCurSpriteState=function(b,a){if(this.$FV){bxg.Trace.log("BXG","warnInvalidState","destroyed","type="+this.type,"CObject.setCurSpriteState");return}if(!this.active){bxg.Trace.log("BXG","warnInvalidState","Need to be in active state","type="+this.type,"CObject.setCurSpriteState")}if(this.$DF.$Htf){bxg.Trace.log("BXG","warnInvalidState","when activated and baseLayer option is enabled","type="+this.type,"CObject.setCurSpriteState");return}if(this.sprites){if(a){this.sprites.$7n(b,true)}else{this.sprites.$7n(b)}}else{bxg.Trace.log("BXG","warnNoSprites","CObject.setCurSpriteState")}};bxg.CObject.prototype.queueSpriteState=function(a){if(this.$FV){bxg.Trace.log("BXG","warnInvalidState","destroyed","CObject.queueSpriteState");return}if(!this.active){bxg.Trace.log("BXG","warnInvalidState","Need to be in active state","type="+this.type,"CObject.queueSpriteState")}if(this.sprites){this.sprites.$7o(a)}else{bxg.Trace.log("BXG","warnNoSprites","CObject.queueSpriteState")}};bxg.CObject.prototype.getCurSpriteState=function(){if(this.$FV){return null}if(this.sprites){return this.sprites.$FR()}else{bxg.Trace.log("BXG","warnNoSprites","CObject.getCurSpriteState")}return null};bxg.CObject.prototype.hasSpriteState=function(a){if(this.$FV){return null}if(this.sprites){return this.sprites.$7q[a]}else{bxg.Trace.log("BXG","warnNoSprites","CObject.hasSpriteState")}return null};bxg.CObject.prototype.doesCurSpritePlayEnd=function(){if(this.$FV){return true}if(!this.active){bxg.Trace.log("BXG","warnInvalidState","Need to be in active state","type="+this.type,"CObject.doesCurSpritePlayEnd")}if(this.sprites){return this.sprites.$7r()}else{bxg.Trace.log("BXG","warnNoSprites","CObject.doesCurSpritePlayEnd")}return true};bxg.CObject.prototype.trace=function(a){this.$Htj=a};bxg.CObjectBase=bxg.CObject;bxg.CTagObject=function(e,d,c,b,a){if(bx.inClassing){return}bxg.CObjectBase.call(this,e,d,c,b,a)};bx.$Inherit(bxg.CTagObject,bxg.CObjectBase);bxg.CTagObject.prototype.$Htd=function(){if(this.$DF.baseLayer!==undefined){bxg.Trace.log("BXG","warning","Not support baseLayer option for bxg.CTagObject, type="+this.type,"CTagObject");this.$DF.baseLayer=false}this.$DF.noRecycle=true;bxg.CObject.prototype.$Htd.call(this)};bxg.CTagObject.prototype.create=function(a){if(this.$7Q){return this}if(a){this.tag=a;this.tag.style.position="absolute";this.tag.style.display="none";this.$HtX=true}this.$7C();var b;if(this.sprites&&(!a||a.tagName=="IMG")){if(b=this.sprites.$7k()){if(!bxg.$Htp){bxg.Trace.log("BXG","unknownClass","CTagObject requires 'DOM Renderer' module","CTagObject.create")}else{this.$F3=new bxg.$Htp({$GJ:b,$F6:this.$DF.zIndex,$D9:bxg.$FT,$G2:a});this.tag=this.$F3.$FO}}}if(!this.tag){bxg.Trace.log("BXG","noProperty","No Tag or sprite","CTagObject.create")}this.$7Q=true;return this};bxg.CTagObject.prototype.setZindex=function(b,a){if(!a){bxg.Trace.log("BXG","error","CTagObject.setZindex() is not supproted","CTagObject.setZindex")}};bxg.CTagObject.prototype.canSetBaseLayer=function(){return false};bxg.CTagObject.prototype.setBaseLayer=function(){bxg.Trace.log("BXG","warning","Not support baseLayer option for bxg.CTagObject, type="+obj.type,"CTagObject.setBaseLayer");return false};bxg.CCompositeObject=function(d,g,a,h,f,e){if(bx.inClassing){return}if(g instanceof Object&&g.states&&g.sprites){if(!d||!g||!a){bxg.Trace.log("BXG","errorParameter","type="+d+",info="+g+",opts="+a,"CCompositeObject()");return}if(!g.states||!g.sprites){bxg.Trace.log("BXG","errorParameter","info.states="+g.states+",info.sprites="+g.sprites,"CCompositeObject()");return}if(!a.size){bxg.Trace.log("BXG","errorParameter","opts.size="+a.size,"CCompositeObject()");return}g=bx.$copyObject({},g);this.$CX={};var b;for(var c in g.states){if(!g.states[c].config){bxg.Trace.log("BXG","noProperty","No 'config' for state="+c,"CCompositeObject()")}else{this.$CX[c]=g.states[c].config}if(g.states[c].cdShape){if(!(g.states[c].cdShape instanceof Array)||!g.states[c].cdShape.length){bxg.Trace.log("BXG","noProperty","Type or data error in 'cdShape' of state="+c+" of obj="+d,"CCompositeObject()");delete g.states[c].cdShape}else{for(b=0;b<g.states[c].cdShape.length;b++){if(!bxg.CObject.$Ha(g.states[c].cdShape[b])){bxg.Trace.log("BXG","error","Collision detection shape format error in state="+c+",object="+d,"CCompositeObject()");bxg.Trace.data(g.states[c].cdShape[b])}}}}}bxg.CObject.call(this,d,g,a)}else{this.$CX=a;bxg.CObject.call(this,d,g,h,f,e)}};bx.$Inherit(bxg.CCompositeObject,bxg.CObject);bxg.CCompositeObject.prototype.create=function(){if(this.$7Q){return}if(bxg.$9I&bxg.$E7){this.tag=bxg.playGround.$TAG("div",{style:"position:absolute;display:none"});if(this.$DF.size&&this.$DF.size.w){this.tag.$CSS({width:this.$DF.size.w+"px"})}if(this.$DF.size&&this.$DF.size.h){this.tag.$CSS({height:this.$DF.size.h+"px"})}}this.$7C();var b=bxg.$FT;if(this.$DF.baseLayer){b|=bxg.$7t}var c;for(var a in this.sprites){if(!(c=this.sprites[a].sprite.$7k())){continue}this.sprites[a].$F3=bxg.$E9.$7l({$GJ:c,$F6:this.$DF.zIndex+bx.$checkNaN(this.sprites[a].zIndex),$D9:b});if(this.tag){this.tag.appendChild(this.sprites[a].$F3.$FO)}this.sprites[a].$8G={x:0,y:0};if(this.sprites[a].offset){if(this.sprites[a].offset.left!==undefined){this.sprites[a].$8G.x=this.sprites[a].offset.left}else{if(this.sprites[a].offset.right!==undefined){this.sprites[a].$8G.x=this.size.w-(c.w+this.sprites[a].offset.right)}}if(this.sprites[a].offset.top!==undefined){this.sprites[a].$8G.y=this.sprites[a].offset.top}else{if(this.sprites[a].offset.bottom!==undefined){this.sprites[a].$8G.y=this.size.h-(c.h+this.sprites[a].offset.bottom)}}}if(this.tag){this.sprites[a].$F3.$FY(this.sprites[a].$8G.x,this.sprites[a].$8G.y)}}this.$7Q=true;return this};bxg.CCompositeObject.prototype.$7C=function(){if(!this.sprites||!this.$DF.size){return}this.size=this.$DF.size;if(this.$79&&this.$79.onInit){this.$79.onInit(this)}return this};bxg.CCompositeObject.prototype.destroy=function(){if(bxg.game.$6l){bxg.game.$6k({$6s:bxg.CCompositeObject.prototype.destroy,$6o:this});return}bxg.CObject.prototype.destroy.call(this);if(!this.$Hm){for(var a in this.sprites){if(this.sprites[a].$F3){this.sprites[a].$F3.$F1()}delete this.sprites[a]}}};bxg.CCompositeObject.prototype.$Htb=function(){var a;for(a in this.sprites){this.sprites[a].sprite.setSpeed(1);this.sprites[a].sprite.setLoop(true);if(this.sprites[a].sprite){if(this.sprites[a].speed){this.sprites[a].sprite.setSpeed(this.sprites[a].speed)}if(this.sprites[a].noLoop){this.sprites[a].sprite.setLoop(false)}}this.sprites[a].sprite.$7n(undefined,true);if(this.sprites[a].$AH){delete this.sprites[a].$AH}}};bxg.CCompositeObject.prototype.$6v=function(b,a){bxg.CObject.prototype.$6v.call(this,b,a);if(!this.tag){for(this.$AG in this.sprites){if(this.control.$EM.$F5){this.control.$EM.$F5(this.sprites[this.$AG].$F3,this.$DF.baseLayer)}}}};bxg.CCompositeObject.prototype.$6w=function(a){if(!this.tag){for(this.$AG in this.sprites){if(this.control.$EM.$F7){this.control.$EM.$F7(this.sprites[this.$AG].$F3)}}}bxg.CObject.prototype.$6w.call(this,a)};bxg.CCompositeObject.prototype.setBaseLayer=function(a){if(!bxg.CObject.prototype.setBaseLayer.call(this,cntrl,a)){return false}if(!this.tag){for(this.$AG in this.sprites){if(this.control.$EM.$F7){this.control.$EM.$F7(this.sprites[this.$AG].$F3)}if(this.control.$EM.$F5){this.control.$EM.$F5(this.sprites[this.$AG].$F3,this.$Hto)}}}return true};bxg.CCompositeObject.prototype.render=function(){bxg.CObject.prototype.render.call(this);if(!this.tag){if(bxg.CObject.prototype.render.$DU.$DR){for(this.$AG in this.sprites){this.sprites[this.$AG].$F3.$FY(bxg.CObject.prototype.render.$DU.$8I+this.sprites[this.$AG].$8G.x,bxg.CObject.prototype.render.$DU.$8J+this.sprites[this.$AG].$8G.y)}}}};bxg.CCompositeObject.prototype.$Hti=function(a){for(this.$AG in this.sprites){if(this.sprites[this.$AG].$G5&&this.sprites[this.$AG].sprite&&this.sprites[this.$AG].$F3){this.$AE=this.sprites[this.$AG].sprite.$7D(a);if(this.$AE&&(this.sprites[this.$AG].$AH!=this.$AE)){this.sprites[this.$AG].$AH=this.$AE;this.sprites[this.$AG].$F3.$FF(this.$AE)}}}if(this.$6C&&this.$He){if(this.$He.states[this.$D0]){if(this.$He.states[this.$D0].cdShape){if(this.$He.states[this.$D0].cdShape!=this.$6C){this.$6C=this.$He.states[this.$D0].cdShape}}else{if(this.$6C!=this.$Hth){this.$6C=this.$Hth}}}}return this};bxg.CCompositeObject.prototype.setZindex=function(a){bxg.CObject.prototype.setZindex.call(this,a);if(!this.tag){for(this.$AG in this.sprites){if(this.control){this.sprites[this.$AG].$F3.$FQ(this.control.getZindexBase()+this.$DF.zIndex+bx.$checkNaN(parseInt(this.sprites[this.$AG].zIndex)))}else{this.sprites[this.$AG].$F3.$FQ(this.$DF.zIndex+bx.$checkNaN(parseInt(this.sprites[this.$AG].zIndex)))}}}};bxg.CCompositeObject.prototype.setCurSpriteState=function(d,b){if(this.$FV){bxg.Trace.log("BXG","warnInvalidState","destroyed","CCompositeObject.setCurSpriteState");return}if(!this.active){bxg.Trace.log("BXG","warnInvalidState","Need to be in active state","type="+this.type,"CCompositeObject.setCurSpriteState")}if(this.$DF.$Htf&&this.$EL){bxg.Trace.log("BXG","warnInvalidState","when activated and baseLayer option is enabled","CCompositeObject.setCurSpriteState");return}if(!d){for(d in this.$CX){break}}if(!d||!this.$CX[d]){bxg.Trace.log("BXG","errorParameter","state="+d,"CCompositeObject.setCurSpriteState");return false}if(this.$D0==d&&!b){return}this.$D0=d;var c;for(var a in this.$CX[d]){if(!this.sprites[a]){bxg.Trace.log("BXG","unknownSpriteId",a,"CCompositeObject.setCurSpriteState");continue}if(this.$CX[d][a].hide){this.sprites[a].$G5=false;if(this.sprites[a].$F3&&this.sprites[a].$F3.$F4){this.sprites[a].$F3.$F4(false)}}else{if(this.$CX[d][a].group){if(this.$3K){this.sprites[a].$G5=true;if(this.sprites[a].$F3&&this.sprites[a].$F3.$F4){this.sprites[a].$F3.$F4(true)}}if(typeof this.$CX[d][a].group=="string"){this.sprites[a].sprite.$7n(this.$CX[d][a].group,b)}else{if(this.$CX[d][a].group.length){for(c=0;c<this.$CX[d][a].group.length;c++){if(c==0){this.sprites[a].sprite.$7n(this.$CX[d][a].group[c],b)}else{this.sprites[a].sprite.$7o(this.$CX[d][a].group[c])}}}}this.sprites[a].sprite.setLoop(this.sprites[a].noLoop?false:true)}}}};bxg.CCompositeObject.prototype.queueSpriteState=function(){bxg.Trace.log("BXG","error","CCompositeObject.queueSpriteState() is not supproted","CCompositeObject.queueSpriteState")};bxg.CCompositeObject.prototype.getCurSpriteState=function(){if(this.$FV){return null}return this.$D0};bxg.CCompositeObject.prototype.hasSpriteState=function(a){if(this.$FV){return null}return this.$CX[a]};bxg.CCompositeObject.prototype.doesCurSpritePlayEnd=function(a){if(this.$FV){return true}if(!this.active){bxg.Trace.log("BXG","warnInvalidState","Need to be in active state","type="+this.type,"CCompositeObject.doesCurSpritePlayEnd")}if(this.sprites&&this.sprites[a]){if(this.sprites[a].$G5){if(this.sprites[a].sprite.$D3.length!=0||!this.sprites[a].sprite.$7r()){return false}}else{bxg.Trace.log("BXG","warning","doesCurSpritePlayEnd() called for hidden state="+a,"CCompositeObject.doesCurSpritePlayEnd")}}else{bxg.Trace.log("BXG","unknownSpriteGroup",a,"CCompositeObject.doesCurSpritePlayEnd")}return true};bxg.CCompositeObject.prototype.$__getSpriteStateInfo=function(){return this.$CX};bxg.CImageObject=function(b,c,a){if(bx.inClassing){return}if(!b){bxg.Trace.log("BXG","errorParameter","type="+b,"CImageObject()");return}if(!c||!(c instanceof bxg.CImage)){bxg.Trace.log("BXG","errorParameter","info="+c,"CImageObject()");return}this.$DF=a||{};this.image=c;this.image.parent=this;this.type=b;this.id=bxg.ObjectFactory.$Hl++;this.control=null;if(bxg.$Hp){this.level=null}this.size={w:0,h:0};this.$7Z={x:0,y:0,z:0};this.$Htc={x:0,y:0,z:0};this.$7Y={x:0,y:0};this.$Htd();this.$DY();this.$7H={x:0,y:0,z:0};this.$Hte={x:0,y:0,z:0};this.$6E={};if(this.$79&&this.$79.onTick){this.$CT=true}};bx.$Inherit(bxg.CImageObject,bxg.CObject);bxg.CImageObject.prototype.$Htd=function(){this.$DF.noRecycle=true;bxg.CObject.prototype.$Htd.call(this);if(this.image){this.image.setZindex(this.getZindex());if(this.image.canSetBaseLayer()){this.image.setBaseLayer(this.$DF.baseLayer)}else{this.$DF.baseLayer=this.image.getBaseLayer()}}};bxg.CImageObject.prototype.create=function(){if(this.$7Q){return}if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.create");return}this.$7C();this.$7Q=true;return this};bxg.CImageObject.prototype.$7C=function(){if(this.$DF.size&&!this.$DF.offset){this.size=this.$DF.size}else{this.size={w:this.image.size.w,h:this.image.size.h}}if(this.$79&&this.$79.onInit){this.$79.onInit(this)}return this};bxg.CImageObject.prototype.destroy=function(){bxg.CObject.prototype.destroy.call(this);if(this.image){this.image.destroy()}};bxg.CImageObject.prototype.isInBaseLayer=function(){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.setBaseLayer");return false}return this.image.isInBaseLayer()};bxg.CImageObject.prototype.setBaseLayer=function(a){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.setBaseLayer");return false}return this.image.setBaseLayer(a)};bxg.CImageObject.prototype.setZindex=function(a){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.setZindex");return}bxg.CObject.prototype.setZindex.call(this,a);this.image.setZindex(a)};bxg.CImageObject.prototype.show=function(){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.activate");return this}if(this.$3K){return this}bxg.CObject.prototype.show.call(this);this.control.add(this.image);this.image.move(this.position().x,this.position().y,this.position().z);return this};bxg.CImageObject.prototype.hide=function(){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.activate");return this}if(!this.$3K){return this}bxg.CObject.prototype.hide.call(this);if(this.active){this.control.remove(this.image)}return this};bxg.CImageObject.prototype.deactivate=function(){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.deactivate");return this}this.hide();bxg.CObject.prototype.deactivate.call(this);return this};bxg.CImageObject.prototype.move=function(a,c,b){if(!this.image){bxg.Trace.log("BXG","error","Object is not properly created. image="+this.image,"CImageObject.move");return}bxg.CObject.prototype.move.call(this,a,c,b);if(this.image.active){this.image.move(isNaN(parseInt(a))?this.position().x:a,isNaN(parseInt(c))?this.position().y:c,isNaN(parseInt(b))?this.position().z:b)}};bxg.CImage=function(c,b){if(bx.inClassing){return}if(!c){bxg.Trace.log("BXG","errorParameter","idImg="+c,"CImage()");return}if(!bxg.images[c]){bxg.Trace.log("BXG","unknownImageId",c,"CImage()");return}this.$DF=b||{};this.id=bxg.ObjectFactory.$Hl++;this.type=c;this.parent=null;this.control=null;if(bxg.$Hp){this.level=null}this.size=bxg.images[this.type].size?{w:bxg.images[this.type].size.w,h:bxg.images[this.type].size.h}:{w:bxg.images[this.type].w,h:bxg.images[this.type].h};this.$Htd();this.$DY();var a=0;if(this.$DF.baseLayer){a|=bxg.$7t}if(this.$DF.pattern){a|=bxg.$7u}this.$F3=bxg.$E9.$7l({$GJ:bxg.images[c],$D9:a,$GW:this.$DF.resize,$GK:this.$DF.rotate,$F6:this.$DF.zIndex});this.$7Q=true};bxg.CImage.prototype.$Htd=function(){this.$FQ(this.$DF.zIndex);if(this.$DF.baseLayer){if(!(bxg.$9I&bxg.$E8||bxg.$9I&bxg.$HtL)){this.$DF.baseLayer=false}}this.$Htf=false;if(this.$DF.noRecycle||this.$DF.pattern){this.$DF.recycle=false}else{if((bxg.$9I&bxg.$E8)&&(bxg.$9I&bxg.$E7)&&!this.$DF.baseLayer){this.$DF.recycle=false}else{this.$DF.recycle=true}}if(this.$F3){if(this.$DF.resize===undefined){this.$F3.$HR()}else{this.$F3.$HR(this.resize.w,this.resize.h)}if(this.$DF.alpha!==undefined){this.$F3.$Htq(this.$DF.alpha)}else{this.$F3.$Htq()}if(this instanceof bxg.CCanvasImage){if(this.$DF.rotate!==undefined){bxg.Trace.log("BXG","warning","rotate option is not supported.","CCanvasImage")}}else{if(this.$DF.rotate){this.$F3.$HS(this.$DF.rotate)}else{this.$F3.$HS(0)}}}};bxg.CImage.prototype.$DY=function(){this.$FV=false;this.$Hm=false;this.$7g=this.$7h=this.$Htr=0};bxg.CImage.prototype.destroy=function(){if(this.$FV){return}if(bxg.game.$6l){bxg.game.$6k({$6s:bxg.CImage.prototype.destroy,$6o:this});return}if(this.control){this.control.remove(this)}this.parent=null;this.$Hm=false;if(this.$F3.$F4){this.$F3.$F4(false)}if(!bxg.ObjectFactory.$FW(this)){this.$F3.$F1();delete this.$F3;this.$FV=true;return}this.$FV=true;this.$Hm=true};bxg.CImage.prototype.move=function(a,c,b){this.$7v=this.$7v||{};if(this.control){if(this.parent){this.$Hts=this.$Htt=0;if(this.parent.size.w!=this.size.w){this.$Hts=Math.round((this.parent.size.w-this.size.w)/2)}if(this.parent.size.h!=this.size.h){this.$Htt=Math.round((this.parent.size.h-this.size.h)/2)}this.control.$DQ(this,a+this.$Hts,c+this.$Htt,b,this.$7v)}else{this.control.$DQ(this,a,c,b,this.$7v)}}else{bxg.Trace.log("BXG","warnObjectNoControl","move.(image="+this.type+")","CImage.move");this.$7v.$DR=false}if(this.$7v.$DR){this.$F3.$FY(this.$7v.$8I,this.$7v.$8J)}this.$7g=a;this.$7h=c;this.$Htr=b};bxg.CImage.prototype.rotate=function(a){this.$F3.$HS(a)};bxg.CImage.prototype.resize=function(a,b){this.$F3.$HR(a,b);this.size.w=a;this.size.h=b;if(this.parent){if(this.active){this.move(this.parent.position().x,this.parent.position().y,this.parent.position().z)}}};bxg.CImage.prototype.setAlpha=function(a){this.$F3.$Htq(a)};bxg.CImage.prototype.getOuterRect=function(a){a=a||{};a.x=this.$7g+this.$F3.$HQ.x;a.y=this.$7h+this.$F3.$HQ.y;a.w=this.$F3.$HQ.w;a.h=this.$F3.$HQ.h;return a};bxg.CImage.prototype.$FQ=bxg.CObject.prototype.$FQ;bxg.CImage.prototype.setZindex=bxg.CObject.prototype.setZindex;bxg.CImage.prototype.$6v=function(b,a){this.control=b;this.active=true;if(bxg.$Hp){this.level=b}if(a!==undefined){this.$DF.baseLayer=this.$Htf=a}};bxg.CImage.prototype.$6w=function(a){this.active=false;if(bxg.$Hp){if(this.level){delete this.level}}this.$Htf=false;if(this.control){delete this.control}};bxg.CImage.prototype.isInBaseLayer=function(){if(this.$Htf){return true}else{return false}};bxg.CImage.prototype.getBaseLayer=function(){if(this.$Htf){return true}else{return false}};bxg.CImage.prototype.canSetBaseLayer=bxg.CObject.prototype.canSetBaseLayer;bxg.CImage.prototype.setBaseLayer=function(a){if(a===undefined){return false}if(bxg.$9I&bxg.$E7){bxg.Trace.log("BXG","warning","Not support baseLayer option in DOM or DOMcanvas renderer mode, type="+this.type,"CImage.setBaseLayer");return false}if(!this.control){return false}if(this.$DF.baseLayer===a){return false}if(a){this.$Htf=this.$DF.baseLayer=true}else{this.$Htf=this.$DF.baseLayer=false}if(this.$F3){if(this.control.$EM.$F7){this.control.$EM.$F7(this.$F3)}if(this.control.$EM.$F5){this.control.$EM.$F5(this.$F3,this.$Hto)}}return true};bxg.CImage.prototype.$HtW=bxg.CObject.prototype.$HtW;bxg.CCanvasImage=function(b,c){if(bx.inClassing){return}if(!b||!c){bxg.Trace.log("BXG","errorParameter","Invalid parameter render="+b+" or options="+c,"CCanvasImage()");return}if(!c.size){bxg.Trace.log("BXG","errorParameter","This property is mandatory: options.size","CCanvasImage()");return}this.$DF=c;this.type="bxg$typeCanvasObj";this.id=bxg.ObjectFactory.$Hl++;this.parent=null;this.control=null;if(bxg.$Hp){this.level=null}this.size=this.$DF.size;this.$FQ(this.$DF.zIndex);this.$DF.recycle=false;this.$7g=this.$7h=0;var a=0;if(this.$DF.baseLayer){a|=bxg.$7t}this.$F3=bxg.$E9.$7l({$GD:{$D9:1,$GZ:b,$D8:{object:this}},$GW:this.size,$D9:a,$F6:this.$DF.zIndex});this.$7Q=true};bx.$Inherit(bxg.CCanvasImage,bxg.CImage);bxg.CCanvasImage.prototype.update=function(){this.$F3.$HT()};bxg.CCanvasImage.prototype.rotate=function(a){bxg.Trace.log("BXG","warning","CCanvasImage.rotate() is not supported.","CCanvasImage.rotate")};bxg.CCanvasImage.prototype.setAlpha=function(a){bxg.Trace.log("BXG","warning","CCanvasImage.rotate() is not supported.","CCanvasImage.rotate")};bxg.$Ht1=function(b,a){if(bx.inClassing){return}this.$7q=b||{};this.$DF=a||{};this.$D3=[];if(this.$DF.speed===undefined){this.$DF.speed=1}this.$D2=this.$DF.speed;if(this.$DF.loop===undefined){this.$DF.loop=true}this.$AI=this.$DF.loop;this.$6P=-1;this.$7n()};bxg.$Ht1.prototype.$CT=function(){var b=0;var c;for(var a in this.$7q){if(!c){c=a}b++;if(b>1){break}}if(b>1){return true}else{if(b==1&&this.$7q[c].length>1){return true}else{return false}}};bxg.$Ht1.prototype.setSpeed=function(a){this.$DF.speed=this.$D2=a;return this};bxg.$Ht1.prototype.setLoop=function(a){this.$DF.loop=this.$AI=a;return this};bxg.$Ht1.prototype.$7n=function(b,a){if(!b){var c;for(c in this.$7q){b=c;break}if(!b){bxg.Trace.log("BXG","noProperty","no images and groups","CSprites.$7n");return}}if(this.$7q[b]&&this.$7q[b].length>0){if(this.$7w!=b||a){this.$D3.length=0;this.$7w=b;this.$72=-1;this.$AI=this.$DF.loop;this.$D2=this.$DF.speed;if(this.$7q[b].speed){this.$D2=this.$7q[b].speed}if(this.$7q[b].noLoop!==undefined){this.$AI=!this.$7q[b].noLoop}}}else{bxg.Trace.log("BXG","unknownSpriteGroup",b,"CSprites.$7n");this.$7w=null}return};bxg.$Ht1.prototype.$7x=function(a){return this.$7q[a]};bxg.$Ht1.prototype.$FR=function(){return this.$7w};bxg.$Ht1.prototype.$7r=function(){if(!this.$7w){return true}if(this.$72==this.$7q[this.$7w].length-1){return true}return false};bxg.$Ht1.prototype.$7k=function(){if(!this.$7w){bxg.Trace.log("BXG","unknownSpriteGroup","null","CSprites.CR");return bxg.$Ht1.prototype.$7k.$G6}this.$G7=(this.$72<0)?0:this.$72;if(this.$7q[this.$7w][this.$G7]){if(bxg.images){this.$G8=bxg.images[this.$7q[this.$7w][this.$G7]];if(this.$G8){return this.$G8}else{bxg.Trace.log("BXG","unknownImageId",this.$7q[this.$7w][this.$G7],"CSprites.CR")}}}else{bxg.Trace.log("BXG","unknownImageId",this.$7q[this.$7w][cur],"CSprites.CR")}return bxg.$Ht1.prototype.$7k.$G6};bxg.$Ht1.prototype.$7k.$G6=null;bxg.$Ht1.prototype.$7o=function(a){this.$D3.push(a)};bxg.$Ht1.prototype.$7D=function(a){if(!this.$7w){return this.$7k()}if((this.$6P+this.$D2)<=a){this.$AJ=1;if(this.$72==this.$7q[this.$7w].length-1){if(this.$D3.length>0){this.$BN=this.$D3.shift();this.$7n(this.$BN)}else{if(!this.$AI){this.$AJ=0}}}this.$72=(this.$72+this.$AJ)%this.$7q[this.$7w].length;this.$6P=a}return this.$7k()};bxg.WalkerLinear={};bxg.WalkerLinear.set=function(b,a){if(!b||!a){bxg.Trace.log("BXG","errorParameter","Invalid parameter obj="+b+" or options="+a,"bxg.WalkerLinear.set");return}if(isNaN(Number(a.radian))&&isNaN(Number(a.degree))&&!a.position){bxg.Trace.log("BXG","errorParameter","Parameter options requires property of radian or degree or position","bxg.WalkerLinear.set");return}if(a.distance!==undefined){a.speed=a.distance}if(isNaN(Number(a.speed))){bxg.Trace.log("BXG","errorParameter","Parameter options requires proper 'speed' property","bxg.WalkerLinear.set");return}b.data.$HtD=b.data.$HtD||{};b.data.$HtD.$Hg=a.interpolation;b.data.$HtD.$Hh=a.position;b.data.$HtD.$Hi=-1;if(a.position){a.radian=bxg.Geometry.getAngle(b.position(),a.position,true);b.data.$HtD.$Hj=bxg.Geometry.getDistance(b.position(),a.position);b.data.$HtD.$Hi=Math.floor(b.data.$HtD.$Hj/a.speed)}else{if(a.radian===undefined&&a.degree!==undefined){a.radian=bxg.Geometry.getDegToRad(a.degree)}}b.data.$HtD.$Hk=Math.sin(bx.$checkNaN(a.radian))*bx.$checkNaN(a.speed);b.data.$HtD.$Hn=-Math.cos(bx.$checkNaN(a.radian))*bx.$checkNaN(a.speed);if(a.player&&b.control&&b.control.level&&b.control.level.getTileMap){a.layer=b.control.level.getTileMap().$D5}if(a.layer&&b.control&&b.control.level&&b.control.level.getTileMap){b.setZindex(b.control.level.getTileMap().getZindex(a.layer,a.player?"player":"object"),true)}};bxg.WalkerLinear.move=function(a){if(a.data.$HtD.$Hh){if(a.data.$HtD.$Hi==0){if(a.$79&&a.$79.onWalkerEnd){a.$79.onWalkerEnd(a,bxg.game.$9J)}a.data.$HtD.$Hi--;return}else{if(a.data.$HtD.$Hi<0){return}else{if(a.data.$HtD.$Hi==1){a.data.$HtD.$Hk=a.data.$HtD.$Hh.x-a.position().x;a.data.$HtD.$Hn=a.data.$HtD.$Hh.y-a.position().y}}}}a.data.$HtD.$8D=false;if(a.data.$HtD.$Hg){a.data.$HtD.$8E=Math.sqrt(Math.pow(a.data.$HtD.$Hk,2)+Math.pow(a.data.$HtD.$Hn,2));a.data.$HtD.$8G=a.data.$HtD.$8G||{};a.data.$HtD.$8G.x=a.position().x;a.data.$HtD.$8G.y=a.position().y;while(a.data.$HtD.$8E>a.data.$HtD.$Hg){a.data.$HtD.$8E-=a.data.$HtD.$Hg;a.moveBy(Math.round(a.data.$HtD.$Hg*Math.sin(a.data.$HtD.radian)),Math.round(a.data.$HtD.$Hg*Math.cos(a.data.$HtD.radian)));a.$7E();a.data.$HtD.$8D=a.$9K(true);if(a.data.$HtD.$8D){break}}if(!a.data.$HtD.$8D){a.move(a.data.$HtD.$8G.x+a.data.$HtD.$Hk,a.data.$HtD.$8G.y+a.data.$HtD.$Hn)}}else{a.moveBy(a.data.$HtD.$Hk,a.data.$HtD.$Hn)}a.data.$HtD.$Hi--};bxg.WalkerParabolic2D={};bxg.WalkerParabolic2D.set=function(g,d,c){if(!d){bxg.Trace.log("BXG","noProperty","motion","bxg.WalkerParabolic2D.set");bxg.Trace.data(d);return}var e=0;var a=d.dTime||(bxg.game.tickInterval/1000)||0.1;var h=0;var f=0;var b=0;if(d.pxpy){if(isNaN(parseInt(d.pxpy.pX))||isNaN(parseInt(d.pxpy.pY))||isNaN(parseInt(d.pxpy.pT))||d.pxpy.pT<=0){bxg.Trace.log("BXG","noProperty","pX or pY or pT","bxg.WalkerParabolic2D.set");bxg.Trace.data(d.pxpy);return}d.pxpy.pX=parseInt(d.pxpy.pX);d.pxpy.pY=parseInt(d.pxpy.pY);d.pxpy.sX=bx.$checkNaN(parseInt(d.pxpy.sX));e=d.pxpy.sX/a;b=d.pxpy.pX/d.pxpy.pT;h=(2*d.pxpy.pY)/(d.pxpy.pT*d.pxpy.pT);f=d.pxpy.velocity!==undefined&&d.pxpy.velocity>=0?bx.$checkNaN(parseInt(d.pxpy.velocity)):h*d.pxpy.pT}else{if(d.va){if(isNaN(parseInt(d.va.velocity))||isNaN(parseInt(d.va.angle))){bxg.Trace.log("BXG","noProperty","velocity_angle","bxg.WalkerParabolic2D.set");bxg.Trace.data(d.va);return}h=d.va.gravity||9.8;h=2*h*9.8;b=d.va.velocity*Math.cos(((360-d.va.angle+90)*Math.PI)/180)*a;f=d.va.velocity*Math.sin(((360-d.va.angle+90)*Math.PI)/180)}else{if(d.vydx){if(isNaN(parseInt(d.vydx.velocity))){bxg.Trace.log("BXG","noProperty","velocity_deltax","bxg.WalkerParabolic2D.set");bxg.Trace.data(d.vydx);return}b=bx.$checkNaN(parseInt(d.vydx.dX));h=d.vydx.gravity||9.8;h=2*h*9.8;f=d.vydx.velocity}else{b=bx.$checkNaN(parseInt(d.dX));h=d.gravity||9.8;h=2*h*9.8;f=d.velocity||0}}}g.data.$HtE=g.data.$HtE||{motion:{}};g.data.$HtE.motion.velocity=f;g.data.$HtE.motion.gravity=h;g.data.$HtE.motion.dX=b;g.data.$HtE.motion.dTime=a;g.data.$HtE.$75=e;g.data.$HtE.$C6=0;g.data.$HtE.$C7=0;g.data.$HtE.$Hs6=c;return};bxg.WalkerParabolic2D.move=function(b,a){b.data.$HtE.$C6=b.data.$HtE.motion.velocity*b.data.$HtE.$75-0.5*b.data.$HtE.motion.gravity*b.data.$HtE.$75*b.data.$HtE.$75;b.data.$HtE.$92=-Math.floor(b.data.$HtE.$C6-b.data.$HtE.$C7);if(b.data.$HtE.$Hs6){b.data.$HtE.$Hs6.x=0;b.data.$HtE.$Hs6.y=0}if(a&&a.collision==0){if(b.data.$HtE.$92<0||(b.data.$HtE.$75&&b.data.$HtE.$92==0)){if(b.$79&&b.$79.onWalkerEnd){b.$79.onWalkerEnd(b,bxg.game.$9J)}return}}else{if(a&&a.collision==4){if(b.data.$HtE.$92>0||(b.data.$HtE.$75&&b.data.$HtE.$92==0)){if(b.$79&&b.$79.onWalkerEnd){b.$79.onWalkerEnd(b,bxg.game.$9J)}return}}}if(a&&a.collision==2){if(b.data.$HtE.motion.dX<0){b.data.$HtE.motion.dX=0}}else{if(a&&a.collision==6){if(b.data.$HtE.motion.dX>0){b.data.$HtE.motion.dX=0}}}b.data.$HtE.$C7=b.data.$HtE.$C6;b.data.$HtE.$75+=b.data.$HtE.motion.dTime;if(b.data.$HtE.$Hs6){b.data.$HtE.$Hs6.x=b.data.$HtE.motion.dX;b.data.$HtE.$Hs6.y=b.data.$HtE.$92}else{b.moveBy(b.data.$HtE.motion.dX,b.data.$HtE.$92)}};bxg.WalkerTweener={};bxg.WalkerTweener.set=function(b,a){if(!b||!a){bxg.Trace.log("BXG","errorParameter","Invalid parameter obj="+b+" or options="+a,"bxg.WalkerTweener.set");return}if(!a.timing||!(a.timing instanceof Function)){bxg.Trace.log("BXG","errorParameter","It must be function in bxg.Easing{}, options.timing="+a.timing,"bxg.WalkerTweener.set");return}if(!a.position||!a.time){bxg.Trace.log("BXG","errorParameter","options.position="+a.position+", options.time="+a.time,"bxg.WalkerTweener.set");return}b.data.$Htu=b.data.$Htu||{};b.data.$Htu.$5p=a;b.data.$Htu.$7D=0;b.data.$Htu.$Hj=bxg.Geometry.getDistance(b.position(),b.data.$Htu.$5p.position);b.data.$Htu.$Hu0=bxg.Geometry.getAngle(b.position(),a.position,true);b.data.$Htu.$7g=b.position().x;b.data.$Htu.$7h=b.position().y};bxg.WalkerTweener.move=function(a){if(!a.data.$Htu){bxg.Trace.log("BXG","error","WalkerTweener is not properly setup","bxg.WalkerTweener.move");if(a.$79&&a.$79.onWalkerEnd){a.$79.onWalkerEnd(a,bxg.game.$9J)}return}a.data.$Htu.$7D++;if(a.data.$Htu.$7D>=a.data.$Htu.$5p.time){if(a.data.$Htu.$5p.roundTrip){a.move(a.data.$Htu.$7g,a.data.$Htu.$7h)}else{a.move(a.data.$Htu.$5p.position.x,a.data.$Htu.$5p.position.y)}if(a.$79&&a.$79.onWalkerEnd){a.$79.onWalkerEnd(a,bxg.game.$9J)}}else{if(a.data.$Htu.$5p.roundTrip){a.data.$Htu.$4F=a.data.$Htu.$5p.timing(a.data.$Htu.$7D,0,a.data.$Htu.$Hj*2,a.data.$Htu.$5p.time);if(a.data.$Htu.$7D>a.data.$Htu.$5p.time/2){a.data.$Htu.$4F=a.data.$Htu.$Hj*2-a.data.$Htu.$4F}}else{a.data.$Htu.$4F=a.data.$Htu.$5p.timing(a.data.$Htu.$7D,0,a.data.$Htu.$Hj,a.data.$Htu.$5p.time)}a.move(a.data.$Htu.$7g+a.data.$Htu.$4F*Math.sin(a.data.$Htu.$Hu0),a.data.$Htu.$7h-a.data.$Htu.$4F*Math.cos(a.data.$Htu.$Hu0))}};bxg.WalkerTweener.isMoving=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","obj="+a,"WalkerTileMap.isMoving");return false}if(a.data.$Htu){if(a.data.$Htu.$7D>0&&a.data.$Htu.$7D<a.data.$Htu.$5p.time){return true}return false}else{return false}};bxg.CInputDevice=function(b,a){if(bx.inClassing){return}this.$DF=a||{};this.$6F={};if(b){for(var c in b){this.$6F[c]={};if(b[c]!="event"&&b[c]!="polling"){bxg.Trace.log("BXG","errorParameter","Invalid event type for map["+c+"]="+b[c],"bxg.CInputDevice");return}this.$6F[c].type=b[c]}}this.$6G=false};bxg.CInputDevice.prototype.$6M=function(a){if(this.$6G){return this.$6F}else{return null}};bxg.CInputDevice.prototype.$6N=function(a){if(this.$6G){this.$6G=false;for(var b in this.$6F){if(this.$6F[b].type=="event"){this.$6F[b].status="off";this.$6F[b].fired=false}else{if(this.$6F[b].type=="polling"&&this.$6F[b].fired){this.$6G=true}}}}};bxg.CInputDevice.prototype.$6L=function(a){if(!this.$DF.multi){for(var b in this.$6F){if(this.$6F[b].type=="polling"){this.$6F[b].status="off";this.$6F[b].fired=false;this.$6G=true}}}if(this.$6F[a]){this.$6F[a].status="on";this.$6F[a].fired=true;this.$6G=true}};bxg.CInputDevice.prototype.$6K=function(a){if(!this.$DF.multi){for(var b in this.$6F){if(this.$6F[b].type=="polling"){this.$6F[b].status="off";this.$6F[b].fired=false;this.$6G=true}}}else{this.$6F[a].status="off";this.$6F[a].fired=false}};bxg.CKeyDevice=function(a,e){if(bx.inClassing){return}if(!a||typeof a!="object"){bxg.Trace.log("BXG","errorParameter","Invalid eventmap="+a,"bxg.CKeyDevice");return}var d={};for(var f in a){d[f]=a[f].type}bxg.CInputDevice.call(this,d,e);this.$6H={"-1":"keyErrorIME","37":"keyLeft","39":"keyRight","38":"keyUp","40":"keyDown","32":"keySpace","65":"keyA","66":"keyB","67":"keyC","68":"keyD","69":"keyE","70":"keyF","71":"keyG","72":"keyH","73":"keyI","74":"keyJ","75":"keyK","76":"keyL","77":"keyM","78":"keyN","79":"keyO","80":"keyP","81":"keyQ","82":"keyR","83":"keyS","84":"keyT","85":"keyU","86":"keyV","87":"keyW","88":"keyX","89":"keyY","90":"keyZ"};this.$6I=a;var g=this;function c(h){if(!h){h=window.event}if(g.$Hu1==h.type&&g.$Ho==h.keyCode){return}g.$Hu1=h.type;if(h.keyCode==g.$Ho&&h.keyCode==229){g.$Ho=undefined;for(var i in g.$6I){if(g.$6I[i].key=="keyErrorIME"){g.$6L(i);break}}}else{g.$Ho=h.keyCode;if(g.$6H[String(h.keyCode)]){for(var i in g.$6I){if(g.$6I[i].key==g.$6H[String(h.keyCode)]){g.$6L(i);break}}}}}function b(h){if(!h){h=window.event}g.$Hu1=h.type;if(g.$6H[String(h.keyCode)]){for(var i in g.$6I){if(g.$6I[i].key==g.$6H[String(h.keyCode)]){g.$6K(i);break}}}}bx.Event.add(document,"keydown",c,false);bx.Event.add(document,"keyup",b,false)};bx.$Inherit(bxg.CKeyDevice,bxg.CInputDevice);bxg.CTapDevice=function(b,a){if(bx.inClassing){return}var c={};if(!b||typeof b!="object"){bxg.Trace.log("BXG","errorParameter","Invalid eventmap="+b,"bxg.CTapDevice");return}for(var e in b){c[e]=b[e].type}bxg.CInputDevice.call(this,c);this.$6J=b;this.$6T=a||bxg.playGround;var h=this;var g={x:0,y:0};function d(i){if(!i){i=window.event}g.x=i.targetTouches[0].clientX-bx.HCL.$0C(h.$6T);g.y=i.targetTouches[0].clientY-bx.HCL.$0D(h.$6T);h.$6L(h.$7y(g))}function f(i){if(!i){i=window.event}h.$6K(h.$7y(g))}bx.Event.add(this.$6T,"touchstart",d,false);bx.Event.add(this.$6T,"touchend",f,false);bx.Event.add(this.$6T,"touchcancel",f,false)};bx.$Inherit(bxg.CTapDevice,bxg.CInputDevice);bxg.CTapDevice.prototype.$7y=function(a){for(var b in this.$6J){if(bxg.Geometry.intersect_point_rect(a,this.$6J[b].area)){return b}}};bxg.CAccelerometerDevice=function(a,c){if(bx.inClassing){return}var b={};for(var d in a){b[d]=a[d].type}bxg.CInputDevice.call(this,b,c);this.$93=a};bx.$Inherit(bxg.CAccelerometerDevice,bxg.CInputDevice);bxg.CAccelerometerDevice.prototype.$6M=function(a){var d=this;function b(e){d.$94=e}function c(){}bxg.g.bxgAccelerometer=bxg.g.bxgAccelerometer||new bx.Accelerometer({layer:{api:bx.OEM.detectLayer()}});if(bxg.g.bxgAccelerometer.isSupport){bxg.g.bxgAccelerometer.getCurrentAcceleration(b,c)}if(this.$94){for(this.$95 in this.$93){if(this.$93[this.$95].x&&this.$93[this.$95].x.min!==undefined&&this.$93[this.$95].x.max!==undefined){if(this.$94.x>this.$93[this.$95].x.min&&this.$94.x<this.$93[this.$95].x.max){this.$6L(this.$95)}else{this.$6K(this.$95)}}else{if(this.$93[this.$95].y&&this.$93[this.$95].y.min!==undefined&&this.$93[this.$95].y.max!==undefined){if(this.$94.y>this.$93[this.$95].y.min&&this.$94.y<this.$93[this.$95].y.max){this.$6L(this.$95)}else{this.$6K(this.$95)}}}}}return bxg.CInputDevice.prototype.$6M.call(this,a)};bxg.CAccelerometerDevice.prototype.$6N=function(a){bxg.CInputDevice.prototype.$6N.call(this,a)};bxg.CSound=function(b,g,d,f,a){if(bx.inClassing){return}this.$96=b;this.$97=null;if(g&&typeof g=="object"){var e=g;this.$73=e.duration||0;if(e.type===undefined){this.$AU="sound"}else{this.$AU=e.type}if(e.channel){this.$AV=e.channel}if(e.looping){this.$AI=e.looping}}else{this.$73=g||0;if(d===undefined){this.$AU="sound"}else{this.$AU=d}if(f){this.$AV=f}if(a){this.$AI=a}}if(this.$AU!="sound"&&this.$AU!="stream"){bxg.Trace.log("BXG","errorParameter","type="+d,"CSound()")}if(window.Waper&&window.Waper.Media){this.$97=Waper.Media.open(this.$96)}else{if(bx.OEM.detectLayer()){bxg.$98=bxg.$98||new bx.Audio({layer:{api:bx.OEM.detectLayer()}})}else{if(window.Audio){bxg.$98=bxg.$98||new bx.Audio({layer:{api:"google"}})}}if(bxg.$98&&bxg.$98.isSupport){if(this.$AU=="stream"&&bxg.$98.supportChannel("$2E")){this.$HuG=1;var h=this;function c(i,j){h.$HuG=2;if(h.inPlayBGM()){h.stop();h.playBGM()}}this.$97=bxg.$98.load(this.$96,{type:this.$AU,looping:this.$AI,onLoad:c})}else{this.$97=bxg.$98.load(this.$96,{type:this.$AU,looping:this.$AI})}}}};bxg.CSound.prototype.$AW=function(a){if(!a||!a.isSupport){return false}if(!this.$AV){return true}else{if(a.supportChannel(this.$AU)>=this.$AV){return true}}bxg.Trace.log("BXG","debug","CSound skipped by channel="+this.$AV,"bxg.CSound");return false};bxg.CSound.prototype.$AX=function(a){if(!a||!a.isSupport){return false}if(a.supportChannel("looping")){return true}return false};bxg.CSound.prototype.playBGM=function(){if(!this.$97){return}if(this.$Hu4){return}this.$Hu4=true;if(this.$HuG==1){return}if(this.$AX(bxg.$98)){this.play(true)}else{var b=this;function a(){if(bx.OEM.detectLayer()=="wac2"){b.$97.src=b.$96}b.play()}a();if(this.$73){this.$75=setInterval(a,this.$73)}}};bxg.CSound.prototype.inPlayBGM=function(){return this.$Hu4};bxg.CSound.prototype.play=function(a){if(!this.$97){return}if(this.$AI){a=true}if(window.Waper&&window.Waper.Media){Waper.Media.play(this.$97)}else{if(this.$AW(bxg.$98)){if(bxg.$98){bxg.$98.play(this.$97,a?{looping:true}:undefined)}}}};bxg.CSound.prototype.stop=function(){if(!this.$97){return}if(window.Waper&&window.Waper.Media){Waper.Media.pause(this.$97)}else{if(this.$AW(bxg.$98)){if(bxg.$98){bxg.$98.stop(this.$97)}}}if(this.$75!==undefined){clearInterval(this.$75);delete this.$75}this.$Hu4=false};bxg.CSound.prototype.setSpeed=function(a){if(!this.$97){return}if(bxg.$98){bxg.$98.setSpeed(this.$97,a)}};bxg.ObjectFactory={$Hl:1};bxg.ObjectFactory.$7C=function(){if(this.$E2){delete this.$E2}this.$E2={}};bxg.ObjectFactory.register=function(b,e,d){if(b.id&&!b.type){b.type=b.id}if(!b.type){bxg.Trace.log("BXG","noProperty","type="+b.type,"ObjectFactory.register");return false}if(!b.info&&!b.factory){bxg.Trace.log("BXG","noProperty","Object type="+b.type+" info="+b.info+",factory="+b.factory,"ObjectFactory.register");return false}if(bxg.$6c[b.type]){if(!d){bxg.Trace.log("BXG","warnObjectTypeExist",b.type,"ObjectFactory.register")}return false}bxg.$6c[b.type]=b;bxg.$6c[b.type].$Hu5={b:0,be:0,br:0};if(b.options){if(b.options.manager){b.manager=b.options.manager}}if(typeof b.manager=="string"){if(bxg.objectMgrs[b.manager]){b.manager=bxg.objectMgrs[b.manager]}else{bxg.Trace.log("BXG","unknownObjectMgr",b.manager,"ObjectFactory.register");b.manager=null}}if(e){if(!b.imagePath){b.imagePath=bxg.module.$B2()+"imgs/"+b.type}}if(b.className=="bxg.CImage"){b.images={};b.images[b.type]={url:b.info}}if(b.images){if(b.imagePath&&bxg.$C9){b.imagePath=bxg.module.applyPath(bxg.$C9,b.imagePath)}else{if(!b.imagePath&&bxg.$C9){b.imagePath=bxg.$C9+"/imgs/"+b.type}}var c={};for(var a in b.images){if(b.imagePath&&b.images[a].url.indexOf("data:")!=0&&b.images[a].url.indexOf("http:")!=0&&b.images[a].url.indexOf("https:")!=0&&b.images[a].url.indexOf("filesystem:")!=0&&b.images[a].url.indexOf("ftp:")!=0){b.images[a].url=b.imagePath+"/"+b.images[a].url}if(b.$Hd||b.factory){c[b.type+"_"+a]=b.images[a]}else{c[a]=b.images[a]}}b.images=c;delete b.imagePath}bxg.$6c[b.type].ref=0;return true};bxg.ObjectFactory.get=function(a){if(!bxg.$6c[a]){bxg.Trace.log("BXG","unknownObject",a,"ObjectFactory.get")}return bxg.$6c[a]};bxg.ObjectFactory.$HA=function(a){return bxg.$6c[a]};bxg.ObjectFactory.build=function(c,d,g,b){var f=bxg.ObjectFactory.get(c);if(!f){bxg.Trace.log("BXG","unknownObject",c,"ObjectFactory.build");return null}var e;if(f.factory){if(!(e=this.$E0(c))){e=f.factory(c,f.ref,d,g,{type:c});e.type=c}}else{if(g){b=g}if(!(e=this.$E0(c,f,d))){var h=bx.$copyObject({},f.options);bx.$copyObject(h,bx.$copyObject({},d));switch(f.className){case undefined:case"bxg.CObject":e=new bxg.CObject(c,f.info,h).create();e.type=c;break;case"bxg.CCompositeObject":e=new bxg.CCompositeObject(c,f.info,h).create();e.type=c;break;case"bxg.CImage":e=new bxg.CImage(c,h);break;default:bxg.Trace.log("BXG","unknownClass",f.className,"ObjectFactory.build");break}}}if(e){f.ref++;var a;if(f.configure){a=f.configure(e,f.ref)}else{if(f.config){a=f.config}}if(a){bx.$copyObject(e.data,a)}if(b){bx.$copyObject(e.data,b)}bxg.$6c[c].$Hu5.b++}else{bxg.$6c[c].$Hu5.be++}if(e){f.$H3=f.$9W||{w:e.size.w,h:e.size.h}}return e};bxg.ObjectFactory.intoNamespace=function(a,b){return a.type+"_"+b};bxg.ObjectFactory.load=function(c,d,e){if(typeof c=="string"){c=[c]}var f={};var a;for(var b=0;b<c.length;b++){if(!bxg.ObjectFactory.get(c[b])){continue}if(bxg.$6c[c[b]].images&&!bxg.$6c[c[b]].$B5){bxg.$6c[c[b]].$B5=true;for(a in bxg.$6c[c[b]].images){f[a]=bxg.$6c[c[b]].images[a]}}}bxg.imageLoader.load(f,d,e)};bxg.ObjectFactory.$FW=function(a){if(a&&a.type&&a.$DF.recycle){if(bxg.ObjectFactory.$HA(a.type)){if(!this.$E2[a.type]){this.$E2[a.type]=[]}this.$E2[a.type].push(a);return true}}return false};bxg.ObjectFactory.$E0=function(b,d,c){if(this.$E2[b]&&this.$E2[b].length){var e;if(d){if(d.className&&d.className=="bxg.CImage"){if(c&&c.pattern){return null}if(bxg.$9I==(bxg.$E8|bxg.$9I&bxg.$E7)&&c&&!c.baseLayer){return null}}else{if(bxg.$9I==(bxg.$E8|bxg.$9I&bxg.$E7)&&c&&c.baseLayer){return null}}}if(e=this.$E2[b].shift()){if(e.deactivate){e.deactivate()}if(d){var a=bx.$copyObject({},d.options);if(c){bx.$copyObject(a,bx.$copyObject({},c))}e.$DF=a;if(e.$Htd){e.$Htd()}if(e.$Htb){e.$Htb()}}e.$FV=false;if(e.$DY){e.$DY()}if(e.$7C){e.$7C()}}bxg.$6c[b].$Hu5.br++;return e}return null};bxg.Inspector={$DV:false,$E1:{LP:{fps:0}},};bxg.Inspector.RPT_OF=1;bxg.Inspector.RPT_RB=2;bxg.Inspector.RPT_LP=4;bxg.Inspector.$DW=function(){this.$E3=(new Date()).getTime();this.$E4=bxg.game.$9J};bxg.Inspector.$E5=function(){if(bxg.game&&this.$E3){bxg.Inspector.$E5.$E6=(new Date()).getTime()-this.$E3;if(bxg.Inspector.$E5.$E6>1000){bxg.Inspector.$E1.LP.fps=(bxg.game.$9J-bxg.Inspector.$E4)/(bxg.Inspector.$E5.$E6/1000)}if(bxg.Inspector.$E5.$E6>10000){bxg.Inspector.$DW()}}};bxg.Inspector.$DX=function(){this.$E3=0};bxg.Inspector.activate=function(){this.$DV=true};bxg.Inspector.$__reset=function(){this.$H5.$H6=null;this.$DX()};bxg.Inspector.report=function(a){if(!bxg.game){return}if(!a){a=bxg.Inspector.RPT_OF|bxg.Inspector.RPT_RB|bxg.Inspector.RPT_LP}if(a&bxg.Inspector.RPT_LP){this.$E5()}return this.$E1};bxg.Inspector.createConsole=function(c){if(!bxg.$6j){return null}if(!bxg.game){bxg.Trace.log("BXG","warning","BXG is not properly initialized yet.","Inspector.createConsole");return null}this.$Ht2=c||{dir:"vertical",consolePerformance:true};this.$Ht3=document.body.$TAG("DIV",{style:"position:absolute;top:2px;right:2px;z-index:10000;width:200px;color:#bbbbbb;border:outset 2px #cccccc;font-family:sans-serif;font-size:12px;"});if(!bx.HCL.DV.supportCanvas()){if(this.$Ht2.consolePerformanceFull){this.$Ht2.consolePerformanceFull=false;this.$Ht2.consolePerformance=true;bxg.Trace.log("BXG","warning","Cannot display full inspector console without HTML5 Canvas","Inspector.createConsole")}}if(this.$Ht2.consolePerformance||this.$Ht2.consolePerformanceFull){this.$Ht4=this.$Ht3.$TAG("DIV",{style:"background-color:#113311;border:inset 2px #cccccc;width:100%"},{boxSizing:"border-box"});this.$Ht5=this.$Ht4.$TAG("DIV",{style:"width:100%;height:20px;border-bottom:solid 1px #cccccc;padding:2px 2px 0px 2px;"},{boxSizing:"border-box"});if(this.$Ht2.consolePerformanceFull){this.$Ht6=this.$Ht4.$TAG("CANVAS",{},{width:"100%",height:"50px"});this.$Ht6.width=this.$Ht6.offsetWidth;this.$Ht6.height=this.$Ht6.offsetHeight;this.$Ht7=0}}if(this.$Ht2.consoleObjectFactory){this.$Htz=this.$Ht3.$TAG("DIV",{style:"background-color:#111133;border:inset 2px #cccccc;width:100%"},{boxSizing:"border-box"});var d="";d+='<select id="obj_list"><option value="bxg$none">Objects...</options>';for(var e in bxg.$6c){d+='<option value="'+e+'">'+e+"</options>"}d+="</select>";this.$Htz.innerHTML=d;this.$Hu6=this.$Htz.$TAG("DIV",{style:"width:100%;padding:2px;"},{boxSizing:"border-box"});var f=this;this.$Htz.$$("obj_list").onchange=function(){f.$Htz.$Hu7=(this.value=="bxg$none"?undefined:this.value)}}if(this.$Ht2.consoleRenderer){this.$Htv=this.$Ht3.$TAG("DIV",{style:"background-color:#331111;border:inset 2px #cccccc;width:100%"},{boxSizing:"border-box"});var d="";d+='<select id="ctl_list"><option value="bxg$none">Controls...</options>';for(var b=0;b<bxg.game.$6e.length;b++){d+='<option value="'+b+'">'+(bxg.game.$6e[b].name||"Unnamed")+"(Z-index:"+(parseInt(bxg.game.$6e[b].$DF.zIndex/(bxg.$9Y.$6b*bxg.$9Y.$EF))||0)+")</options>"}d+="</select>";this.$Htv.innerHTML=d;this.$Htw=this.$Htv.$TAG("DIV",{style:"width:100%;padding:2px;"},{boxSizing:"border-box"});this.$Htx=this.$Htv.$TAG("DIV",{style:"width:100%;padding:2px 2px 2px 12px;border:solid 1px #757575;display:none"},{boxSizing:"border-box"});var f=this;this.$Htv.$$("ctl_list").onchange=function(){f.$Htv.$Hty=(this.value=="bxg$none"?undefined:Number(this.value))};if(bxg.$E9&&bxg.$E9.$EQ){bxg.$E9.$EQ()}}var f=this;bxg.Inspector.$DW();function a(){f.$Ht8()}setInterval(a,2000);this.$DV=true;return this.$Ht3};bxg.Inspector.hideConsole=function(){if(this.$Ht3){this.$Ht3.style.display="none";this.$DV=false}else{bxg.Trace.log("BXG","warning","Inspector console is not created yet","Inspector.hideConsole")}};bxg.Inspector.showConsole=function(){if(this.$Ht3){this.$Ht3.style.display="block";this.$DV=true}else{bxg.Trace.log("BXG","warning","Inspector console is not created yet","Inspector.showConsole")}};bxg.Inspector.$Ht8=function(){if(!this.$DV){return}if(this.$Ht5){this.$E5();this.$Ht5.innerHTML='<span style="color:#dddd00">'+Number(this.$E1.LP.fps).toFixed(1)+"</span>/"+Math.round(1000/bxg.game.tickInterval)+'fps R<span style="color:#00dddd">'+(this.$E1.LP.msOR||0)+'</span>ms C<span style="color:#00dd00">'+(this.$E1.LP.msICC||0)+"</span>ms"}if(this.$Ht6){this.$HtF=this.$HtF||{$HtG:null};var a=this.$Ht6.getContext("2d");a.lineWidth=1;if(this.$Ht7>this.$Ht6.width-1){this.$Ht7=0}if(this.$Ht7==0){a.clearRect(0,0,this.$Ht6.width,this.$Ht6.height);a.beginPath();a.strokeStyle="#dddd00";a.moveTo(0,parseInt(this.$Ht6.height*(1-0.7))+0.5);a.lineTo(this.$Ht6.width,parseInt(this.$Ht6.height*(1-0.7))+0.5);a.stroke()}var e=this.$Ht6.height*0.7-(this.$Ht6.height*0.7)*(this.$E1.LP.fps/(1000/bxg.game.tickInterval));a.beginPath();if(e<-1){a.strokeStyle="#ff4444";a.moveTo(this.$Ht7+0.5,this.$Ht6.height*(1-0.7)+e);a.lineTo(this.$Ht7+0.5,this.$Ht6.height*(1-0.7))}else{if(e>1){a.strokeStyle="#4444ff";a.moveTo(this.$Ht7+0.5,this.$Ht6.height*(1-0.7)+1);a.lineTo(this.$Ht7+0.5,this.$Ht6.height*(1-0.7)+e)}}a.stroke();if(this.$E1.LP.msOR){var f=this.$E1.LP.msOR/(this.$E1.LP.msOR+this.$E1.LP.msICC);a.beginPath();a.strokeStyle="#00dddd";if(this.$HtF.$HtG!==null){a.moveTo(this.$Ht7-1+0.5,parseInt(this.$Ht6.height-this.$Ht6.height*0.4*this.$HtF.$HtG)+0.5)}else{a.moveTo(this.$Ht7+0.5,parseInt(this.$Ht6.height-this.$Ht6.height*0.4*f)+0.5)}a.lineTo(this.$Ht7+0.5,parseInt(this.$Ht6.height-this.$Ht6.height*0.4*f)+0.5);a.stroke();this.$HtF.$HtG=f}this.$Ht7++}if(this.$Htz){if(this.$Htz.$Hu7&&bxg.$6c[this.$Htz.$Hu7]){this.$Hu6.innerHTML="B("+bxg.$6c[this.$Htz.$Hu7].$Hu5.b+")-R("+bxg.$6c[this.$Htz.$Hu7].$Hu5.br+")=O("+(bxg.$6c[this.$Htz.$Hu7].$Hu5.b-bxg.$6c[this.$Htz.$Hu7].$Hu5.br)+")<br/>RBn("+(bxg.ObjectFactory.$E2[this.$Htz.$Hu7]?bxg.ObjectFactory.$E2[this.$Htz.$Hu7].length:0)+') <span style="color:#ff5500">ER('+bxg.$6c[this.$Htz.$Hu7].$Hu5.be+")</span>"}else{if(this.$Hu6.innerHTML){this.$Hu6.innerHTML=""}}}if(this.$Htv){if(this.$Htv.$Hty!==undefined){if(bxg.game.$6e[this.$Htv.$Hty]){var b=bxg.game.$6e[this.$Htv.$Hty].$EM.$HuH();var c="[";switch(b.t){case bxg.$EU:c+="Fixed";break;case bxg.$FI:c+="Scroll";break;case bxg.$7c:case bxg.$7d:case bxg.$7b:case bxg.$7e:c+="Scroll(1-Way buffered)";break;case bxg.$7a:case bxg.$6z:c+="Scroll(2-Way buffered)";break;case bxg.$6x:c+="Scroll(4-Way buffered)";break}c+="]&nbsp;Sp:"+(b.spC==-1?"N/A":b.spC)+"<br/>";if(b.$Hu8){this.$Htx.style.display="block";var d='<span style="font-weight:bold;text-decoration:underline;">Base-layer</span><br/>';d+="&nbsp;Sp:"+b.$Hu8.spC+"<br/>";if(b.$Hu8.bf){d+="&nbsp;Buffer:"+b.$Hu8.bfW+"x"+b.$Hu8.bfH+"&nbsp;R:"+Number(b.$Hu8.br/b.r).toFixed(3)}else{d+="&nbsp;Buffer:none"}this.$Htx.innerHTML=d}else{this.$Htx.style.display="none"}this.$Htw.innerHTML=c}else{}}else{if(this.$Htw.innerHTML){this.$Htw.innerHTML=""}}}};bxg.$GI=1;bxg.$EV=2;bxg.$FT=1;bxg.$7t=2;bxg.$7u=4;bxg.$6t=1;bxg.$6u=2;bxg.$EU=1;bxg.$FI=2;bxg.$7c=10;bxg.$7d=11;bxg.$7b=12;bxg.$7e=13;bxg.$7a=20;bxg.$6z=21;bxg.$6x=30;bxg.version="2.0.0";bxg.packageType="full";bxg.$Hp=false;bxg.CObjectPool=function(){this.objects=[]};bxg.CObjectPool.prototype.add=function(a){this.objects.push(a);return this};bxg.CObjectPool.prototype.searchFree=function(){for(var a=0;a<this.objects.length;a++){if(!this.objects[a].active){return this.objects[a]}}return null};bxg.CObjectPool.prototype.addToControl=function(c,a){if(this.$7R==c){return}this.$7R=c;for(var b=0;b<this.objects.length;b++){this.objects[b].deactivate();c.add(this.objects[b],a)}};bxg.CObjectPool.prototype.deactivate=function(){for(var a=0;a<this.objects.length;a++){this.objects[a].deactivate()}};bxg.Easing={};bxg.Easing.linear=function(e,a,g,f){return a+(g-a)*e/f};bxg.Easing.inQuad=function(e,a,g,f){return g*(e/=f)*e+a};bxg.Easing.outQuad=function(e,a,g,f){return e>f?g:(-g*(e/=f)*(e-2)+a)};bxg.Easing.inOutQuad=function(e,a,g,f){if(e>f){return g}if((e/=f/2)<1){return g/2*e*e+a}return -g/2*((--e)*(e-2)-1)+a};bxg.Easing.outInQuad=function(e,a,g,f){if(e<f/2){return bxg.Easing.outQuad(e*2,a,g/2,f)}return bxg.Easing.inQuad((e*2)-f,a+g/2,g/2,f)};bxg.Easing.inCubic=function(e,a,g,f){return g*(e/=f)*e*e+a};bxg.Easing.outCubic=function(e,a,g,f){return e>f?g:g*((e=e/f-1)*e*e+1)+a};bxg.Easing.inOutCubic=function(e,a,g,f){if(e>f){return g}if((e/=f/2)<1){return g/2*e*e*e+a}return g/2*((e-=2)*e*e+2)+a};bxg.Easing.outInCubic=function(e,a,g,f){if(e<f/2){return bxg.Easing.outCubic(e*2,a,g/2,f)}return bxg.Easing.inCubic((e*2)-f,a+g/2,g/2,f)};bxg.Easing.inQuart=function(e,a,g,f){return g*(e/=f)*e*e*e+a};bxg.Easing.outQuart=function(e,a,g,f){return e>f?g:-g*((e=e/f-1)*e*e*e-1)+a};bxg.Easing.inOutQuart=function(e,a,g,f){if(e>f){return g}if((e/=f/2)<1){return g/2*e*e*e*e+a}return -g/2*((e-=2)*e*e*e-2)+a};bxg.Easing.outInQuart=function(e,a,g,f){if(e<f/2){return bxg.Easing.outQuart(e*2,a,g/2,f)}return bxg.Easing.inQuart((e*2)-f,a+g/2,g/2,f)};bxg.Geometry={};bxg.Geometry.intersect_point_point=function(b,a){return(b.x==a.x)&&(b.y==a.y)};bxg.Geometry.intersect_point_rect=function(a,b){return(a.x>=b.x&&a.x<(b.x+b.w))&&(a.y>=b.y&&a.y<(b.y+b.h))};bxg.Geometry.intersect_rect_point=function(b,a){return bxg.Geometry.intersect_point_rect(a,b)};bxg.Geometry.intersect_point_circle=function(a,b){return((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y))<=b.r*b.r};bxg.Geometry.intersect_circle_point=function(b,a){return bxg.Geometry.intersect_point_circle(a,b)};bxg.Geometry.intersect_rect_rect=function(b,a){return(((b.x>=a.x&&b.x<(a.x+a.w))||(b.x<a.x&&(b.x+b.w)>a.x))&&((b.y>=a.y&&b.y<(a.y+a.h))||(b.y<a.y&&(b.y+b.h)>a.y)))};bxg.Geometry.intersect_rect_circle=function(a,b){bxg.Geometry.$7z=Math.abs(b.x-(a.x+a.w/2));bxg.Geometry.$8a=Math.abs(b.y-(a.y+a.h/2));if(bxg.Geometry.$7z>(a.w/2+b.r)){return false}if(bxg.Geometry.$8a>(a.h/2+b.r)){return false}if(bxg.Geometry.$7z<=(a.w/2)){return true}if(bxg.Geometry.$8a<=(a.h/2)){return true}return Math.pow(bxg.Geometry.$7z-a.w/2,2)+Math.pow(bxg.Geometry.$8a-a.h/2,2)<=Math.pow(b.r,2)};bxg.Geometry.intersect_circle_rect=function(b,a){return bxg.Geometry.intersect_rect_circle(a,b)};bxg.Geometry.intersect_circle_circle=function(b,a){if(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)<Math.pow(b.r+a.r,2)){return true}else{return false}};bxg.Geometry.intersect_line_line=function(d,b,c,a){bxg.Geometry.$Hs7=b.y-d.y;bxg.Geometry.$Hs8=d.x-b.x;bxg.Geometry.$Hs9=b.x*d.y-d.x*b.y;bxg.Geometry.$HsA=bxg.Geometry.$Hs7*c.x+bxg.Geometry.$Hs8*c.y+bxg.Geometry.$Hs9;bxg.Geometry.$HsF=bxg.Geometry.$Hs7*a.x+bxg.Geometry.$Hs8*a.y+bxg.Geometry.$Hs9;if(bxg.Geometry.$HsA!=0&&bxg.Geometry.$HsF!=0&&bxg.Geometry.$HsA*bxg.Geometry.$HsF>=0){return false}bxg.Geometry.$HsB=a.y-c.y;bxg.Geometry.$HsC=c.x-a.x;bxg.Geometry.$HsD=a.x*c.y-c.x*a.y;bxg.Geometry.$HsE=bxg.Geometry.$HsB*d.x+bxg.Geometry.$HsC*d.y+bxg.Geometry.$HsD;bxg.Geometry.$HsG=bxg.Geometry.$HsB*b.x+bxg.Geometry.$HsC*b.y+bxg.Geometry.$HsD;if(bxg.Geometry.$HsE!=0&&bxg.Geometry.$HsG!=0&&bxg.Geometry.$HsE*bxg.Geometry.$HsG>=0){return false}bxg.Geometry.$HsH=bxg.Geometry.$Hs7*bxg.Geometry.$HsC-bxg.Geometry.$HsB*bxg.Geometry.$Hs8;if(bxg.Geometry.$HsH==0){return false}return true};bxg.Geometry.intersect_line_circle=function(a,b){bxg.Geometry.$Hu9=a.pt2.x-a.pt1.x;bxg.Geometry.$HuA=a.pt2.y-a.pt1.y;bxg.Geometry.$HuB=b.x-a.pt1.x;bxg.Geometry.$HuC=b.y-a.pt1.y;bxg.Geometry.$HuD=false;bxg.Geometry.$HuE=false;if((bxg.Geometry.$HuC*bxg.Geometry.$Hu9-bxg.Geometry.$HuB*bxg.Geometry.$HuA)*(bxg.Geometry.$HuC*bxg.Geometry.$Hu9-bxg.Geometry.$HuB*bxg.Geometry.$HuA)<=b.r*b.r*(bxg.Geometry.$Hu9*bxg.Geometry.$Hu9+bxg.Geometry.$HuA*bxg.Geometry.$HuA)){if(bxg.Geometry.$HuB*bxg.Geometry.$HuB+bxg.Geometry.$HuC*bxg.Geometry.$HuC<=b.r*b.r){bxg.Geometry.$HuD=true;return true}if((bxg.Geometry.$Hu9-bxg.Geometry.$HuB)*(bxg.Geometry.$Hu9-bxg.Geometry.$HuB)+(bxg.Geometry.$HuA-bxg.Geometry.$HuC)*(bxg.Geometry.$HuA-bxg.Geometry.$HuC)<=b.r*b.r){bxg.Geometry.$HuE=true;return true}if(!bxg.Geometry.$HuD&&!bxg.Geometry.$HuE&&bxg.Geometry.$HuB*bxg.Geometry.$Hu9+bxg.Geometry.$HuC*bxg.Geometry.$HuA>=0&&bxg.Geometry.$HuB*bxg.Geometry.$Hu9+bxg.Geometry.$HuC*bxg.Geometry.$HuA<=bxg.Geometry.$Hu9*bxg.Geometry.$Hu9+bxg.Geometry.$HuA*bxg.Geometry.$HuA){return true}}return false};bxg.CObject.$G0={point_point:bxg.Geometry.intersect_point_point,point_rect:bxg.Geometry.intersect_point_rect,rect_point:bxg.Geometry.intersect_rect_point,point_circle:bxg.Geometry.intersect_point_circle,circle_point:bxg.Geometry.intersect_circle_point,rect_rect:bxg.Geometry.intersect_rect_rect,rect_circle:bxg.Geometry.intersect_rect_circle,circle_rect:bxg.Geometry.intersect_circle_rect,circle_circle:bxg.Geometry.intersect_circle_circle};bxg.Geometry.collision_circle_circle=function(c,b,a){a=a||{};a.dist=Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2));if(a.dist<c.r+b.r){return true}else{return false}};bxg.Geometry.getAngle=function(b,a,c){if(c){return(Math.atan2(a.x-b.x,b.y-a.y)+2*Math.PI)%(2*Math.PI)}else{return bxg.Geometry.getRadToDeg((Math.atan2(a.x-b.x,b.y-a.y)+2*Math.PI)%(2*Math.PI))}};bxg.Geometry.getDegToRad=function(a){return a*Math.PI/180};bxg.Geometry.getRadToDeg=function(a){return a*180/Math.PI};bxg.Geometry.getDistance=function(b,a){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))};bxg.Geometry.$HP=function(e,d,b){b=b||{};b.x=b.y=0;b.w=0;b.h=0;var a,g,c,f;c=Math.sin(-d*2*Math.PI/360);f=Math.cos(-d*2*Math.PI/360);a=f*(-e.w/2)-c*(-e.h/2);g=c*(-e.w/2)+f*(-e.h/2);if(a<b.x){b.x=a}if(a>b.w){b.w=a}if(g<b.y){b.y=g}if(g>b.h){b.h=g}a=f*(e.w/2)-c*(-e.h/2);g=c*(e.w/2)+f*(-e.h/2);if(a<b.x){b.x=a}if(a>b.w){b.w=a}if(g<b.y){b.y=g}if(g>b.h){b.h=g}a=f*(-e.w/2)-c*(e.h/2);g=c*(-e.w/2)+f*(e.h/2);if(a<b.x){b.x=a}if(a>b.w){b.w=a}if(g<b.y){b.y=g}if(g>b.h){b.h=g}a=f*(e.w/2)-c*(e.h/2);g=c*(e.w/2)+f*(e.h/2);if(a<b.x){b.x=a}if(a>b.w){b.w=a}if(g<b.y){b.y=g}if(g>b.h){b.h=g}b.w=Math.round(b.w-b.x);b.h=Math.round(b.h-b.y);b.x=Math.round(b.x+e.w/2);b.y=Math.round(b.y+e.h/2);return b};bxg.Canvas=bxg.Canvas||{};bxg.Canvas.REFECT_X=1;bxg.Canvas.REFECT_Y=2;bxg.Canvas.LINE_CAP_BUTT=1;bxg.Canvas.LINE_CAP_ROUND=2;bxg.Canvas.LINE_CAP_SQUARE=3;bxg.Canvas.drawImage=function(b,g,a,i,c,e,d,f){if(b.bxgAcanvas){b.drawImage(g,a,i,c,e,d,f)}else{if(d||f){b.save();this.$HuI=(c!==undefined?c:g.width);this.$HuJ=(e!==undefined?e:g.height);if(d){b.translate(a+this.$HuI/2,i+this.$HuJ/2);b.rotate(d*Math.PI/180);b.drawImage(g,(-this.$HuI/2)|0,(-this.$HuJ/2)|0,this.$HuI|0,this.$HuJ|0)}else{if(f){if(f>0&&f<4){if((f&bxg.Canvas.REFECT_X)&&(f&bxg.Canvas.REFECT_Y)){f=180}else{if(f&bxg.Canvas.REFECT_Y){f=270}else{if(f&bxg.Canvas.REFECT_X){f=90}}}}if(f==90){b.setTransform(-1,0,0,1,a+this.$HuI,i)}else{if(f==180){b.setTransform(-1,0,0,-1,a+this.$HuI,i+this.$HuJ)}else{if(f==270){b.setTransform(1,0,0,-1,a,i+this.$HuJ)}else{b.setTransform(1,0,0,1,a,i)}}}b.drawImage(g,0,0,this.$HuI|0,this.$HuJ|0)}}b.restore()}else{if(c!==undefined&&e!==undefined){b.drawImage(g,a|0,i|0,c|0,e|0)}else{b.drawImage(g,a|0,i|0)}}}};bxg.Canvas.drawImagePattern=function(a,f,d,c,b,e){if(d||c){a.save();a.translate(d,c)}a.fillStyle=a.createPattern(f,"repeat");a.fillRect(0,0,b-d,e-c);if(d||c){a.restore()}};bxg.Canvas.pathBegin=function(a){if(!a.bxgAcanvas){bxg.Canvas.$HuK=true;a.beginPath()}};bxg.Canvas.pathEnd=function(a){if(!a.bxgAcanvas){a.stroke();bxg.Canvas.$HuK=false}};bxg.Canvas.drawLine=function(b,a,e,d,c){if(!b.bxgAcanvas){if(!bxg.Canvas.$HuK){b.beginPath()}b.moveTo(a+0.5,e+0.5);b.lineTo(d+0.5,c+0.5);if(!bxg.Canvas.$HuK){b.stroke()}}else{b.drawLine(a,e,d,c)}};bxg.Canvas.setStrokeStyle=function(d,h,f,c,e){if(!d.bxgAcanvas){d.$HuL=d.strokeStyle;if(e!==undefined){d.strokeStyle="rgba("+h+","+f+","+c+","+e+")"}else{d.strokeStyle="rgb("+h+","+f+","+c+")"}}else{d.$HuL=d.$HuL||{};d.$HuL.r=h;d.$HuL.g=f;d.$HuL.b=c;d.$HuL.a=e;d.setStrokeStyle(h,f,c,e)}};bxg.Canvas.setStrokeType=function(a,c,b){if(!a.bxgAcanvas){if(c){a.lineWidth=c}if(b){if(b==bxg.Canvas.LINE_CAP_BUTT){a.lineCap="butt"}else{if(b==bxg.Canvas.LINE_CAP_ROUND){a.lineCap="round"}else{if(b==bxg.Canvas.LINE_CAP_SQUARE){a.lineCap="square"}else{bxg.Trace.log("BXG","errorParameter","line cap="+b,"Canvas.setStrokeType")}}}}}else{a.setLine(c,b)}};bxg.Canvas.restoreStrokeStyle=function(a){if(!a.bxgAcanvas){if(a.$HuL){a.strokeStyle=a.$HuL}}else{if(a.$HuL){a.setStrokeStyle(a.$HuL.r,a.$HuL.g,a.$HuL.b,a.$HuL.a)}}};bxg.Trace=new bx.CTrace();bxg.Trace.error={debug:{$AZ:1001,$B0:""},warning:{$AZ:2001,$B0:""},warnEmptyArray:{$AZ:2002,$B0:"Empty array is iterated"},warnDeviceCapability:{$AZ:2003,$B0:"Device doesn't support this function"},warnInvalidState:{$AZ:5008,$B0:"Can't perform work for invalid state:"},warnObjectNoControl:{$AZ:2101,$B0:"Object(not belongs to any CControl) is tried to "},warnObjectTypeExist:{$AZ:2102,$B0:"Already existed Object type is tried to register"},warnObjectUnloaded:{$AZ:2103,$B0:"Unloaded object is tried to activate"},warnAddToTile:{$AZ:2104,$B0:"Fail to add a tile:"},warnNoSprites:{$AZ:2105,$B0:"Object dose not have sprites."},error:{$AZ:5001,$B0:""},unknownClass:{$AZ:5002,$B0:"Unknown or errored Class is instantiated"},noProperty:{$AZ:5003,$B0:"Property is not properly setup"},emptyArrayError:{$AZ:5004,$B0:"Empty array is iterated"},errorParameter:{$AZ:5005,$B0:"Function parameter error"},unknownType:{$AZ:5006,$B0:"Unknown type is referenced"},errorRenderer:{$AZ:5007,$B0:"The current Rendering-mode does not support this module/function:"},errorInvalidState:{$AZ:5008,$B0:"Can't perform work for invalid state:"},unknownSpriteGroup:{$AZ:5101,$B0:"Unknown Sprite Group is referenced"},unknownObject:{$AZ:5102,$B0:"Unknown Object is referenced"},errorImage:{$AZ:5103,$B0:"Image file load failed"},unknownImageId:{$AZ:5104,$B0:"Unknown Image is referenced"},unknownObjectMgr:{$AZ:5105,$B0:"Unknown ObjectManager is referenced"},unknownMapData:{$AZ:5106,$B0:"Unknown MapData is referenced"},errorFringe:{$AZ:5108,$B0:"Missing fringe image"},unknownSpriteId:{$AZ:5109,$B0:"Unknown Sprite Id is referenced"},unknownTile:{$AZ:5110,$B0:"Unknown Tile is referenced"},errorTile:{$AZ:5111,$B0:"There is a problem in Tile data"},errorImport:{$AZ:5112,$B0:"File import is failed"},unknownLevelData:{$AZ:5113,$B0:"Unknown LevelData is referenced"},errorLevelData:{$AZ:5114,$B0:"Format error in LevelData"},noGameLoop:{$AZ:5115,$B0:"Gameloop is not created yet"},errorMapData:{$AZ:5116,$B0:"Format error in MapData"},emptySprite:{$AZ:5117,$B0:"Empty sprite"},errorNaN:{$AZ:5118,$B0:"Given value is not a valid number"}};if(bxg.$Hp){bxg.CObjectPool.prototype.getFree=bxg.CObjectPool.prototype.searchFree;bxg.CObjectPool.prototype.addToLevel=bxg.CObjectPool.prototype.addToControl;bxg.trace=bxg.Trace}bxg.$HuF=function(){if(bx.inClassing){return}};bxg.$HuF.prototype.$EC=function(a){};bxg.$HuF.prototype.$EG=function(){};bxg.$HuF.prototype.$EQ=function(){};bxg.$HuF.prototype.$7l=function(a){return new this.$EH(a)};bxg.$HuF.$8c=function(b,a){this.$8w=-1;for(this.$9S=0;this.$9S<b.length;this.$9S++){if(bx.$checkNaN(parseInt(a.$DF.$F6))<bx.$checkNaN(parseInt(b[this.$9S].$DF.$F6))){this.$8w=this.$9S;break}}if(this.$8w==-1){b.push(a)}else{b.splice(this.$8w,0,a)}};bxg.$HtN=function(){if(bx.inClassing){return}bxg.$HtP.call(this);this.$D9=bxg.$EV;this.$EZ=bxg.$HuM;this.$EH=bxg.$Htp};bx.$Inherit(bxg.$HtN,bxg.$HtP);bxg.$HtN.prototype.$EC=function(b,a){this.$DF=b||{};if((bxg.$9I&bxg.$E8)&&(bxg.$9I&bxg.$E7)){if(bx.HCL.$0a[1]=="chrome"){this.$HuN=true}}if(a){a(true)}};bxg.$HtN.prototype.$HtQ=function(){return};bxg.$HtN.prototype.$EG=function(){};bxg.$HtN.prototype.$7l=function(a){if(bxg.$9I&bxg.$E8&&a.$D9&bxg.$7t){return new bxg.$HuO(a)}return new bxg.$Htp(a)};bxg.$HtN.prototype.$HuP=function(a,b){return bxg.$HtP.prototype.$HuP.call(this,a,b)};bxg.$HtN.prototype.$HuQ=function(a){bxg.$HtP.prototype.$HuQ.call(this,a)};bxg.$HtN.prototype.$HuR=function(b,a,c){bxg.$HtP.prototype.$HuR.call(this,b,a,c)};bxg.$HtN.prototype.$HuS=function(i,e,d,f,b,g,k,j,a,c){bxg.$HtP.prototype.$HuS.call(this,i,e,d,f,b,g,k,j,a,c)};bxg.$Htp=function(a){if(bx.inClassing){return}this.$DF=a;this.$7g=this.$7h=0;this.$HQ={x:0,y:0,w:0,h:0};this.$HuT=false;if(this.$DF.$GD&&this.$DF.$GD.$D9==1){if(!(bxg.$9I&bxg.$E8)){this.$HuT=true}else{if(bxg.$9I&bxg.$E8&&bxg.$9I&bxg.$E7&&!(this.$DF.$D9&bxg.$7t)){this.$HuT=true}}}if(a.$G2){this.$FO=bx.DOM.overrideElement(a.$G2);this.$FO.style.position="absolute";if(this.$DF.$AZ){this.$FO.$A({name:this.$DF.$AZ})}}else{if(this.$HuT){this.$FO=bxg.buffer.$TAG("CANVAS",{width:this.$DF.$GW.w,height:this.$DF.$GW.h},{position:"absolute",display:"none"})}else{if(this.$DF.$D9&bxg.$7u){if(this.$DF.$GW){this.$FO=bxg.buffer.$TAG("DIV",this.$DF.$AZ?{name:this.$DF.$AZ}:null,{position:"absolute",display:"none"})}else{}}else{this.$FO=bxg.buffer.$TAG("IMG");this.$FO.style.position="absolute";this.$FO.style.display="none";if(this.$DF.$AZ){this.$FO.$A({name:this.$DF.$AZ})}}}}this.$FF(a.$GJ,true);this.$FQ(a.$F6);if(a.$GW){this.$HR(a.$GW.w,a.$GW.h)}this.$HS(a.$GK)};bxg.$Htp.prototype.$F1=function(){if(this.$FO){if(this.$FO.parentNode){this.$FO.parentNode.removeChild(this.$FO)}delete this.$FO}};bxg.$Htp.prototype.$Ht9=function(){return this.$HuT};bxg.$Htp.prototype.$FQ=function(a){this.$DF.$F6=a;if(this.$AP){if(bxg.$9I&bxg.$E8&&this.$DF.$D9&bxg.$7t){this.$AP.$8l.$HsL=true}}if(this.$FO){this.$FO.style.zIndex=a}this.$HT()};bxg.$Htp.prototype.$HR=function(a,b){bxg.$HuO.prototype.$HR.call(this,a,b);if(this.$FO){if(this.$DF.$GW){this.$FO.style.width=Math.round(this.$HQ.w)+"px";this.$FO.style.height=Math.round(this.$HQ.h)+"px"}}};bxg.$Htp.prototype.$HS=function(a){if(!bxg.$HuO.prototype.$HS.call(this,a)){return false}if(this.$FO){if(bx.HCL.DV.supportCSS3()){this.$FO.$CSS({transform:"rotateZ("+this.$DF.$GK+"deg)"})}else{bxg.Trace.log("BXG","warnDeviceCapability","CSS3","RD.SP")}}return true};bxg.$Htp.prototype.$FF=function(b,a){if(!bxg.$HuO.prototype.$FF.call(this,b,a)){return false}if(!this.$FO){return true}if(b.position){bxg.$Htp.prototype.$FF.$GO=b.position.x+"px "+b.position.y+"px";if(!this.$FH){this.$FO.src=bx.c.bx$nullImage}if(!this.$FH||(this.$HuV!=b.size.w)||(this.$HuW!=b.size.h)){this.$FO.style.width=b.size.w+"px";this.$FO.style.height=b.size.h+"px";this.$HuV=b.size.w;this.$HuW=b.size.h}if(!this.$FH||this.$GM!=b.url){this.$FO.style.backgroundImage="url('"+b.url+"')";this.$GM=b.url}if(!this.$FH||this.$GN!=bxg.$Htp.prototype.$FF.$GO){this.$FO.style.backgroundPosition=bxg.$Htp.prototype.$FF.$GO;this.$GN=bxg.$Htp.prototype.$FF.$GO;if(this.$AP&&this.$AP.$E9){if(this.$AP.$E9.$HuN){this.$FO.style.right="0px"}}}this.$FH=true}else{if(this.$DF.$D9&bxg.$7u){this.$FO.style.backgroundImage="url("+this.$DF.$GJ.url+")"}else{this.$FO.src=b.url;if(this.$FH){this.$FO.style.width="auto";this.$FO.style.height="auto";this.$FO.style.backgroundImage="none";this.$FH=this.$GN=this.$GM=this.$HuV=this.$HuW=undefined}}}this.$HuX=this.$HuX||{};if(b.opacity!==undefined||this.$DF.$HuY!==undefined){if(this.$DF.$HuY!==undefined){this.$HuX.opacity=this.$DF.$HuY}else{this.$HuX.opacity=b.opacity}this.$FO.$CSS(this.$HuX)}else{if(this.$FO.style.opacity!=1){this.$HuX.opacity=1;this.$FO.$CSS(this.$HuX)}}return true};bxg.$Htp.prototype.$Htq=function(a){bxg.$HuO.prototype.$Htq.call(this,a);if(this.$FO){this.$HuX=this.$HuX||{};this.$HuX.opacity=this.$DF.$HuY;this.$FO.$CSS(this.$HuX)}};bxg.$Htp.prototype.$FY=function(a,b){this.$7g=a;this.$7h=b;if(this.$FO){if(this.$AP&&this.$AP.$DF.$FL){}this.$FO.style.left=Math.round(this.$7g)+"px";this.$FO.style.top=Math.round(this.$7h)+"px"}};bxg.$Htp.prototype.$HT=function(){if(this.$Ht9()){this.$6G=true}bxg.$HuO.prototype.$HT.call(this)};bxg.$Htp.prototype.$HsJ=function(){return bxg.$HuO.prototype.$HsJ.call(this)};bxg.$Htp.prototype.$F4=function(a){if(this.$DV==a){return}if(this.$FO){if(a){this.$FO.style.display="block"}else{this.$FO.style.display="none"}}if(!(bxg.$9I&bxg.$E8)){if(this.$DF.$D9&bxg.$7u&&!this.$FO){if(this.$AP){switch(this.$AP.$DF.$D9){case bxg.$7c:case bxg.$7d:case bxg.$7b:case bxg.$7e:if(this.$AP.$DF.$FL){if(a){if(this.$AP.$DF.$FL.$6Z[0]){this.$AP.$DF.$FL.$6Z[0].style.backgroundImage="url("+this.$DF.$GJ.url+")";this.$AP.$DF.$FL.$6Z[0].$9v={w:this.$DF.$GJ.w,h:this.$DF.$GJ.h}}if(this.$AP.$DF.$FL.$6Z[1]){this.$AP.$DF.$FL.$6Z[1].style.backgroundImage="url("+this.$DF.$GJ.url+")";this.$AP.$DF.$FL.$6Z[1].$9v={w:this.$DF.$GJ.w,h:this.$DF.$GJ.h}}}else{if(this.$AP.$DF.$FL.$6Z[0]){this.$AP.$DF.$FL.$6Z[0].style.backgroundImage="";if(this.$AP.$DF.$FL.$6Z[0].$9v){delete this.$AP.$DF.$FL.$6Z[0].$9v}}if(this.$AP.$DF.$FL.$6Z[1]){this.$AP.$DF.$FL.$6Z[1].style.backgroundImage="";if(this.$AP.$DF.$FL.$6Z[1].$9v){delete this.$AP.$DF.$FL.$6Z[1].$9v}}}}break;default:if(a){this.$AP.$7J.style.backgroundImage="url("+this.$DF.$GJ.url+")"}else{this.$AP.$7J.style.backgroundImage=""}break}}}}bxg.$HuO.prototype.$F4.call(this,a)};bxg.$HuM=function(a){if(!a||!a.$D9||!a.$GF||!a.$Hr){bxg.Trace.log("BXG","errorParameter","invalid options","rDOM.LR");return}this.$DF=a;this.$9w=false};bxg.$HuM.prototype.$F0=function(a){this.$E9=a;this.$7J=this.$DF.$EX;switch(this.$DF.$D9){case bxg.$FI:case bxg.$7a:case bxg.$6z:case bxg.$6x:this.$7J=this.$DF.$EX.$TAG("div",{},{zIndex:this.$DF.$F6+1,position:"absolute",left:"0px",top:"0px",width:this.$DF.$GF.w+"px",height:this.$DF.$GF.h+"px"});break;case bxg.$7c:case bxg.$7d:case bxg.$7b:case bxg.$7e:break}this.$8g=0;this.$8j=0;this.$8h=this.$8g;this.$8i=this.$8j;this.$8k=false;this.$8l=[];if((this.$7J!=this.$DF.$EX)&&!(this.$DF.$6r&bxg.$6t)){this.$HsK=true}this.$E1=this.$E1||{run:false,r:0,_aLayer:{}}};bxg.$HuM.prototype.$F1=function(){if(this.$GA){this.$GA.parentNode.removeChild(this.$GA);delete this.$GA;delete this.$8m}if(this.$7J!=this.$DF.$EX){this.$7J.parentNode.removeChild(this.$7J);delete this.$7J}delete this.$8l};bxg.$HuM.prototype.$HT=function(a){bxg.$HuZ.prototype.$HT.call(this,a)};bxg.$HuM.prototype.$FJ=function(a){bxg.$HuZ.prototype.$FJ.call(this,a);if(this.$7J!=this.$DF.$EX){this.$7J.style.width=Math.round(this.$DF.$GF.w)+"px";this.$7J.style.height=Math.round(this.$DF.$GF.h)+"px"}if(this.$GA){this.$GA.width=this.$DF.$GF.w;this.$GA.height=this.$DF.$GF.h}};bxg.$HuM.prototype.$CM=function(a,b){if(this.$HsK){if(a===undefined&&b===undefined){return}if(a==this.$8g&&b==this.$8j){return}if(a!==undefined){this.$8h=this.$8g;this.$8g=a}if(b!==undefined){this.$8i=this.$8j;this.$8j=b}}else{bxg.$HuZ.prototype.$CM.call(this,a,b);this.$8n=true}if(this.$7J!=this.$DF.$EX){if(this.$8g-this.$8h){this.$7J.style.left=Math.round(this.$8g)+"px"}if(this.$8j-this.$8i){this.$7J.style.top=Math.round(this.$8j)+"px"}}};bxg.$HuM.prototype.$GV=function(b,a){bxg.$HuZ.prototype.$GV.call(this,b,true)};bxg.$HuM.prototype.$EK=function(){switch(this.$DF.$D9){case bxg.$FI:case bxg.$7a:case bxg.$6z:case bxg.$6x:if(this.$8g-this.$8h){this.$7J.style.left=Math.round(this.$8g)+"px"}if(this.$8j-this.$8i){this.$7J.style.top=Math.round(this.$8j)+"px"}break;case bxg.$7c:case bxg.$7d:case bxg.$7b:case bxg.$7e:if(this.$DF.$FL&&this.$DF.$FL.$7i){this.$DF.$FL.$7i()}break}if(this.$HtA){for(this.$9S=0;this.$9S<this.$HtA.length;this.$9S++){if(this.$HtA[this.$9S].$Ht9()){if(this.$HtA[this.$9S].$6G===undefined||this.$HtA[this.$9S].$6G){this.$HtA[this.$9S].$DF.$GD.$D8=this.$HtA[this.$9S].$DF.$GD.$D8||{};this.$HtA[this.$9S].$DF.$GD.$D8.area=this.$HtA[this.$9S].$DF.$GD.$D8.area||{};this.$HtA[this.$9S].$DF.$GD.$D8.area.x=0;this.$HtA[this.$9S].$DF.$GD.$D8.area.y=0;this.$HtA[this.$9S].$DF.$GD.$D8.area.w=this.$HtA[this.$9S].$HQ.w;this.$HtA[this.$9S].$DF.$GD.$D8.area.h=this.$HtA[this.$9S].$HQ.h;this.$HtA[this.$9S].$FO.getContext("2d").clearRect(0,0,this.$HtA[this.$9S].$FO.width,this.$HtA[this.$9S].$FO.height);this.$HtA[this.$9S].$DF.$GD.$GZ(this.$HtA[this.$9S].$FO.getContext("2d"),this.$HtA[this.$9S].$DF.$GD.$D8);this.$HtA[this.$9S].$6G=false}}}}this.$8o=false;bxg.$HuZ.prototype.$EK.call(this);if(this.$HsK){this.$8s=false}};bxg.$HuM.prototype.$F8=function(){if(this.$7J!=this.$DF.$EX){this.$7J.style.display="block"}if(this.$GA){this.$GA.style.display="block"}this.$8s=true};bxg.$HuM.prototype.$F9=function(){if(this.$7J!=this.$DF.$EX){this.$7J.style.display="none"}if(this.$GA){this.$GA.style.display="none"}};bxg.$HuM.prototype.$F5=function(b,a){if(b.$FO){this.$7J.appendChild(b.$FO);if(b.$Ht9()){this.$HtA=this.$HtA||[];this.$HtA.push(b)}}if(b instanceof bxg.$HuO){if(!this.$GA){if(this.$HsK){this.$GA=this.$7J.$TAG("canvas",{},{position:"absolute",zIndex:this.$DF.$F6,left:"0px",top:"0px",display:"block"});this.$GA.width=this.$DF.$GF.w;this.$GA.height=this.$DF.$GF.h}else{this.$GA=bxg.$E9.$DF.$8p.$TAG("canvas",{},{position:"absolute",zIndex:this.$DF.$F6,left:"0px",top:"0px",display:"block"});this.$GA.width=this.$DF.$Hr.w;this.$GA.height=this.$DF.$Hr.h}this.$8m=this.$GA.getContext("2d")}bxg.$HuZ.prototype.$F5.call(this,b,true)}b.$AP=this};bxg.$HuM.prototype.$F7=function(a){if(a.$F4){a.$F4(false)}if(a.$FO){if(a.$FO.parentNode){a.$FO.parentNode.removeChild(a.$FO)}if(a.$Ht9()){for(this.$9S=0;this.$9S<this.$HtA.length;this.$9S++){if(this.$HtA[this.$9S]==a){this.$HtA.splice(this.$9S,1);return}}}}if(a instanceof bxg.$HuO){bxg.$HuZ.prototype.$F7.call(this,a)}a.$AP=null};bxg.$HuM.prototype.$HE=function(a){this.$8s=true};bxg.$HuM.prototype.$HuH=function(){return{}};bxg.$HuM.prototype.$8d=function(){return bxg.$HuZ.prototype.$8d.call(this)};bxg.$HuM.prototype.$8e=function(){return bxg.$HuZ.prototype.$8e.call(this)};bxg.$HuM.prototype.$8f=function(){bxg.$HuZ.prototype.$8f.call(this)};bxg.$HuM.prototype.$HsI=function(a){bxg.$HuZ.prototype.$HsI.call(this,a)};bxg.$HuM.prototype.$HuH=function(){this.$E1.t=this.$DF.$D9;this.$E1.spC=-1;if(this.$E1.$Hu8){this.$E1.$Hu8.spC=this.$8l.length;this.$E1.$Hu8.bf=this.$8x?true:false;if(this.$E1.$Hu8.bf){this.$E1.$Hu8.bfW=this.$8x.$A8.width;this.$E1.$Hu8.bfH=this.$8x.$A8.height}}return this.$E1};bxg.$HtP=function(){if(bx.inClassing){return}this.$D9=0;this.$8u=2;this.$EZ=bxg.$HuZ;this.$EH=bxg.$HuO};bx.$Inherit(bxg.$HtP,bxg.$HuF);bxg.$HtP.prototype.$EC=function(b,a){this.$DF=b||{};this.$A8=this.$DF.$8p.$TAG("canvas",{},{position:"absolute",left:"0px",top:"0px",display:"block"});this.$A8.width=this.$DF.$GF.w;this.$A8.height=this.$DF.$GF.h;this.$8r=this.$A8.getContext("2d");this.$8t=[];if(a){a(true)}};bxg.$HtP.prototype.$HtQ=function(){return this.$8r};bxg.$HtP.prototype.$EG=function(){if(!this.$8t.length){return}this.$8v=false;for(this.$GY=this.$8t.length-1;this.$GY>=0;this.$GY--){if(this.$8t[this.$GY].$8o||(this.$8t[this.$GY].$8s||this.$8t[this.$GY].$8n)){this.$8v=true;break}}if(this.$8v){for(this.$GY=this.$8t.length-1;this.$GY>=0;this.$GY--){this.$8t[this.$GY].$8o=true;this.$8t[this.$GY].$8n=true}this.$HuR(this.$8r,this.$A8.width,this.$A8.height)}};bxg.$HtP.prototype._Iupdated=function(){for(var a=this.$8t.length-1;a>=0;a--){this.$8t[a].$HT(true)}};bxg.$HtP.prototype.$HuP=function(b,c){var a={};a.$A8=this.$DF.$8p.$TAG("canvas",{},{position:"absolute",left:"0px",top:"0px",zIndex:-1,display:"block",visibility:"hidden"});a.$8r=a.$A8.getContext("2d");a.$A8.width=b;a.$A8.height=c;return a};bxg.$HtP.prototype.$HuQ=function(a){if(a.$A8){a.$A8.parentNode.removeChild(a.$A8)}};bxg.$HtP.prototype.$HuR=function(b,a,c){b.clearRect(0,0,a,c)};bxg.$HtP.prototype.$HuS=function(i,e,d,f,b,g,k,j,a,c){g.drawImage(i.canvas,e,d,f,b,k,j,a,c)};bxg.$HuO=function(a){if(bx.inClassing){return}this.$DF=a;this.$7g=this.$7h=0;this.$HQ={x:0,y:0,w:0,h:0};if(this.$DF.$GD){if(!this.$DF.$GD.$D9){this.$DF.$GD.$D9=1}if(this.$DF.$GD.$D9==1&&!this.$DF.$GW){bxg.Trace.log("BXG","noProperty","Type=1 render sprite requires 'resize' options","render.SPR")}}this.$FF(this.$DF.$GJ,true);this.$FQ(this.$DF.$F6);if(this.$DF.$GW){this.$HR(this.$DF.$GW.w,this.$DF.$GW.h)}this.$HS(this.$DF.$GK)};bxg.$HuO.prototype.$F1=function(){};bxg.$HuO.prototype.$FQ=function(a){this.$DF.$F6=a;if(this.$AP){if(this.$DF.$D9&bxg.$7t){this.$AP.$8l.$HsL=true}else{this.$AP.$9a.$HsL=true}}this.$HT()};bxg.$HuO.prototype.$HR=function(a,b){if(isNaN(parseInt(a))||isNaN(parseInt(b))){if(this.$DF.$GW){delete this.$DF.$GW}}else{this.$DF.$GW=this.$DF.$GW||{};this.$DF.$GW.w=a;this.$DF.$GW.h=b}if(this.$DF.$GK){this.$HS(this.$DF.$GK)}else{if(this.$DF.$GW){this.$HQ.w=this.$DF.$GW.w;this.$HQ.h=this.$DF.$GW.h}}this.$HT();return true};bxg.$HuO.prototype.$HS=function(a){if(!(a==0||a)){return false}this.$DF.$GK=a;if(this.$DF.$GJ){bxg.Geometry.$HP({x:this.$7g,y:this.$7h,w:this.$DF.$GW?this.$DF.$GW.w:this.$DF.$GJ.w,h:this.$DF.$GW?this.$DF.$GW.h:this.$DF.$GJ.h},a,this.$HQ)}this.$HT();return true};bxg.$HuO.prototype.$FF=function(b,a){if(!a&&this.$DF.$GJ==b){return false}if(!b){return false}if(b.position){this.$HQ.w=b.size.w;this.$HQ.h=b.size.h}else{this.$HQ.w=b.w;this.$HQ.h=b.h}this.$DF.$GJ=b;this.$HT();return true};bxg.$HuO.prototype.$Htq=function(a){this.$DF.$HuY=a;this.$HT()};bxg.$HuO.prototype.$FY=function(a,b){this.$7g=a;this.$7h=b;this.$HT()};bxg.$HuO.prototype.$HT=function(){if(this.$AP){if(this.$AP.$HsI(this)){if(this.$DF.$D9&bxg.$7t){this.$AP.$8s=true}else{this.$AP.$8o=true}this.$Hue=true}else{if(this.$Hue){if(this.$DF.$D9&bxg.$7t){this.$AP.$8s=true}else{this.$AP.$8o=true}}this.$Hue=false}}};bxg.$HuO.prototype.$HsJ=function(){return this.$AP?true:false};bxg.$HuO.prototype.$F4=function(a){if(this.$DV==a){return}this.$DV=a;this.$HT()};bxg.$HuZ=function(a){if(!a||!a.$D9||!a.$GF){bxg.Trace.log("BXG","errorParameter","invalid options","rDOM.LR");return}this.$DF=a};bxg.$HuZ.prototype.$F0=function(a){this.$E9=a;this.$GA=this.$E9.$A8;this.$8m=this.$E9.$8r;this.$8g=0;this.$8j=0;this.$8h=this.$8g;this.$8i=this.$8j;this.$8l=[];this.$9a=[];this.$8s=true;this.$8n=true;this.$8k=false;this.$8o=true;this.$9w=true;bxg.$HuF.$8c(this.$E9.$8t,this);this.$E1={run:false,r:0,_aLayer:{}}};bxg.$HuZ.prototype.$F1=function(){delete this.$8l;delete this.$9a;if(this.$8x){this.$E9.$HuQ(this.$8x);delete this.$8x}for(var a=0;a<this.$E9.$8t.length;a++){if(this.$E9.$8t[a]==this){this.$E9.$8t.splice(a);break}}};bxg.$HuZ.prototype.$HT=function(a){if(this.$8k){if(a){this.$8n=true}else{this.$8s=true}}this.$8o=true};bxg.$HuZ.prototype.$FJ=function(a){if(this.$DF.$GF.w!=a.w&&this.$DF.$GF.h!=a.h){this.$DF.$GF=a;if(this.$8x){if(this.$8x.$8y){this.$8x.$A8.width=a.w;this.$8x.$A8.height=a.h;this.$HT()}if(this.$DF.$GF.w<this.$DF.$Hr.w||this.$DF.$GF.h<this.$DF.$Hr.h){bxg.Trace.log("BXG","error","Map area size is smaller than view screen size.","RD.RA");return}}}};bxg.$HuZ.prototype.$CM=function(a,b){if(a===undefined&&b===undefined){return}if(a==this.$8g&&b==this.$8j){return}if(a!==undefined){this.$8h=this.$8g;this.$8g=a}if(b!==undefined){this.$8i=this.$8j;this.$8j=b}if(!this.$8s){this.$8s=this.$8k;if(this.$8x&&this.$8x.$8z){if(this.$8e()){this.$8s=false}}}this.$8o=true};bxg.$HuZ.prototype.$HsI=function(a){this.$9b=this.$9b||{};this.$9c=this.$9c||{};if(a.$DF.$D9&bxg.$7t&&this.$8x){if(this.$8x.$8y){this.$9c.x=0;this.$9c.y=0}else{if(this.$8x.$9g){this.$9c.x=-this.$8g;this.$9c.y=-this.$8j}else{this.$9c.x=this.$8x.$9h.x;this.$9c.y=this.$8x.$9h.y}}this.$9c.w=this.$8x.$A8.width;this.$9c.h=this.$8x.$A8.height}else{this.$9c.x=-this.$8g;this.$9c.y=-this.$8j;this.$9c.w=this.$DF.$Hr.w;this.$9c.h=this.$DF.$Hr.h}this.$9b=this.$9b||{};this.$9b.x=(a.$7g+a.$HQ.x);this.$9b.y=(a.$7h+a.$HQ.y);this.$9b.w=a.$HQ.w;this.$9b.h=a.$HQ.h;return bxg.Geometry.intersect_rect_rect(this.$9b,this.$9c)};bxg.$HuZ.prototype.$GV=function(b,a){this.$9b=this.$9b||{};this.$9c=this.$9c||{};this.$9d=this.$8x&&a?this.$8x.$8r:this.$8m;this.$9e=this.$8g;this.$9f=this.$8j;if(this.$8x&&a){if(this.$8x.$8y){this.$9e=0;this.$9f=0}else{if(this.$8x.$9g){}else{this.$9e=this.$8x.$9h.x;this.$9f=this.$8x.$9h.y}}}if(this.$HsK){this.$9e=0;this.$9f=0}this.$9b.x=-this.$9e;this.$9b.y=-this.$9f;this.$9b.w=this.$9d.canvas.width;this.$9b.h=this.$9d.canvas.height;if(b.$DF.$GJ){if(b.$DF.$GJ.opacity!==undefined||b.$DF.$HuY!==undefined){if(b.$DF.$HuY!==undefined){this.$9d.globalAlpha=b.$DF.$HuY}else{this.$9d.globalAlpha=b.$DF.$GJ.opacity}}if(b.$DF.$D9&bxg.$7u){if(b.$DF.$GW){this.$9j=b.$7g+this.$9e;this.$9i=b.$7h+this.$9f}else{this.$9j=this.$9e;this.$9i=this.$9f}bxg.Canvas.drawImagePattern(this.$9d,b.$DF.$GJ.$9M,this.$9j,this.$9i,b.$DF.$GW?b.$DF.$GW.w:this.$DF.$GF.w,b.$DF.$GW?b.$DF.$GW.h:this.$DF.$GF.h)}else{this.$9c.x=(b.$7g+b.$HQ.x);this.$9c.y=(b.$7h+b.$HQ.y);this.$9c.w=b.$HQ.w;this.$9c.h=b.$HQ.h;if(bxg.Geometry.intersect_rect_rect(this.$9b,this.$9c)){if(b.$DF.$GJ.position){this.$9d.drawImage(b.$DF.$GJ.$9M,-b.$DF.$GJ.position.x,-b.$DF.$GJ.position.y,b.$DF.$GJ.size.w,b.$DF.$GJ.size.h,b.$7g+this.$9e,b.$7h+this.$9f,b.$DF.$GJ.size.w,b.$DF.$GJ.size.h)}else{bxg.Canvas.drawImage(this.$9d,b.$DF.$GJ.$9M,b.$7g+this.$9e,b.$7h+this.$9f,b.$DF.$GW?b.$DF.$GW.w:undefined,b.$DF.$GW?b.$DF.$GW.h:undefined,b.$DF.$GK)}}}if(b.$DF.$GJ.opacity!==undefined||b.$DF.$HuY!==undefined){this.$9d.globalAlpha=1}}else{if(b.$DF.$GD&&b.$DF.$GD.$GZ){if(b.$DF.$GD.$D9==1){this.$9c.x=(b.$7g+b.$HQ.x);this.$9c.y=(b.$7h+b.$HQ.y);this.$9c.w=b.$HQ.w;this.$9c.h=b.$HQ.h;if(b.$DF.$GW){if(bxg.Geometry.intersect_rect_rect(this.$9b,this.$9c)){b.$DF.$GD.$D8=b.$DF.$GD.$D8||{};b.$DF.$GD.$D8.area=b.$DF.$GD.$D8.area||{};b.$DF.$GD.$D8.area.x=b.$7g+this.$9e;b.$DF.$GD.$D8.area.y=b.$7h+this.$9f;b.$DF.$GD.$D8.area.w=b.$HQ.w;b.$DF.$GD.$D8.area.h=b.$HQ.h;b.$DF.$GD.$GZ(this.$9d,b.$DF.$GD.$D8)}}}else{if(b.$DF.$GD.$D9==2){b.$DF.$GD.$D8=b.$DF.$GD.$D8||{};b.$DF.$GD.$D8.area=b.$DF.$GD.$D8.area||{};b.$DF.$GD.$D8.area.x=this.$9b.x;b.$DF.$GD.$D8.area.y=this.$9b.y;b.$DF.$GD.$D8.area.w=this.$9b.w;b.$DF.$GD.$D8.area.h=this.$9b.h;b.$DF.$GD.$GZ(this.$9d,b.$DF.$GD.$D8)}}}}};bxg.$HuZ.$HsM=function(d,c){return d.$DF.$F6-c.$DF.$F6};bxg.$HuZ.prototype.$EK=function(){if(!this.$8x&&this.$8k&&this.$DF.$6r&bxg.$6t){if(this.$DF.$GF.w<this.$DF.$Hr.w||this.$DF.$GF.h<this.$DF.$Hr.h){bxg.Trace.log("BXG","error","Map area size is smaller than view screen size.","RD.AS");return}if(this.$DF.$6r&bxg.$6u||this.$DF.$D9==bxg.$EU){this.$8x=this.$E9.$HuP(this.$GA.width,this.$GA.height);this.$8x.$9g=true}else{if(this.$DF.$D9==bxg.$FI){this.$8x=this.$E9.$HuP(this.$DF.$GF.w,this.$DF.$GF.h);this.$8x.$8y=true}else{if(this.$DF.$D9==bxg.$7c||this.$DF.$D9==bxg.$7d||this.$DF.$D9==bxg.$7a){this.$8x=this.$E9.$HuP(this.$GA.width*this.$E9.$8u,this.$DF.$GF.h)}else{if(this.$DF.$D9==bxg.$7e||this.$DF.$D9==bxg.$7b||this.$DF.$D9==bxg.$6z){this.$8x=this.$E9.$HuP(this.$DF.$GF.w,this.$GA.height*this.$E9.$8u)}else{if(this.$DF.$D9==bxg.$6x){this.$8x=this.$E9.$HuP(this.$GA.width*this.$E9.$8u,this.$GA.height*this.$E9.$8u)}}}}}if(this.$8x){this.$8x.$9h={x:0,y:0}}else{}this.$8f()}this.$E1.r++;if(this.$8n&&!this.$8x){this.$8s=this.$8n;this.$8n=false}if(!this.$8k){this.$8s=false}if(this.$8n||this.$8s||this.$8o){if(!this.$9w&&this.$GA){this.$E9.$HuR(this.$8m,this.$GA.width,this.$GA.height)}if(this.$8s){if(this.$8x){this.$E9.$HuR(this.$8x.$8r,this.$8x.$A8.width,this.$8x.$A8.height);this.$8f();this.$8x.$8z=true;this.$8s=false}if(this.$8x&&this.$E1.$Hu8){this.$E1.$Hu8.br++}if(this.$8l.$HsL){this.$8l.sort(bxg.$HuZ.$HsM);this.$8l.$HsL=false}for(this.$9S=0;this.$9S<this.$8l.length;this.$9S++){if(this.$8l[this.$9S].$DV){this.$GV(this.$8l[this.$9S],true)}}this.$8s=false}if(this.$8x){if(bxg.Trace.logging){if(this.$8x.$9g&&this.$8l.length<10&&!this.$8x.$Huf){bxg.Trace.log("BXG","warning","Very few("+this.$8l.length+") sprites are used in the base-layer. It will be better to turn off the buffering mode of base-layer by renderer.buffering=false in CControl options.","Renderer");this.$8x.$Huf=true}}if(this.$8x.$8y){this.$E9.$HuS(this.$8x.$8r,-this.$8g,-this.$8j,this.$GA.width,this.$GA.height,this.$8m,0,0,this.$GA.width,this.$GA.height)}else{if(this.$8x.$9g){this.$E9.$HuS(this.$8x.$8r,0,0,this.$GA.width,this.$GA.height,this.$8m,0,0,this.$GA.width,this.$GA.height)}else{this.$E9.$HuS(this.$8x.$8r,Math.abs(this.$8x.$9h.x-this.$8g),Math.abs(this.$8x.$9h.y-this.$8j),this.$GA.width,this.$GA.height,this.$8m,0,0,this.$GA.width,this.$GA.height)}}}if(this.$8o){if(this.$9a.$HsL){this.$9a.sort(bxg.$HuZ.$HsM);this.$9a.$HsL=false}for(this.$9S=0;this.$9S<this.$9a.length;this.$9S++){if(this.$9a[this.$9S].$DV){this.$GV(this.$9a[this.$9S])}}this.$8o=false}this.$8n=false}};bxg.$HuZ.prototype.$F5=function(c,a){var b;if(a){c.$DF.$D9|=bxg.$7t}if(c.$DF.$D9&bxg.$7t){if(bxg.Trace.logging){for(b=0;b<this.$8l.length;b++){if(this.$8l[b]==c){bxg.Trace.log("BXG","warning","Same render sprite is already exist in layer","RD.AS");return}}}this.$E1.$Hu8=this.$E1.$Hu8||{br:0};this.$8l.push(c);this.$8l.$HsL=true;this.$8s=true;this.$8k=true}else{if(bxg.Trace.logging){for(b=0;b<this.$9a.length;b++){if(this.$9a[b]==c){bxg.Trace.log("BXG","warning","Same render sprite is already exist in layer","RD.AS");return}}}this.$9a.push(c);this.$9a.$HsL=true;this.$8o=true}c.$AP=this};bxg.$HuZ.prototype.$F7=function(a){if(a.$DF.$D9&bxg.$7t){for(this.$9S=0;this.$9S<this.$8l.length;this.$9S++){if(this.$8l[this.$9S]==a){this.$8l.splice(this.$9S,1);a.$AP=null;a.$DF.$D9&=~bxg.$7t;this.$8s=true;return}}}else{for(this.$9S=0;this.$9S<this.$9a.length;this.$9S++){if(this.$9a[this.$9S]==a){this.$9a.splice(this.$9S,1);a.$AP=null;this.$8o=true;return}}}};bxg.$HuZ.prototype.$HE=function(a){this.$8s=true;this.$8o=true};bxg.$HuZ.prototype.$8d=function(){if(this.$8x&&this.$8x.$8y){return this.$8x.$A8}else{if(this.$HsK){return this.$GA}}return undefined};bxg.$HuZ.prototype.$8e=function(){if(this.$8x.$8y){return true}else{if(this.$DF.$D9==bxg.$7e||this.$DF.$D9==bxg.$7b){if(-this.$8x.$9h.y<=-this.$8j&&-this.$8x.$9h.y+this.$8x.$A8.height>=-this.$8j+this.$GA.height){return true}}else{if(this.$DF.$D9==bxg.$7d||this.$DF.$D9==bxg.$7c){if(-this.$8x.$9h.x<=-this.$8g&&-this.$8x.$9h.x+this.$8x.$A8.width>=-this.$8g+this.$GA.width){return true}}else{if(this.$DF.$D9==bxg.$6x){if(-this.$8x.$9h.y<=-this.$8j&&-this.$8x.$9h.y+this.$8x.$A8.height>=-this.$8j+this.$GA.height){if(-this.$8x.$9h.x<=-this.$8g&&-this.$8x.$9h.x+this.$8x.$A8.width>=-this.$8g+this.$GA.width){return true}}}else{if(this.$DF.$D9==bxg.$7a){if(-this.$8x.$9h.x<=-this.$8g&&-this.$8x.$9h.x+this.$8x.$A8.width>=-this.$8g+this.$GA.width){return true}}else{if(this.$DF.$D9==bxg.$6z){if(-this.$8x.$9h.y<=-this.$8j&&-this.$8x.$9h.y+this.$8x.$A8.height>=-this.$8j+this.$GA.height){return true}}}}}}}return false};bxg.$HuZ.prototype.$8f=function(){if(this.$8x&&this.$8x.$8y){}else{if(this.$DF.$D9==bxg.$7e){this.$8x.$9h.x=0;this.$8x.$9h.y=this.$8j+this.$GA.height*(this.$E9.$8u-1);if(this.$8x.$9h.y>0){this.$8x.$9h.y=0}}else{if(this.$DF.$D9==bxg.$7b){this.$8x.$9h.x=0;this.$8x.$9h.y=this.$8j}else{if(this.$DF.$D9==bxg.$7d){this.$8x.$9h.x=this.$8g+this.$GA.width*(this.$E9.$8u-1);this.$8x.$9h.y=0;if(this.$8x.$9h.x>0){this.$8x.$9h.x=0}}else{if(this.$DF.$D9==bxg.$7c){this.$8x.$9h.x=this.$8g;this.$8x.$9h.y=0}else{if(this.$DF.$D9==bxg.$6x){this.$8x.$9h.x=this.$8g+Math.floor(this.$GA.width*(this.$E9.$8u-1)*0.5);this.$8x.$9h.y=this.$8j+Math.floor(this.$GA.height*(this.$E9.$8u-1)*0.5);if(this.$8x.$9h.x>0){this.$8x.$9h.x=0}if(this.$8x.$9h.y>0){this.$8x.$9h.y=0}}else{if(this.$DF.$D9==bxg.$7a){this.$8x.$9h.x=this.$8g+Math.floor(this.$GA.width*(this.$E9.$8u-1)*0.5);this.$8x.$9h.y=0;if(this.$8x.$9h.x>0){this.$8x.$9h.x=0}}else{if(this.$DF.$D9==bxg.$6z){this.$8x.$9h.x=0;this.$8x.$9h.y=this.$8j+Math.floor(this.$GA.height*(this.$E9.$8u-1)*0.5);if(this.$8x.$9h.y>0){this.$8x.$9h.y=0}}}}}}}}}};bxg.$HuZ.prototype.$HuH=function(){this.$E1.t=this.$DF.$D9;this.$E1.spC=this.$8l.length+this.$9a.length;if(this.$E1.$Hu8){this.$E1.$Hu8.spC=this.$8l.length;this.$E1.$Hu8.bf=this.$8x?true:false;if(this.$E1.$Hu8.bf){this.$E1.$Hu8.bfW=this.$8x.$A8.width;this.$E1.$Hu8.bfH=this.$8x.$A8.height}}return this.$E1};bxg.$Hud={c:{},api:{}};bxg.$Hud.$Hug=function(a){this.c[a]=[{on:0},{on:0,quad:true,c:[{},{},{},{}]},{on:0},{on:0,quad:true,c:[{},{},{},{}]},{on:0},{on:0},{on:0},{on:0},{on:0},{on:0},{on:0},{on:0}];this.api[a]=0};bxg.$Hud._fire4=function(c,a,b){this.__varAF4=this.c[c][a];if(b){if(this.__varAF4.on==3){if(a==1){bxg.Acanvas.drawImageQuad(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(this.__varAF4.c[1].$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(this.__varAF4.c[1].x<0?((-this.__varAF4.c[1].x)&32767)|32768:this.__varAF4.c[1].x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(this.__varAF4.c[1].y<0?((-this.__varAF4.c[1].y)&32767)|32768:this.__varAF4.c[1].y&32767),c<<16|(c&32767),this.__varAF4.c[2].$GJ<<16|(b.$GJ&32767),(this.__varAF4.c[2].x<0?((-this.__varAF4.c[2].x)<<16)|2147483648:this.__varAF4.c[2].x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.__varAF4.c[2].y<0?((-this.__varAF4.c[2].y)<<16)|2147483648:this.__varAF4.c[2].y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767))}else{if(a==3){bxg.Acanvas.drawImageClipQuad(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(this.__varAF4.c[1].$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(this.__varAF4.c[1].x<0?((-this.__varAF4.c[1].x)&32767)|32768:this.__varAF4.c[1].x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(this.__varAF4.c[1].y<0?((-this.__varAF4.c[1].y)&32767)|32768:this.__varAF4.c[1].y&32767),(this.__varAF4.c[0].w<0?((-this.__varAF4.c[0].w)<<16)|2147483648:this.__varAF4.c[0].w<<16)|(this.__varAF4.c[1].w<0?((-this.__varAF4.c[1].w)&32767)|32768:this.__varAF4.c[1].w&32767),(this.__varAF4.c[0].h<0?((-this.__varAF4.c[0].h)<<16)|2147483648:this.__varAF4.c[0].h<<16)|(this.__varAF4.c[1].h<0?((-this.__varAF4.c[1].h)&32767)|32768:this.__varAF4.c[1].h&32767),(this.__varAF4.c[0].ox<0?((-this.__varAF4.c[0].ox)<<16)|2147483648:this.__varAF4.c[0].ox<<16)|(this.__varAF4.c[1].ox<0?((-this.__varAF4.c[1].ox)&32767)|32768:this.__varAF4.c[1].ox&32767),(this.__varAF4.c[0].oy<0?((-this.__varAF4.c[0].oy)<<16)|2147483648:this.__varAF4.c[0].oy<<16)|(this.__varAF4.c[1].oy<0?((-this.__varAF4.c[1].oy)&32767)|32768:this.__varAF4.c[1].oy&32767),c<<16|(c&32767),this.__varAF4.c[2].$GJ<<16|(b.$GJ&32767),(this.__varAF4.c[2].x<0?((-this.__varAF4.c[2].x)<<16)|2147483648:this.__varAF4.c[2].x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.__varAF4.c[2].y<0?((-this.__varAF4.c[2].y)<<16)|2147483648:this.__varAF4.c[2].y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767),(this.__varAF4.c[2].w<0?((-this.__varAF4.c[2].w)<<16)|2147483648:this.__varAF4.c[2].w<<16)|(b.w<0?((-b.w)&32767)|32768:b.w&32767),(this.__varAF4.c[2].h<0?((-this.__varAF4.c[2].h)<<16)|2147483648:this.__varAF4.c[2].h<<16)|(b.h<0?((-b.h)&32767)|32768:b.h&32767),(this.__varAF4.c[2].ox<0?((-this.__varAF4.c[2].ox)<<16)|2147483648:this.__varAF4.c[2].ox<<16)|(b.ox<0?((-b.ox)&32767)|32768:b.ox&32767),(this.__varAF4.c[2].oy<0?((-this.__varAF4.c[2].oy)<<16)|2147483648:this.__varAF4.c[2].oy<<16)|(b.oy<0?((-b.oy)&32767)|32768:b.oy&32767))}}}else{if(this.__varAF4.on==2){if(a==1){bxg.Acanvas.drawImageDouble(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(this.__varAF4.c[1].$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(this.__varAF4.c[1].x<0?((-this.__varAF4.c[1].x)&32767)|32768:this.__varAF4.c[1].x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(this.__varAF4.c[1].y<0?((-this.__varAF4.c[1].y)&32767)|32768:this.__varAF4.c[1].y&32767));bxg.Acanvas.drawImage(c,b.$GJ,b.x,b.y)}else{if(a==3){bxg.Acanvas.drawImageClipDouble(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(this.__varAF4.c[1].$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(this.__varAF4.c[1].x<0?((-this.__varAF4.c[1].x)&32767)|32768:this.__varAF4.c[1].x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(this.__varAF4.c[1].y<0?((-this.__varAF4.c[1].y)&32767)|32768:this.__varAF4.c[1].y&32767),(this.__varAF4.c[0].w<0?((-this.__varAF4.c[0].w)<<16)|2147483648:this.__varAF4.c[0].w<<16)|(this.__varAF4.c[1].w<0?((-this.__varAF4.c[1].w)&32767)|32768:this.__varAF4.c[1].w&32767),(this.__varAF4.c[0].h<0?((-this.__varAF4.c[0].h)<<16)|2147483648:this.__varAF4.c[0].h<<16)|(this.__varAF4.c[1].h<0?((-this.__varAF4.c[1].h)&32767)|32768:this.__varAF4.c[1].h&32767),(this.__varAF4.c[0].ox<0?((-this.__varAF4.c[0].ox)<<16)|2147483648:this.__varAF4.c[0].ox<<16)|(this.__varAF4.c[1].ox<0?((-this.__varAF4.c[1].ox)&32767)|32768:this.__varAF4.c[1].ox&32767),(this.__varAF4.c[0].oy<0?((-this.__varAF4.c[0].oy)<<16)|2147483648:this.__varAF4.c[0].oy<<16)|(this.__varAF4.c[1].oy<0?((-this.__varAF4.c[1].oy)&32767)|32768:this.__varAF4.c[1].oy&32767));bxg.Acanvas.drawImageClip(c,b.$GJ,b.x,b.y,b.w,b.h,b.ox,b.oy)}}}else{if(this.__varAF4.on==1){if(a==1){bxg.Acanvas.drawImageDouble(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(b.$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767))}else{if(a==3){bxg.Acanvas.drawImageClipDouble(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(b.$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767),(this.__varAF4.c[0].w<0?((-this.__varAF4.c[0].w)<<16)|2147483648:this.__varAF4.c[0].w<<16)|(b.w<0?((-b.w)&32767)|32768:b.w&32767),(this.__varAF4.c[0].h<0?((-this.__varAF4.c[0].h)<<16)|2147483648:this.__varAF4.c[0].h<<16)|(b.h<0?((-b.h)&32767)|32768:b.h&32767),(this.__varAF4.c[0].ox<0?((-this.__varAF4.c[0].ox)<<16)|2147483648:this.__varAF4.c[0].ox<<16)|(b.ox<0?((-b.ox)&32767)|32768:b.ox&32767),(this.__varAF4.c[0].oy<0?((-this.__varAF4.c[0].oy)<<16)|2147483648:this.__varAF4.c[0].oy<<16)|(b.oy<0?((-b.oy)&32767)|32768:b.oy&32767))}}}}}}else{if(this.__varAF4.on==3||this.__varAF4.on==2){if(a==1){bxg.Acanvas.drawImageDouble(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(this.__varAF4.c[1].$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(this.__varAF4.c[1].x<0?((-this.__varAF4.c[1].x)&32767)|32768:this.__varAF4.c[1].x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(this.__varAF4.c[1].y<0?((-this.__varAF4.c[1].y)&32767)|32768:this.__varAF4.c[1].y&32767));if(this.__varAF4.on==3){bxg.Acanvas.drawImage(c,this.__varAF4.c[2].$GJ,this.__varAF4.c[2].x,this.__varAF4.c[2].y)}}else{if(a==3){bxg.Acanvas.drawImageClipDouble(c<<16|(c&32767),this.__varAF4.c[0].$GJ<<16|(this.__varAF4.c[1].$GJ&32767),(this.__varAF4.c[0].x<0?((-this.__varAF4.c[0].x)<<16)|2147483648:this.__varAF4.c[0].x<<16)|(this.__varAF4.c[1].x<0?((-this.__varAF4.c[1].x)&32767)|32768:this.__varAF4.c[1].x&32767),(this.__varAF4.c[0].y<0?((-this.__varAF4.c[0].y)<<16)|2147483648:this.__varAF4.c[0].y<<16)|(this.__varAF4.c[1].y<0?((-this.__varAF4.c[1].y)&32767)|32768:this.__varAF4.c[1].y&32767),(this.__varAF4.c[0].w<0?((-this.__varAF4.c[0].w)<<16)|2147483648:this.__varAF4.c[0].w<<16)|(this.__varAF4.c[1].w<0?((-this.__varAF4.c[1].w)&32767)|32768:this.__varAF4.c[1].w&32767),(this.__varAF4.c[0].h<0?((-this.__varAF4.c[0].h)<<16)|2147483648:this.__varAF4.c[0].h<<16)|(this.__varAF4.c[1].h<0?((-this.__varAF4.c[1].h)&32767)|32768:this.__varAF4.c[1].h&32767),(this.__varAF4.c[0].ox<0?((-this.__varAF4.c[0].ox)<<16)|2147483648:this.__varAF4.c[0].ox<<16)|(this.__varAF4.c[1].ox<0?((-this.__varAF4.c[1].ox)&32767)|32768:this.__varAF4.c[1].ox&32767),(this.__varAF4.c[0].oy<0?((-this.__varAF4.c[0].oy)<<16)|2147483648:this.__varAF4.c[0].oy<<16)|(this.__varAF4.c[1].oy<0?((-this.__varAF4.c[1].oy)&32767)|32768:this.__varAF4.c[1].oy&32767));if(this.__varAF4.on==3){bxg.Acanvas.drawImageClip(c,this.__varAF4.c[2].$GJ,this.__varAF4.c[2].x,this.__varAF4.c[2].y,this.__varAF4.c[2].w,this.__varAF4.c[2].h,this.__varAF4.c[2].ox,this.__varAF4.c[2].oy)}}}}else{if(this.__varAF4.on==1){if(a==1){bxg.Acanvas.drawImage(c,this.__varAF4.c[0].$GJ,this.__varAF4.c[0].x,this.__varAF4.c[0].y)}else{if(a==3){bxg.Acanvas.drawImageClip(c,this.__varAF4.c[0].$GJ,this.__varAF4.c[0].x,this.__varAF4.c[0].y,this.__varAF4.c[0].w,this.__varAF4.c[0].h,this.__varAF4.c[0].ox,this.__varAF4.c[0].oy)}}}}}this.c[c][a].on=0;this.api[c]=0};bxg.$Hud.$Huh=function(c,a,b){if(this.api[c]==0){bxg.Trace.log("BXG","warning","No API.","ACC.F");return}c=c|0;if(a!=this.api[c]){if(!this.c[c][this.api[c]].on){bxg.Trace.log("BXG","warning","Not active context="+this.api[c],"ACC.F")}if(this.c[c][this.api[c]].quad){bxg.$Hud._fire4(c,this.api[c]);return}this.$Hua=this.c[c][this.api[c]];switch(bxg.$Hud.api[c]){case 2:bxg.Acanvas.drawImageTransform(c,this.$Hua.$GJ,this.$Hua.x,this.$Hua.y,this.$Hua.w,this.$Hua.h,this.$Hua.r,this.$Hua.rf);break;case 4:bxg.Acanvas.drawImagePattern(c,this.$Hua.$GJ,this.$Hua.x,this.$Hua.y,this.$Hua.w,this.$Hua.h,this.$Hua.ox,this.$Hua.oy);break;case 5:bxg.Acanvas.drawLine(c,this.$Hua.x,this.$Hua.y,this.$Hua.ex,this.$Hua.ey);break;case 6:bxg.Acanvas.setAlpha(c,this.$Hua.a);break;case 7:bxg.Acanvas.setLineStyle(c,this.$Hua.a,this.$Hua.r,this.$Hua.g,this.$Hua.b);break;case 8:bxg.Acanvas.setLine(c,this.$Hua.w,this.$Hua.cap);break;case 9:bxg.Acanvas.setFillStyle(c,this.$Hua.a,this.$Hua.r,this.$Hua.g,this.$Hua.b);break;case 10:bxg.Acanvas.drawRect(c,this.$Hua.x,this.$Hua.y,this.$Hua.w,this.$Hua.h);break;case 11:bxg.Acanvas.drawArc(c,this.$Hua.x,this.$Hua.y,this.$Hua.w,this.$Hua.h,this.$Hua.sa,this.$Hua.ea);break}this.c[c][this.api[c]].on=0}else{if(!this.c[c][a].on){bxg.Trace.log("BXG","warning","Not active context="+a,"ACC.F")}if(this.c[c][a].quad){bxg.$Hud._fire4(c,a,b);return}this.$Hua=this.c[c][a];switch(bxg.$Hud.api[c]){case 2:bxg.Acanvas.drawImageTransformDouble(c<<16|(c&32767),this.$Hua.$GJ<<16|(b.$GJ&32767),(this.$Hua.x<0?((-this.$Hua.x)<<16)|2147483648:this.$Hua.x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.$Hua.y<0?((-this.$Hua.y)<<16)|2147483648:this.$Hua.y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767),(this.$Hua.w<0?((-this.$Hua.w)<<16)|2147483648:this.$Hua.w<<16)|(b.w<0?((-b.w)&32767)|32768:b.w&32767),(this.$Hua.h<0?((-this.$Hua.h)<<16)|2147483648:this.$Hua.h<<16)|(b.h<0?((-b.h)&32767)|32768:b.h&32767),(this.$Hua.r<0?((-this.$Hua.r)<<16)|2147483648:this.$Hua.r<<16)|(b.r<0?((-b.r)&32767)|32768:b.r&32767),(this.$Hua.rf<0?((-this.$Hua.rf)<<16)|2147483648:this.$Hua.rf<<16)|(b.rf<0?((-b.rf)&32767)|32768:b.rf&32767));break;case 4:bxg.Acanvas.drawImagePatternDouble(c<<16|(c&32767),this.$Hua.$GJ<<16|(b.$GJ&32767),(this.$Hua.x<0?((-this.$Hua.x)<<16)|2147483648:this.$Hua.x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.$Hua.y<0?((-this.$Hua.y)<<16)|2147483648:this.$Hua.y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767),(this.$Hua.w<0?((-this.$Hua.w)<<16)|2147483648:this.$Hua.w<<16)|(b.w<0?((-b.w)&32767)|32768:b.w&32767),(this.$Hua.h<0?((-this.$Hua.h)<<16)|2147483648:this.$Hua.h<<16)|(b.h<0?((-b.h)&32767)|32768:b.h&32767),(this.$Hua.ox<0?((-this.$Hua.ox)<<16)|2147483648:this.$Hua.ox<<16)|(b.ox<0?((-b.ox)&32767)|32768:b.ox&32767),(this.$Hua.oy<0?((-this.$Hua.oy)<<16)|2147483648:this.$Hua.oy<<16)|(b.oy<0?((-b.oy)&32767)|32768:b.oy&32767));break;case 5:bxg.Acanvas.drawLineDouble(c<<16|(c&32767),(this.$Hua.x<0?((-this.$Hua.x)<<16)|2147483648:this.$Hua.x<<16)|(b.x<0?((-b.x)&32767)|32768:b.x&32767),(this.$Hua.y<0?((-this.$Hua.y)<<16)|2147483648:this.$Hua.y<<16)|(b.y<0?((-b.y)&32767)|32768:b.y&32767),(this.$Hua.ex<0?((-this.$Hua.ex)<<16)|2147483648:this.$Hua.ex<<16)|(b.ex<0?((-b.ex)&32767)|32768:b.ex&32767),(this.$Hua.ey<0?((-this.$Hua.ey)<<16)|2147483648:this.$Hua.ey<<16)|(b.ey<0?((-b.ey)&32767)|32768:b.ey&32767));break}this.c[c][a].on=0}this.api[c]=0};bxg.$Hud.$Hui=function(b,a){this.c[b][a].on++;this.api[b]=a};bxg.$Hud.$Huj=function(){for(this.$Huk in this.api){if(this.api[this.$Huk]!=0){this.$Huh(this.$Huk,0)}}};bxg.$Hub=function(c,a,b){this.canvas={width:a,height:b};this.id=c;this.bxgAcanvas=true;this.$Hul={}};bxg.$Hub.prototype.drawImage=function(e,a,g,b,d,f,c){this.$Huc=true;if(b||d||f||c){if(bxg.$Hud.api[this.id]!=2){if(bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,2)}}else{if(bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){this.$Hul.$GJ=e.id;this.$Hul.x=a|0;this.$Hul.y=g|0;this.$Hul.w=b?(b|0):0;this.$Hul.h=d?(d|0):0;this.$Hul.r=f?(f|0):0;this.$Hul.rf=c?c:0;bxg.$Hud.$Huh(this.id,2,this.$Hul);this.$Huc=false}}if(this.$Huc){this.$Hua=bxg.$Hud.c[this.id][2];this.$Hua.$GJ=e.id;this.$Hua.x=a|0;this.$Hua.y=g|0;this.$Hua.w=b?(b|0):0;this.$Hua.h=d?(d|0):0;this.$Hua.r=f?(f|0):0;this.$Hua.rf=c?c:0;bxg.$Hud.$Hui(this.id,2)}}else{if(bxg.$Hud.api[this.id]!=1){if(bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,1)}}else{if(bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on==3){this.$Hul.$GJ=e.id;this.$Hul.x=a|0;this.$Hul.y=g|0;bxg.$Hud.$Huh(this.id,1,this.$Hul);this.$Huc=false}}if(this.$Huc){this.$Hua=bxg.$Hud.c[this.id][1].c[bxg.$Hud.c[this.id][1].on];this.$Hua.$GJ=e.id;this.$Hua.x=a|0;this.$Hua.y=g|0;bxg.$Hud.$Hui(this.id,1)}}};bxg.$Hub.prototype.drawImageClip=function(f,a,g,c,e,d,b){this.$Huu(3,f,a,g,c,e,d,b)};bxg.$Hub.prototype.drawImagePattern=function(f,a,g,c,e,d,b){this.$Huu(4,f,a,g,c,e,d,b)};bxg.$Hub.prototype.$Huu=function(g,f,a,i,c,e,d,b){this.$Huc=true;if(bxg.$Hud.api[this.id]!=g){if(bxg.$Hud.api[this.id]&&bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,g)}else{if(bxg.$Hud.api[this.id]){bxg.Trace.log("BXG","warning","Off context for="+bxg.$Hud.api[this.id],"ACC.DIX");bxg.Trace.data(bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]])}}}else{if((!bxg.$Hud.c[this.id][g].quad&&bxg.$Hud.c[this.id][g].on)||(bxg.$Hud.c[this.id][g].quad&&bxg.$Hud.c[this.id][g].on==3)){this.$Hul.$GJ=f.id;this.$Hul.x=a|0;this.$Hul.y=i|0;this.$Hul.w=c|0;this.$Hul.h=e|0;this.$Hul.ox=d?(d|0):0;this.$Hul.oy=b?(b|0):0;bxg.$Hud.$Huh(this.id,g,this.$Hul);this.$Huc=false}}if(this.$Huc){if(bxg.$Hud.c[this.id][g].quad){this.$Hua=bxg.$Hud.c[this.id][g].c[bxg.$Hud.c[this.id][g].on]}else{this.$Hua=bxg.$Hud.c[this.id][g]}this.$Hua.$GJ=f.id;this.$Hua.x=a|0;this.$Hua.y=i|0;this.$Hua.w=c|0;this.$Hua.h=e|0;this.$Hua.ox=d?(d|0):0;this.$Hua.oy=b?(b|0):0;bxg.$Hud.$Hui(this.id,g)}};bxg.$Hub.prototype.drawLine=function(a,d,c,b){this.$Huc=true;if(bxg.$Hud.api[this.id]!=5){if(bxg.$Hud.api[this.id]&&bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,5)}}else{if(bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){this.$Hul.x=a|0;this.$Hul.y=d|0;this.$Hul.ex=c|0;this.$Hul.ey=b|0;bxg.$Hud.$Huh(this.id,5,this.$Hul);this.$Huc=false}}if(this.$Huc){this.$Hua=bxg.$Hud.c[this.id][5];this.$Hua.x=a|0;this.$Hua.y=d|0;this.$Hua.ex=c|0;this.$Hua.ey=b|0;bxg.$Hud.$Hui(this.id,5)}};bxg.$Hub.prototype.setAlpha=function(b){if(bxg.$Hud.api[this.id]!=6){if(bxg.$Hud.api[this.id]&&bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,6)}}this.$Hua=bxg.$Hud.c[this.id][6];this.$Hua.a=b!==undefined?Math.ceil(255*b):255;bxg.$Hud.$Hui(this.id,6)};bxg.$Hub.prototype._setRGBA=function(e,h,f,c,d){if(bxg.$Hud.api[this.id]!=e){if(bxg.$Hud.api[this.id]&&bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,e)}}this.$Hua=bxg.$Hud.c[this.id][e];this.$Hua.r=h|0;this.$Hua.g=f|0;this.$Hua.b=c|0;this.$Hua.a=d!==undefined?Math.ceil(255*d):255;bxg.$Hud.$Hui(this.id,e)};bxg.$Hub.prototype.setStrokeStyle=function(f,e,c,d){this._setRGBA(7,f,e,c,d)};bxg.$Hub.prototype.setFillStyle=function(f,e,c,d){this._setRGBA(9,f,e,c,d)};bxg.$Hub.prototype.setLine=function(a,b){if(bxg.$Hud.api[this.id]!=8){if(bxg.$Hud.api[this.id]&&bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,8)}}this.$Hua=bxg.$Hud.c[this.id][8];this.$Hua.w=a!==undefined?a|0:0;this.$Hua.cap=b!==undefined?b|0:0;bxg.$Hud.$Hui(this.id,8)};bxg.$Hub.prototype._drawXYWHAA=function(f,b,g,c,e,a,d){if(bxg.$Hud.api[this.id]!=f){if(bxg.$Hud.api[this.id]&&bxg.$Hud.c[this.id][bxg.$Hud.api[this.id]].on){bxg.$Hud.$Huh(this.id,f)}}this.$Hua=bxg.$Hud.c[this.id][f];this.$Hua.x=b|0;this.$Hua.y=g|0;this.$Hua.w=c|0;this.$Hua.h=e|0;this.$Hua.sa=a!==undefined?a|0:0;this.$Hua.ea=d!==undefined?d|0:360|0;bxg.$Hud.$Hui(this.id,f)};bxg.$Hub.prototype.drawRect=function(a,d,b,c){this._drawXYWHAA(10,a,d,b,c)};bxg.$Hub.prototype.drawArc=function(b,f,c,e,a,d){this._drawXYWHAA(11,b,f,c,e,a,d)};bxg.$HtO=function(){if(bx.inClassing){return}if(window.bxgCanvas){bxg.Acanvas=window.bxgCanvas}else{if(window.bluegaT){bxg.Acanvas=window.bluegaT}else{bxg.Trace.log("BXG","error","Cannot load Acanvas module.","AR")}}bxg.$HtP.call(this);this.$EZ=bxg.$Huv;this.$EH=bxg.$Hun};bx.$Inherit(bxg.$HtO,bxg.$HtP);bxg.CAcanvasRenderer_onInit=function(a){if(bxg.$HtO.onInit){bxg.$HtO.onInit(a)}};bxg.$HtO.prototype.$EC=function(c,b){this.$DF=c||{};bxg.$HtO.onInit=b;var a=bx.HCL.getElementRect(bxg.world);bxg.Acanvas.initCanvasView(a.x+bxg.area.x,a.y+bxg.area.y,this.$DF.$GF.w,this.$DF.$GF.h,"bxg.CAcanvasRenderer_onInit");bxg.$Hud.$Hug(0);this.$8r=new bxg.$Hub(0,this.$DF.$GF.w,this.$DF.$GF.h);this.$A8=this.$8r.canvas;this.$8t=[]};bxg.$HtO.prototype.$EQ=function(){bxg.$Hud.$Huj();if(this.$8v){bxg.Acanvas.renderCanvas()}};bxg.$HtO.prototype.$HuP=function(b,c){var a={};this.$Hum=this.$Hum||1;bxg.Acanvas.createBufferCanvas(this.$Hum,b,c);bxg.$Hud.$Hug(this.$Hum);a.$8r=new bxg.$Hub(this.$Hum,b,c);a.$A8=a.$8r.canvas;this.$Hum++;return a};bxg.$HtO.prototype.$HuQ=function(a){bxg.Acanvas.deleteBufferCanvas(a.$8r.id)};bxg.$HtO.prototype.$HuR=function(b,a,c){bxg.Acanvas.clearCanvas(b.id)};bxg.$HtO.prototype.$HuS=function(i,e,d,f,b,g,k,j,a,c){bxg.Acanvas.copyCanvasArea(i.id,e,d,f,b,k,j)};bxg.$Hun=function(a){if(bx.inClassing){return}bxg.$HuO.call(this,a)};bx.$Inherit(bxg.$Hun,bxg.$HuO);bxg.$Hun.prototype.$FF=function(b,a){if(!a&&this.$DF.$GJ==b){return false}if(!b){return false}if(b.position){this.$HQ.w=b.size.w;this.$HQ.h=b.size.h}else{this.$HQ.w=b.w;this.$HQ.h=b.h}this.$DF.$GJ=b;this.$HT();return true};bxg.$Huv=function(a){bxg.$HuZ.call(this,a)};bx.$Inherit(bxg.$Huv,bxg.$HuZ);bxg.$Huv.prototype.$FJ=function(a){if(this.$DF.$GF.w!=a.w&&this.$DF.$GF.h!=a.h){this.$DF.$GF=a;if(this.$8x){bxg.Trace.log("BXG","error","This renderer does not support of area resizing.","RD.RA")}}};bxg.$Huv.prototype.$GV=function(b,a){this.$9b=this.$9b||{};this.$9c=this.$9c||{};this.$9d=this.$8x&&a?this.$8x.$8r:this.$8m;this.$9e=this.$8g;this.$9f=this.$8j;if(this.$8x&&a){if(this.$8x.$8y){this.$9e=0;this.$9f=0}else{if(this.$8x.$9g){}else{this.$9e=this.$8x.$9h.x;this.$9f=this.$8x.$9h.y}}}if(this.$HsK){this.$9e=0;this.$9f=0}this.$9b.x=-this.$9e;this.$9b.y=-this.$9f;this.$9b.w=this.$9d.canvas.width;this.$9b.h=this.$9d.canvas.height;if(b.$DF.$GJ){if(b.$DF.$GJ.opacity!==undefined||b.$DF.$HuY!==undefined){if(b.$DF.$HuY!==undefined){this.$9d.setAlpha(b.$DF.$HuY)}else{this.$9d.setAlpha(b.$DF.$GJ.opacity)}}if(b.$DF.$D9&bxg.$7u){if(b.$DF.$GW){this.$9j=b.$7g+this.$9e;this.$9i=b.$7h+this.$9f}else{this.$9j=this.$9e;this.$9i=this.$9f}this.$9d.drawImagePattern(b.$DF.$GJ.$9M,0,0,b.$DF.$GW?b.$DF.$GW.w:this.$DF.$GF.w,b.$DF.$GW?b.$DF.$GW.h:this.$DF.$GF.h,this.$9j,this.$9i)}else{this.$9c.x=(b.$7g+b.$HQ.x);this.$9c.y=(b.$7h+b.$HQ.y);this.$9c.w=b.$HQ.w;this.$9c.h=b.$HQ.h;if(bxg.Geometry.intersect_rect_rect(this.$9b,this.$9c)){if(b.$DF.$GJ.position){this.$9d.drawImageClip(b.$DF.$GJ.$9M,b.$7g+this.$9e,b.$7h+this.$9f,b.$DF.$GJ.size.w,b.$DF.$GJ.size.h,-b.$DF.$GJ.position.x,-b.$DF.$GJ.position.y)}else{this.$Huw=0;this.$Hux=0;this.$Huy=0;if(b.$DF.$GW){this.$Huw=b.$DF.$GW.w;this.$Hux=b.$DF.$GW.h}if(b.$DF.$GK){this.$Huy=b.$DF.$GK}this.$9d.drawImage(b.$DF.$GJ.$9M,b.$7g+this.$9e,b.$7h+this.$9f,this.$Huw,this.$Hux,this.$Huy,0)}}}if(b.$DF.$GJ.opacity!==undefined||b.$DF.$HuY!==undefined){this.$9d.setAlpha(1)}}else{if(b.$DF.$GD&&b.$DF.$GD.$GZ){if(b.$DF.$GD.$D9==1){this.$9c.x=(b.$7g+b.$HQ.x);this.$9c.y=(b.$7h+b.$HQ.y);this.$9c.w=b.$HQ.w;this.$9c.h=b.$HQ.h;if(b.$DF.$GW){if(bxg.Geometry.intersect_rect_rect(this.$9b,this.$9c)){b.$DF.$GD.$D8=b.$DF.$GD.$D8||{};b.$DF.$GD.$D8.area=b.$DF.$GD.$D8.area||{};b.$DF.$GD.$D8.area.x=b.$7g+this.$9e;b.$DF.$GD.$D8.area.y=b.$7h+this.$9f;b.$DF.$GD.$D8.area.w=b.$HQ.w;b.$DF.$GD.$D8.area.h=b.$HQ.h;b.$DF.$GD.$GZ(this.$9d,b.$DF.$GD.$D8)}}}else{if(b.$DF.$GD.$D9==2){b.$DF.$GD.$D8=b.$DF.$GD.$D8||{};b.$DF.$GD.$D8.area=b.$DF.$GD.$D8.area||{};b.$DF.$GD.$D8.area.x=this.$9b.x;b.$DF.$GD.$D8.area.y=this.$9b.y;b.$DF.$GD.$D8.area.w=this.$9b.w;b.$DF.$GD.$D8.area.h=this.$9b.h;b.$DF.$GD.$GZ(this.$9d,b.$DF.$GD.$D8)}}}}};bxg.$Huv.prototype.$8d=function(){return undefined};bxg.CTileMap=function(d,c,a,b){if(bx.inClassing){return}this.$HsN=d;this.$82=c;this.$D4=a;this.isCreated=false};bxg.CTileMap.TYPE_TILE=1;bxg.CTileMap.TYPE_FRINGE=2;bxg.CTileMap.TYPE_OBJECT=3;bxg.CTileMap.TYPE_NPC=4;bxg.CTileMap.ACTIVATE_ON_CREATE=1;bxg.CTileMap.ACTIVATE_ON_SHOW=2;bxg.CTileMap.ACTIVATE_ON_MARK=3;bxg.CTileMap.ACTIVATE_ON_LOGIC=4;bxg.CTileMap.prototype.addObject=function(c,b,a,d){return this.$Huo(c,b,a,d)};bxg.CTileMap.prototype.addTile=function(c,b,a,d){return this.$ZAN(c,b,a,d)};bxg.CTileMap.prototype.getObjectList=function(){return this.$CR};bxg.CTileMap.prototype.removeTile=function(d,a,f,e){if(!this.map||!this.map[d]){bxg.Trace.log("BXG","error","No Tilemap data for layer="+d,"CTileMap.removeTile");return false}var c;if(c=this.map[d][f][a]){this.$HsU(c.bxgData,a,f,true);switch(c.bxgData.type){case bxg.CTileMap.TYPE_FRINGE:if(((bxg.$9I&bxg.$E8)||(bxg.$9I&bxg.$HtL))&&this.layers[d].$GH){this.layers[d].$GH.$HT();break}case bxg.CTileMap.TYPE_TILE:if(c.tile){c.tile.destroy()}break;case bxg.CTileMap.TYPE_OBJECT:if(c.object){if(!e){c.object.destroy()}}for(var b=0;b<this.$HtB.length;b++){if(this.$HtB[b]==this.map[d][f][a]){this.$HtB.splice(b,1);break}}break}delete this.map[d][f][a];return true}return false};bxg.CTileMap.prototype.moveTile=function(f,g,e,c,a){if(!this.map||!this.map[f]){bxg.Trace.log("BXG","error","No Tilemap data for layer="+f,"CTileMap.moveTile");return false}var b;var h;if((b=this.map[f][e][g])&&!this.map[f][c][a]){this.map[f][a][c]={};this.map[f][a][c].bxgData=b.bxgData;this.$HsU(b.bxgData,g,e,true);this.$HsU(b.bxgData,c,a);switch(b.bxgData.type){case bxg.CTileMap.TYPE_FRINGE:if(((bxg.$9I&bxg.$E8)||(bxg.$9I&bxg.$HtL))&&this.layers[f].$GH){this.layers[f].$GH.$HT();break}case bxg.CTileMap.TYPE_TILE:var j;if(b.tile){if(this.$82.perspective&&b.bxgData.object){j=(this.layers[f].$2G.object+a*bxg.CTileMap.$AK)}else{j=this.layers[f].$2G.tile}b.tile.setZindex(j);if(b.tile.control){h=this.getTilePosition(b.bxgData,c,a);b.tile.move(h.x,h.y)}this.map[f][a][c].tile=b.tile}break;case bxg.CTileMap.TYPE_OBJECT:if(b.object){this.$H2(f,b.bxgData,c,a,b.object);if(b.object.control){h=this.getTilePosition(b.bxgData,c,a,b.object.size);b.object.move(h.x,h.y)}this.map[f][a][c].object=b.object;for(var d=0;d<this.$HtB.length;d++){if(this.$HtB[d]==this.map[f][e][g]){this.$HtB[d]=this.map[f][a][c];break}}if(b.$H6){this.map[f][a][c].$H6=b.$H6;this.map[f][a][c].$H6.$HsP=c;this.map[f][a][c].$H6.$HsP=c;this.$HtC()}this.$HtB.$HsS=false}break}delete this.map[f][e][g];return true}return false};bxg.CTileMap.prototype.isObstacle=function(a,b){if(a<0||a>this.$82.cols-1){return true}if(b<0||b>this.$82.rows-1){return true}if(this.$BO){return this.$BO[this.$82.cols*b+a]}return false};bxg.CTileMap.prototype.isObstacleByPosition=function(a,b){this.$HsX=this.$HsX||{};this.toGridCoord(a,b,this.$HsX);return this.isObstacle(this.$HsX.x,this.$HsX.y)};bxg.CTileMap.prototype.checkObstacleByPosition=function(a,c,b){this.$HsX=this.$HsX||{};this.$HsY=false;this.toGridCoord(a,c,this.$HsX);if(this.isObstacle(this.$HsX.x,this.$HsX.y)){if(this.$HsX.y<0){if(b==0){this.$HsY=true}this.$HsX.y=0}if(this.$HsX.y>this.$82.rows-1){if(b==4){this.$HsY=true}this.$HsX.y=this.$82.rows-1}if(this.$HsX.x<0){if(b==2){this.$HsY=true}this.$HsX.x=0}if(this.$HsX.x>this.$82.cols-1){if(b==6){this.$HsY=true}this.$HsX.x=this.$82.cols-1}this.toPixelCoord(this.$HsX.x,this.$HsX.y,this.$HsX);if(b==0||b==4){if(a>=this.$HsX.x&&a<=this.$HsX.x+this.$84.w){if(b==0){if(this.$HsY){return 0}else{return this.$HsX.y+this.$84.h}}else{if(this.$HsY){this.$HsX.y+this.$84.h}else{return this.$HsX.y}}}}else{if(b==2||b==6){if(c>=this.$HsX.y&&c<=this.$HsX.y+this.$84.h){if(b==2){if(this.$HsY){return 0}else{return this.$HsX.x+this.$84.w}}else{if(this.$HsY){this.$HsX.x+this.$84.w}else{return this.$HsX.x}}}}}}return null};bxg.CTileMap.prototype.showGridGuide=function(a){if(!((bxg.$9I&bxg.$E8)||(bxg.$9I&bxg.$HtL))){bxg.Trace.log("BXG","warnDeviceCapability","CANVAS. Display Tile-guide only with Canvas render. Checkout renderer setting.","CTileMap.showGridGuide");return}this.$HsZ=a||this.$HsZ||{strokeStyle:{r:0,g:0,b:0}};if(!this.$Hsa){var c=this;function b(d,f){if(c.$HsZ.strokeStyle){bxg.Canvas.setStrokeStyle(d,c.$HsZ.strokeStyle.r,c.$HsZ.strokeStyle.g,c.$HsZ.strokeStyle.b,c.$HsZ.strokeStyle.a)}if(f.area.x!=0||f.area.y!=0){var e=c.toGridCoord(f.area.x,f.area.y);var g=c.toPixelCoord(e.x,e.y);f.area.w=f.area.w+Math.max(0,f.area.x-g.x);f.area.h=f.area.h+Math.max(0,f.area.y-g.y);f.area.x=g.x-f.area.x;f.area.y=g.y-f.area.y}bxg.Canvas.drawGrid(d,c.$82.type,f.area,c.$84);if(c.$HsZ.strokeStyle){bxg.Canvas.restoreStrokeStyle(d)}}this.$Hsa=bxg.$E9.$7l({$D9:bxg.$7t,$F6:this.$HsN.getZindexTop(),$GD:{$D9:2,$GZ:b}})}if(!this.$Hsa.$HsJ()){this.$HsN.$EM.$F5(this.$Hsa,true)}this.$Hsa.$F4(true)};bxg.CTileMap.prototype.hideGridGuide=function(){if(this.$Hsa){this.$Hsa.$F4(false)}else{bxg.Trace.log("BXG","warning","Try to hide Tile-guide, but it is not created, yet.","CTileMap.hideGriduide")}};bxg.CTileMap.prototype.walkTo=function(a,d,c,b){b=b||{};this.$Hsb=bxg.CTileMap.$Z29(this.getType(),a,d);b.x=a+bxg.CTileMap.$BR[this.$Hsb][c].x;b.y=d+bxg.CTileMap.$BR[this.$Hsb][c].y;if(b.x<0){b.x=0}if(b.x>this.$82.cols-1){b.x=this.$82.cols-1}if(b.y<0){b.y=0}if(b.y>this.$82.rows-1){b.y=this.$82.rows-1}return b};bxg.CTileMap.prototype.toPixelCoord=function(a,c,b){return bxg.CTileMap.$Z27(this.$82.type,this.$84,a,c,b)};bxg.CTileMap.prototype.toGridCoord=function(a,c,b){return bxg.CTileMap.$Z28(this.$82.type,this.$84,a,c,b)};bxg.CTileMap.prototype.getGridSize=function(){return this.$84};bxg.CTileMap.prototype.getMapSize=function(a){return bxg.CTileMap.$Z24(this.$82.type,this.$84,0,0,this.$82.cols,this.$82.rows,{viewport:true},a)};bxg.CTileMap.$AK=3;bxg.CTileMap.$Z21=1;bxg.CTileMap.$Z22=2;bxg.CTileMap.$Z23=3;bxg.CTileMap.prototype.create=function(){if(!this.$82){bxg.Trace.log("BXG","noProperty","data","CTileMap()");return this}var d,c,b;this.$CR=[];this.$HtB=[];this.layers=this.$82.layers;for(b in this.layers){this.layers[b].$2G={tile:0,fringe:0,object:0,sprite:0,player:0}}if(this.$82.tiles){this.map={};for(b in this.layers){this.map[b]=new Array(this.$82.rows);for(d=0;d<this.map[b].length;d++){this.map[b][d]=new Array(this.$82.cols)}}this.$BO=new Array(this.$82.cols*this.$82.cols)}if(this.$82.sprites){this.$AL={};for(b in this.layers){this.$AL[b]=[]}}if(this.$82.$CH){this.$CH=[]}this.$84={};if(this.$82.size&&this.$82.size.w&&this.$82.size.h){this.$84.w=this.$82.size.w;this.$84.h=this.$82.size.h;this.$84.c=this.$82.size.c}else{this.$84.w=Math.floor(this.$HsN.area.w/this.$82.cols);this.$84.h=Math.floor(this.$HsN.area.h/this.$82.rows);this.$84.c=0}this.$2G=0;var h,g;var a;var e;var l;var f;this.$9k=false;for(b in this.layers){this.$2G+=1;this.layers[b].$2G.tile=this.$2G++;this.layers[b].$2G.fringe=this.$2G++;this.layers[b].$2G.object=this.$2G;this.layers[b].$9k=this.$9k;if(this.map){for(d=0;d<this.$82.tiles[b].length;d++){if(this.$82.tiles[b][d].type==bxg.CTileMap.TYPE_NPC){this.$Huo(b,this.$82.tiles[b][d],undefined,undefined,true)}else{this.$ZAN(b,this.$82.tiles[b][d],undefined,undefined,true)}}}if(((bxg.$9I&bxg.$E8)||(bxg.$9I&bxg.$HtL))&&!(bxg.$9I&bxg.$E7)){this.layers[b].$9G=true}if(this.layers[b].useObject){this.layers[b].$9G=true}if(this.layers[b].$9G||this.layers[b].$AN){this.$2G=this.layers[b].$2G.object+this.$82.rows*bxg.CTileMap.$AK;this.$9k=true}this.layers[b].$2G.sprite=this.$2G;if(this.$AL){f=0;for(d=0;d<this.$82.sprites[b].length;d++){e=this.$82.sprites[b][d];l={};l.bxgData=e;l.pos=this.getTilePosition(e,e.coord.x,e.coord.y);l.tile=new bxg.CImage(e.img,{baseLayer:!this.$9k,resize:l.bxgData.$9W,rotate:l.bxgData.rotate,zIndex:this.layers[b].$2G.sprite+bx.$checkNaN(l.bxgData.$2G)});this.$AL[b].push(l);f=Math.max(f,bx.$checkNaN(l.bxgData.$2G))}this.$2G+=f}if(this.$CH){for(d=0;d<this.$82.$CH[b].length;d++){a=this.$82.$CH[b][d];item={};item.bxgData=a;item.pos=this.toPixelCoord(a.coord.x,a.coord.y);this.$CH.push(item)}}this.$2G+=1;this.layers[b].$2G.player=this.$2G}this.isCreated=true;return this};bxg.CTileMap.prototype.destroy=function(){if(this.$A7){this.deactivate()}var c;var a,d,b;for(c in this.layers){if(this.map){for(d=0;d<this.map[c].length;d++){for(a=0;a<this.map[c][d].length;a++){if(b=this.map[c][d][a]){if(b.tile){this.map[c][d][a].tile.destroy();delete this.map[c][d][a].tile}else{if(b.object){this.map[c][d][a].object.destroy();delete this.map[c][d][a].object}}delete this.map[c][d][a]}}}}b=null;if(this.$AL){for(a=0;a<this.$AL[c].length;a++){if(this.$AL[c][a]){this.$AL[c][a].tile.destroy();delete this.$AL[c][a].tile}}}}for(a=0;a<this.$CR.length;a++){if(this.$CR[a].object){this.$CR[a].object.destroy();delete this.$CR[a].object}}delete this.$CR;delete this.$HtB;if(this.$GC){this.$GC.destroy();delete this.$GC}if(this.$Hsa){this.$Hsa.$F1();delete this.$Hsa}if(this.map){delete this.map}if(this.$BO){delete this.$BO}if(this.$AL){delete this.$AL}if(this.layers){delete this.layers}if(this.$82){delete this.$82}if(this.$D4){delete this.$D4}if(this.$HsN){delete this.$HsN}return null};bxg.CTileMap.prototype.getType=function(){return this.$82.type};bxg.CTileMap.prototype.getTilePosition=function(b,a,e,d,c){this.$Hsf=this.$Hsf||{};this.$Hsg=null;c=this.toPixelCoord(a,e,c);if(b.offset){if(!d){if(b.type==bxg.CTileMap.TYPE_TILE||b.type==bxg.CTileMap.TYPE_FRINGE){if(b.size&&b.size.w*b.size.h>1){bxg.CTileMap.$Z24(this.$82.type,this.$84,0,0,b.size.w,b.size.h,{diamond:true},this.$Hsf);this.$Hsg=this.$Hsf}else{this.$Hsg=this.$84}}}else{this.$Hsg=d}this.$D7(c,b.offset,this.$Hsg)}bxg.CTileMap.$Z2A(this.$82.type,b.size,this.$84,c);return c};bxg.CTileMap.toDiamondCoord=function(e,a,f,d,c,b){b=b||{};if(e==bxg.CTileMap.$Z22||e==bxg.CTileMap.$Z23){b.x=Math.ceil((d+(f%2==0&&d>0?-1:0))/2);b.y=-d;b.x=b.x+Math.ceil((c+((f+b.y)%2==0&&c>0?-1:0))/2);b.y=b.y+c}else{b.x=d;b.y=c}return b};bxg.CTileMap.prototype.getTilePositionByGrid=function(c,a,d,b){if(this.map&&this.map[c][d][a]){return this.getTilePosition(this.map[c][d][a].bxgData,a,d,this.map[c][d][a].object?this.map[c][d][a].object.size:undefined,b)}return null};bxg.CTileMap.prototype.getZindex=function(a,b){if(!a||!b){return 0}if(this.layers[a]&&this.layers[a].$2G&&this.layers[a].$2G[b]!==undefined){return this.layers[a].$2G[b]}return 0};bxg.CTileMap.prototype.$Huo=function(d,b,a,h,g){var f;if(!d||!b){bxg.Trace.log("BXG","errorParameter","layer="+d+", tileInfo="+b,"CTileMap.addObject");return null}if(!b.id||!b.activate){bxg.Trace.log("BXG","noProperty","tileInfo id="+b.id+", activate="+b.activate,"CTileMap.addObject");return null}if((isNaN(parseInt(a))||isNaN(parseInt(h)))&&(!b.coord||isNaN(parseInt(b.coord.x))||isNaN(parseInt(b.coord.y)))){bxg.Trace.log("BXG","errorParameter","No gridX, gridY nor no coord{} in tileInfo{}","CTileMap.addObject");return null}if(!(isNaN(parseInt(a))||isNaN(parseInt(h)))){}else{a=b.coord.x;h=b.coord.y}if(a<0||a>this.$82.cols-1||h<0||h>this.$82.rowls-1){bxg.Trace.log("BXG","errorParameter","Out of tile space gridX="+a+", gridY="+h+", px="+px+", py="+py,"CTileMap.addObject");return null}if(!this.map||!this.map[d]||!this.map[d][h]){bxg.Trace.log("BXG","errorParameter","No map data for layer="+d+" and gridY="+h,"CTileMap.addObject");return null}if(!bxg.ObjectFactory.$HA(b.id)){bxg.Trace.log("BXG","unknownObject","type="+b.id,"CTileMap.addObject");return null}if(!g&&!this.layers[d].$9G){bxg.Trace.log("BXG","error","Cannot add object into the layer("+d+") which doesn't have any object in creation time","CTileMap.addObject");return null}if(!this.layers[d].$9G){this.layers[d].$9G=true}if(this.$D4){var c=true;if(b.activate==bxg.CTileMap.ACTIVATE_ON_SHOW){if(bxg.ObjectFactory.$HA(b.id).$H3){c=false}}if(c){if(!(f=this.$H2(d,b,a,h))){return false}}else{f=null}var e={$HsW:b.activate};if(f){e.$H3=f.size;e.object=f}else{e.$HsO=b;e.$HsV=d;e.$HsP=a;e.$HsQ=h;e.$H3=bxg.ObjectFactory.$HA(b.id).$H3}e.$Hh=this.getTilePosition(b,a,h,e.$H3);if(!g){e.$Hup=true}this.$CR.push(e);this.$CR.$HsS=false;if(this.$A7){if(b.activate!=bxg.CTileMap.ACTIVATE_ON_SHOW){this.$HsT(e.object,e.$Hh,undefined,e.$HsW)}}return e}return null};bxg.CTileMap.prototype.$ZAN=function(f,b,g,e,c){var d;if(!f||!b){bxg.Trace.log("BXG","errorParameter","layer="+f+", tileInfo="+b,"CTileMap.addTile");return false}if(b.type==bxg.CTileMap.TYPE_TILE){if(b.img===undefined){bxg.Trace.log("BXG","noProperty","tileInfo img="+b.img,"CTileMap.addTile");return false}}else{if(b.type==bxg.CTileMap.TYPE_OBJECT){if(!b.id||!b.activate){bxg.Trace.log("BXG","noProperty","tileInfo id="+b.id+", activate="+b.activate,"CTileMap.addTile");return false}}else{if(b.type==bxg.CTileMap.TYPE_FRINGE){if(!b.id||!b.img||!b.fringe){bxg.Trace.log("BXG","noProperty","tileInfo id="+b.id+", img="+b.img+", fringe="+b.fringe,"CTileMap.addTile");return false}}else{bxg.Trace.log("BXG","noProperty","Invalid tileInfo.type="+b.type,"CTileMap.addTile");return false}}}if((isNaN(parseInt(g))||isNaN(parseInt(e)))&&(!b.coord||isNaN(parseInt(b.coord.x))||isNaN(parseInt(b.coord.y)))){bxg.Trace.log("BXG","warnAddToTile","No gridX, gridY nor tileInfo.coord","CTileMap.addTile");return false}if(!(isNaN(parseInt(g))||isNaN(parseInt(e)))){if(bxg.$Hp&&(this.$82.$Huq===undefined||this.$82.$Huq==3)){bxg.CTileMap.prototype.addTile.$84=this.toGridCoord(g,e,bxg.CTileMap.prototype.addTile.$84||{});g=bxg.CTileMap.prototype.addTile.$84.x;e=bxg.CTileMap.prototype.addTile.$84.y;b.coord={x:g,y:e}}}else{g=b.coord.x;e=b.coord.y}bxg.CTileMap.prototype.addTile.$8I=g;bxg.CTileMap.prototype.addTile.$8J=e;if(g<0||g>this.$82.cols-1||e<0||e>this.$82.rowls-1){bxg.Trace.log("BXG","warnAddToTile","Out of tile space gridX="+g+",gridY="+e+"from("+bxg.CTileMap.prototype.addTile.$8I+","+bxg.CTileMap.prototype.addTile.$8J+")","CTileMap.addTile");return false}if(!this.map||!this.map[f]||!this.map[f][e]){bxg.Trace.log("BXG","warnAddToTile","No map data for layer="+f+" and gridY="+e,"CTileMap.addTile");return false}if(!c&&!this.layers[f].$9G){bxg.Trace.log("BXG","error","Cannot add object into the layer("+f+") which doesn't have any object in creation time","CTileMap.addObject");return false}var i;var k;var a;if(!this.map[f][e][g]){this.map[f][e][g]={};a=this.map[f][e][g];a.bxgData=b;this.$HsU(b,g,e);switch(b.type){case bxg.CTileMap.TYPE_FRINGE:if(((bxg.$9I&bxg.$E8)||(bxg.$9I&bxg.$HtL))){this.layers[f].$9F=true;break}case bxg.CTileMap.TYPE_TILE:if(b.img&&bxg.images[b.img]&&bxg.images[b.img].url){if(this.$82.perspective&&b.object){this.layers[f].$AN=true;k=(this.layers[f].$2G.object+e*bxg.CTileMap.$AK);this.$9k=true;a.tile=new bxg.CImage(b.img,{baseLayer:false,rotate:b.rotate,zIndex:k})}else{k=this.layers[f].$2G.tile;a.tile=new bxg.CImage(b.img,{baseLayer:!this.layers[f].$9k,rotate:b.rotate,zIndex:k})}}else{if(b.img!==null){bxg.Trace.log("BXG","unknownImageId",b.img+" in "+b.id,"CTileMap.addTile")}}break;case bxg.CTileMap.TYPE_OBJECT:if(!this.layers[f].$9G){this.layers[f].$9G=true}if(this.$D4){i=true;if(b.activate==bxg.CTileMap.ACTIVATE_ON_SHOW){if(bxg.ObjectFactory.$HA(b.id).$H3){i=false}}if(i){if(!(d=this.$H2(f,b,g,e))){return false}a.object=d}else{d=null}if(b.activate==bxg.CTileMap.ACTIVATE_ON_SHOW){var h={};h.$HsP=g;h.$HsQ=e;h.$HsV=f;h.$H3=bxg.ObjectFactory.$HA(b.id).$H3;a.$H6=h;this.$HtB.push(a);this.$HtB.$HsS=false}}break}if(this.$A7){if(a.tile){this.$HsN.add(a.tile);var j=this.getTilePosition(a.bxgData,g,e);a.tile.move(j.x,j.y)}else{if(a.object){var j=this.getTilePosition(a.bxgData,g,e,a.object.size);this.$HsT(a.object,j,undefined,a.bxgData.activate)}else{if(a.$H6){this.$HtC()}}}}return this.map[f][e][g]}bxg.Trace.log("BXG","warnAddToTile","Not empty grid is layer="+f+" gridX="+g+",gridY="+e+"from("+bxg.CTileMap.prototype.addTile.$8I+","+bxg.CTileMap.prototype.addTile.$8J+")","CTileMap.addTile");return false};bxg.CTileMap.prototype.$H2=function(c,b,a,f,e){var d;if(e){d=e}else{d=this.$D4(this,undefined,b)}if(d){if(this.$82.perspective){d.setZindex(this.layers[c].$2G.object+f*bxg.CTileMap.$AK)}else{d.setZindex(this.layers[c].$2G.object)}if(e){d.data.bxgMap.coord.x=a;d.data.bxgMap.coord.y=f}else{d.data.bxgMap={coord:{x:a,y:f},layer:c,offset:b.offset}}}return d};bxg.CTileMap.prototype.$HsT=function(c,a,d,b){this.$HsN.add(c);if(a){c.move(a.x+(d?d.x:0),a.y+(d?d.y:0))}c.activate();if(b==bxg.CTileMap.ACTIVATE_ON_SHOW||b==bxg.CTileMap.ACTIVATE_ON_CREATE){if(!c.$79){c.render();c.show()}}};bxg.CTileMap.prototype.$HtR=function(){var b,j,g;var c={x:0,w:this.$82.cols,y:0,h:this.$82.rows};if(this.$82.background&&this.$82.background.img){if(!this.$GC){this.$GC=new bxg.CImage(this.$82.background.img,{baseLayer:true,pattern:true,zIndex:0})}this.$HsN.add(this.$GC)}var h={};var a;var d=this;this.$HtB.$HsS=false;for(b in this.layers){if(this.map){for(g=c.y;g<c.y+c.h;g++){for(j=c.x;j<c.x+c.w;j++){if(a=this.map[b][g][j]){if(a.tile){this.$HsN.add(a.tile);this.getTilePosition(a.bxgData,j,g,undefined,h);a.tile.move(h.x,h.y)}else{if(a.object){if(a.bxgData.activate==bxg.CTileMap.ACTIVATE_ON_CREATE){this.getTilePosition(a.bxgData,j,g,a.object.size,h);this.$HsT(a.object,h,undefined,a.bxgData.activate)}}}}}}if(this.layers[b].$9F){if(!this.layers[b].$GH){var e={};function f(i,k){d.$D6(k.area,e);e.canvasX=k.area.x;e.canvasY=k.area.y;d.$GE(k.$CF,i,e)}this.layers[b].$GH=bxg.$E9.$7l({$D9:(this.layers[b].$9k?0:bxg.$7t),$F6:this.layers[b].$2G.fringe*bxg.$9Y.$EF+this.$HsN.getZindexBase(),$GD:{$D9:2,$GZ:f,$D8:{$CF:this.map[b]}}})}this.$HsN.$EM.$F5(this.layers[b].$GH,this.layers[b].$9k?false:true);this.layers[b].$GH.$F4(true)}}if(this.$AL){for(j=0;j<this.$AL[b].length;j++){if(this.$AL[b][j]){if(this.$AL[b][j].bxgData.$9W){this.$AL[b][j].pos.w=this.$AL[b][j].bxgData.$9W.w;this.$AL[b][j].pos.h=this.$AL[b][j].bxgData.$9W.h}else{this.$AL[b][j].pos.w=bxg.images[this.$AL[b][j].bxgData.img].w;this.$AL[b][j].pos.h=bxg.images[this.$AL[b][j].bxgData.img].h}this.$HsN.add(this.$AL[b][j].tile);this.$AL[b][j].tile.move(this.$AL[b][j].pos.x,this.$AL[b][j].pos.y)}}}}this.$CR.$HsS=false;for(j=0;j<this.$CR.length;j++){if(this.$CR[j].$HsW==bxg.CTileMap.ACTIVATE_ON_CREATE){this.$HsT(this.$CR[j].object,this.$CR[j].$Hh,undefined,this.$CR[j].$HsW)}}this.$A7=true;return this};bxg.CTileMap.prototype.$Hur=function(){var b={x:0,w:this.$82.cols,y:0,h:this.$82.rows};var d;var a,f;var c;for(d in this.layers){if(this.map){for(f=b.y;f<b.y+b.h;f++){for(a=b.x;a<b.x+b.w;a++){if(c=this.map[d][f][a]){if(c.tile&&c.tile.control){this.$HsN.remove(c.tile)}else{if(c.object&&c.object.control){this.$HsN.remove(c.object)}}}}}}if(this.layers[d].$GH){if(this.$HsN.$EM.$F7){this.$HsN.$EM.$F7(this.layers[d].$GH)}}if(this.$AL){var e={};for(a=0;a<this.$AL[d].length;a++){if(this.$AL[d][a]){this.$HsN.remove(this.$AL[d][a].tile)}}}}for(a=0;a<this.$CR.length;a++){if(this.$CR[a].$Hup){if(this.$CR[a].object){this.$CR[a].object.destroy();this.$CR.splice(a,1);a--}}else{if(this.$CR[a].object&&this.$CR[a].object.control){this.$HsN.remove(this.$CR[a].object)}}}if(this.$GC){this.$HsN.remove(this.$GC)}if(this.$Hsa){if(this.$HsN.$EM.$F7){this.$HsN.$EM.$F7(this.$Hsa)}}this.$A7=false};bxg.CTileMap.prototype.$Hsc=function(a,e,b,c){var a;this.$Hsd=this.$Hsd||{};this.$Hse=this.$Hse||{};this.$Hsd.x=a;this.$Hsd.y=e;this.$Hsd.w=b;this.$Hsd.h=c;if(!this.$CR.$HsS){var d=false;for(a=0;a<this.$CR.length;a++){if(this.$CR[a].$HsW==bxg.CTileMap.ACTIVATE_ON_SHOW){if(!this.$CR[a].object||!this.$CR[a].object.control){d=true;this.$Hse.x=this.$CR[a].$Hh.x;this.$Hse.y=this.$CR[a].$Hh.y;this.$Hse.w=this.$CR[a].$H3.w;this.$Hse.h=this.$CR[a].$H3.h;if(bxg.Geometry.intersect_rect_rect(this.$Hsd,this.$Hse)){if(!this.$CR[a].object){this.$CR[a].object=this.$H2(this.$CR[a].$HsV,this.$CR[a].$HsO,this.$CR[a].$HsP,this.$CR[a].$HsQ)}this.$HsT(this.$CR[a].object,this.$CR[a].$Hh,undefined,this.$CR[a].$HsW)}}}}if(!d){this.$CR.$HsS=true}}this.$HtC()};bxg.CTileMap.prototype.$HtC=function(){if(this.$Hsd&&!this.$HtB.$HsS){var a;var b=false;for(a=0;a<this.$HtB.length;a++){if(this.$HtB[a].bxgData.activate==bxg.CTileMap.ACTIVATE_ON_SHOW){if(!this.$HtB[a].object||!this.$HtB[a].object.control){b=true;this.getTilePosition(this.$HtB[a].bxgData,this.$HtB[a].$H6.$HsP,this.$HtB[a].$H6.$HsQ,this.$HtB[a].$H6.$H3,this.$Hse);this.$Hse.w=this.$HtB[a].$H6.$H3.w;this.$Hse.h=this.$HtB[a].$H6.$H3.h;if(bxg.Geometry.intersect_rect_rect(this.$Hsd,this.$Hse)){if(!this.$HtB[a].object){this.$HtB[a].object=this.$H2(this.$HtB[a].$H6.$HsV,this.$HtB[a].bxgData,this.$HtB[a].$H6.$HsP,this.$HtB[a].$H6.$HsQ)}this.$HsT(this.$HtB[a].object,this.$Hse,undefined,this.$HtB[a].bxgData.activate);a--}}}}if(!b){this.$HtB.$HsS=true}}};bxg.CTileMap.prototype.$HsU=function(d,c,f,b){if(d.obstacle){if(!d.size||d.size.w*d.size.h<=1){if(d.obstacle){this.$BO[this.$82.cols*f+c]=!b}}else{var a,e;this.$Hsh=this.$Hsh||{};for(e=0;e<d.size.h;e++){for(a=0;a<d.size.w;a++){bxg.CTileMap.toDiamondCoord(this.$82.type,c,f,a,e,this.$Hsh);if(f+this.$Hsh.y<0||c+this.$Hsh.x<0){continue}if(f+this.$Hsh.y>this.$82.rows-1||c+this.$Hsh.x>this.$82.cols-1){continue}if(d.obstacle instanceof Array&&d.obstacle.length){if(d.obstacle[e]&&d.obstacle[e].length&&d.obstacle[e][a]){this.$BO[this.$82.cols*(f+this.$Hsh.y)+(c+this.$Hsh.x)]=!b}}else{this.$BO[this.$82.cols*(f+this.$Hsh.y)+(c+this.$Hsh.x)]=!b}}}}}};bxg.CTileMap.prototype.$GE=function(e,j,f){if(!((bxg.$9I&bxg.$E8)||(bxg.$9I&bxg.$HtL))){return}if(!e||!j){bxg.Trace.log("BXG","errorParameter","data="+e+", ctxt="+j,"CTileMap.CF");bxg.Trace.data(e);return}var h=this;function g(r,t,i,u,s,q,n){return h.$BS(r,t,i,u,s,q,n)}var m,l,a;var d,p,c,o={};var b={};var k={};for(p in h.$82.tileInfo){if(!h.$82.tileInfo[p].fringe){continue}for(l=f.y;l<f.y+f.h;l++){for(m=f.x;m<f.x+f.w;m++){a=e[l][m];if(a&&a.bxgData.id==p){if(a.bxgData.img&&bxg.images[a.bxgData.img]&&bxg.images[a.bxgData.img].$9M){this.toPixelCoord(m,l,k);k.x-=f.canvasX;k.y-=f.canvasY;j.drawImage(bxg.images[a.bxgData.img].$9M,k.x,k.y)}}o=bxg.CTileMap.$Z2B(e,this.$82.type,m,l,this.$82.cols,this.$82.rows,bxg.CTileMap.$BT,!(a&&a.bxgData),o);for(c in o){if(!o[c]){continue}if(c!=p){continue}if(a&&a.bxgData&&a.bxgData.fringe&&a.bxgData.id==p){continue}b=bxg.CTileMap.$Z2C(this.$82.type,e,c,m,l,this.$82.cols,this.$82.rows,!(a&&a.bxgData),g,b);if(b){this.toPixelCoord(m,l,k);k.x-=f.canvasX;k.y-=f.canvasY;bxg.CTileMap.$Z2D(this.$82.type,j,undefined,b.$__data,b.$__type,k.x,k.y)}}}}}};bxg.CTileMap.$Z27=function(d,c,a,e,b){b=b||{};if(d==bxg.CTileMap.$Z21){b.x=a*c.w;b.y=e*c.h}else{if(d==bxg.CTileMap.$Z23){b.y=(c.h-c.c)*(e-1);b.x=-((e+1)%2)*Math.floor(c.w/2)+a*c.w}else{if(e%2==0){b.y=Math.floor((e/2)*c.h-c.h/2);b.x=Math.floor(a*c.w-c.w/2)}else{b.y=Math.floor(e/2)*c.h;b.x=a*c.w}}}return b};bxg.CTileMap.$Z28=function(d,a,h,e,c){c=c||{};if(a){if(d==bxg.CTileMap.$Z21){c.x=Math.floor(h/a.w);c.y=Math.floor(e/a.h)}else{if(d==bxg.CTileMap.$Z23){c.y=Math.floor(e/(a.h-a.c))+1;c.x=Math.floor((h+((c.y+1)%2)*a.w/2)/a.w);var i,g;var b;var f=a.c/(a.w/2);bxg.CTileMap.$Z28.$8G=bxg.CTileMap.$Z28.$8G||{};bxg.CTileMap.$Z27(d,a,c.x,c.y,bxg.CTileMap.$Z28.$8G);i=h-(bxg.CTileMap.$Z28.$8G.x+a.w/2);g=e-(bxg.CTileMap.$Z28.$8G.y+a.h/2);g=-g;b=f*i+a.h/2;if(g>b){if(c.y%2==0){c.x-=1}c.y-=1;return c}b=f*i-a.h/2;if(g<b){if(c.y%2==1){c.x+=1}c.y+=1;return c}b=-f*i+a.h/2;if(g>b){if(c.y%2==1){c.x+=1}c.y-=1;return c}b=-f*i-a.h/2;if(g<b){if(c.y%2==0){c.x-=1}c.y+=1;return c}return c}else{c.x=Math.floor(h/a.w);c.y=Math.floor(e/a.h)*2+1;var i,g;var b;var f=a.h/a.w;bxg.CTileMap.$Z28.$8G=bxg.CTileMap.$Z28.$8G||{};bxg.CTileMap.$Z27(d,a,c.x,c.y,bxg.CTileMap.$Z28.$8G);i=h-(bxg.CTileMap.$Z28.$8G.x+a.w/2);g=e-(bxg.CTileMap.$Z28.$8G.y+a.h/2);g=-g;b=f*i+a.h/2;if(g>b){c.y-=1;return c}b=f*i-a.h/2;if(g<b){c.x+=1;c.y+=1;return c}b=-f*i+a.h/2;if(g>b){c.x+=1;c.y-=1;return c}b=-f*i-a.h/2;if(g<b){c.y+=1;return c}return c}}}else{c.x=h;c.y=e}return c};bxg.CTileMap.prototype.$D6=function(b,a){this.$Hsi=this.$Hsi||{};this.$Hsi.x=b.x;this.$Hsi.y=b.y;this.$Hsi.w=b.w;this.$Hsi.h=b.h;a=a||{};a.offsetX=0;a.offsetY=0;if(this.$Hsi.x<0){a.offsetX=-this.$Hsi.x;this.$Hsi.w+=this.$Hsi.x;this.$Hsi.x=0}if(this.$Hsi.y<0){a.offsetY=-this.$Hsi.y;this.$Hsi.h+=this.$Hsi.y;this.$Hsi.y=0}switch(this.$82.type){case bxg.CTileMap.$Z22:a.y=Math.min(Math.floor(this.$Hsi.y/(this.$84.h/2)),this.$82.rows-1);a.h=Math.min(Math.ceil((this.$Hsi.h+this.$84.h/2)/(this.$84.h/2)),this.$82.rows-a.y);if(a.y%2){a.x=Math.min(Math.floor((this.$Hsi.x-this.$84.w/2)/this.$84.w),this.$82.cols-1);a.w=Math.min(Math.ceil(this.$Hsi.w/this.$84.w),this.$82.cols-a.x)}else{a.x=Math.min(Math.floor(this.$Hsi.x/this.$84.w),this.$82.cols-1);a.w=Math.min(Math.ceil((this.$Hsi.w+this.$84.w/2)/this.$84.w),this.$82.cols-a.x)}break;case bxg.CTileMap.$Z23:a.y=Math.min(Math.floor(this.$Hsi.y/(this.$84.h-this.$84.c)),this.$82.rows-1);a.h=Math.min(Math.ceil((this.$Hsi.h+this.$84.c)/(this.$84.h-this.$84.c)),this.$82.rows-a.y);if(a.y%2){a.x=Math.min(Math.floor((this.$Hsi.x-this.$84.c)/this.$84.w),this.$82.cols-1);a.w=Math.min(Math.ceil(this.$Hsi.w/this.$84.w),this.$82.cols-a.x)}else{a.x=Math.min(Math.floor(this.$Hsi.x/this.$84.w),this.$82.cols-1);a.w=Math.min(Math.ceil((this.$Hsi.w+this.$84.c)/this.$84.w),this.$82.cols-a.x)}break;case bxg.CTileMap.$Z21:a.x=Math.min(Math.floor(this.$Hsi.x/this.$84.w),this.$82.cols-1);a.y=Math.min(Math.floor(this.$Hsi.y/this.$84.h),this.$82.rows-1);a.w=Math.min(Math.ceil(this.$Hsi.w/this.$84.w),this.$82.cols-a.x);a.h=Math.min(Math.ceil(this.$Hsi.h/this.$84.h),this.$82.rows-a.y);break}return a};bxg.CTileMap.prototype.$D7=function(c,b,a){if(b.left){c.x+=b.left}else{if(b.right!==undefined&&a){c.x=c.x+this.$84.w-(a.w+b.right)}}if(b.top){c.y+=b.top}else{if(b.bottom!==undefined&&a){c.y=c.y+this.$84.h-(a.h+b.bottom)}}};bxg.CTileMap.$Z24=function(h,b,e,d,f,c,a,g){g=g||{};bxg.CTileMap.$Z27(h,b,e,d,g);if(h==bxg.CTileMap.$Z21){g.w=f*b.w;g.h=c*b.h}else{if(h==bxg.CTileMap.$Z23){if(a&&a.diamond){g.w=(f<=1?f*b.w:b.w+(f-1)*Math.floor(b.w/2))+Math.max(0,c-1)*Math.floor(b.w/2);g.h=(c<=1?c*b.h:b.h+(c-1)*(b.h-b.c))+Math.max(0,f-1)*(b.h-b.c)}else{g.w=f*b.w-Math.floor(b.w/2);g.h=Math.max(0,c-2)*(b.h-b.c)+b.c}}else{if(a&&a.diamond){g.w=(f<=1?f*b.w:b.w+(f-1)*Math.floor(b.w/2))+Math.max(0,c-1)*Math.floor(b.w/2);g.h=(c<=1?c*b.h:b.h+(c-1)*Math.floor(b.h/2))+Math.max(0,f-1)*Math.floor(b.h/2)}else{var i={};bxg.CTileMap.$Z27(h,b,e+f-1,d+c-1,i);g.w=(i.x-g.x)+b.w;g.h=(i.y-g.y)+b.h;if(a&&a.viewport){g.w-=b.w*1;g.h-=b.h*1}}}}return g};bxg.CTileMap.$DG=0;bxg.CTileMap.$DH=1;bxg.CTileMap.$DI=2;bxg.CTileMap.$Z29=function(b,a,c){if(b==bxg.CTileMap.$Z22||b==bxg.CTileMap.$Z23){if(c%2){return bxg.CTileMap.$DI}else{return bxg.CTileMap.$DH}}else{return bxg.CTileMap.$DG}};bxg.CTileMap.$BR=[[{x:0,y:-1,dstX:0,dstY:-1},{x:-1,y:-1,dstX:-1,dstY:-1},{x:-1,y:0,dstX:-1,dstY:0},{x:-1,y:1,dstX:-1,dstY:1},{x:0,y:1,dstX:0,dstY:1},{x:1,y:1,dstX:1,dstY:1},{x:1,y:0,dstX:1,dstY:0},{x:1,y:-1,dstX:1,dstY:-1}],[{x:0,y:-2,dstX:0,dstY:-1},{x:-1,y:-1,dstX:-0.5,dstY:-0.5},{x:-1,y:0,dstX:-1,dstY:0},{x:-1,y:1,dstX:-0.5,dstY:0.5},{x:0,y:2,dstX:0,dstY:1},{x:0,y:1,dstX:0.5,dstY:0.5},{x:1,y:0,dstX:1,dstY:0},{x:0,y:-1,dstX:0.5,dstY:-0.5}],[{x:0,y:-2,dstX:0,dstY:-1},{x:0,y:-1,dstX:-0.5,dstY:-0.5},{x:-1,y:0,dstX:-1,dstY:0},{x:0,y:1,dstX:-0.5,dstY:0.5},{x:0,y:2,dstX:0,dstY:1},{x:1,y:1,dstX:0.5,dstY:0.5},{x:1,y:0,dstX:1,dstY:0},{x:1,y:-1,dstX:0.5,dstY:-0.5}]];bxg.CTileMap.$Z2A=function(c,b,a,d){if(!b||(!b.w||!b.h)){return d}if(b.w*b.h==1){return d}d=d||{x:0,y:0};switch(c){case bxg.CTileMap.$Z22:d.y+=-Math.max(0,b.w-1)*Math.floor(a.h/2);break;case bxg.CTileMap.$Z23:d.y+=-Math.max(0,b.w-1)*(a.h-a.c);break}return d};bxg.CTileMap.$Z2D=function(d,b,e,g,c,a,f){if(!c||c=="oooo"){return}this.$Hsj=this.$Hsj||{};for(this.$Hsk=0;this.$Hsk<4;this.$Hsk++){this.$Hsl=c.charAt(this.$Hsk);if(this.$Hsl=="o"){continue}this.$Hsj.reflection=undefined;this.$Hsj.rotation=undefined;if(this.$Hsl!="n"){if(d==bxg.CTileMap.$Z22){if(this.$Hsk%2==0){this.$Hsl="h_"+this.$Hsl;this.$Hsj.rotation=Math.floor(this.$Hsk/2)*180}else{this.$Hsl="v_"+this.$Hsl;this.$Hsj.rotation=Math.floor(this.$Hsk/2)*180}}else{this.$Hsj.reflection=this.$Hsk*90}}if(!g.imgs[this.$Hsl]){bxg.Trace.log("BXG","errorFringe",this.$Hsl);continue}if(e){if(g.imgs[this.$Hsl] instanceof Array){e.src=g.imgs[this.$Hsl][Math.floor(Math.random()*g.imgs[this.$Hsl].length)]}else{e.src=g.imgs[this.$Hsl]}bxg.Canvas.drawImage(b,e,a,f,undefined,undefined,this.$Hsj.rotation,this.$Hsj.reflection)}else{if(g.imgs[this.$Hsl] instanceof Array){this.$Hsm=g.$Hsr+"_"+this.$Hsl+"_"+Math.floor(Math.random()*g.imgs[this.$Hsl].length)}else{this.$Hsm=g.$Hsr+"_"+this.$Hsl+"_0"}if(bxg.images[this.$Hsm]){bxg.Canvas.drawImage(b,bxg.images[this.$Hsm].$9M,a,f,undefined,undefined,this.$Hsj.rotation,this.$Hsj.reflection)}}}};bxg.CTileMap.prototype.$BS=function(f,e,a,g,d,c,b){if(a<0||g<0){return null}if(a>d-1||g>c-1){return null}this.$Hsn=f[g][a];if(this.$Hsn&&this.$Hsn.bxgData&&this.$Hsn.bxgData.fringe){if(b&&this.$Hsn.bxgData.fringe&&this.$Hsn.bxgData.fringe.background==e){return this.$82.tileInfo[e].fringe}else{if(this.$Hsn.bxgData.id==e){return this.$Hsn.bxgData.fringe}}}return null};bxg.CTileMap.$BT=function(e,a,f,d,c,b){if(a<0||f<0){return null}if(a>d-1||f>c-1){return null}this.$Hso=e[f][a];if(this.$Hso&&this.$Hso.bxgData&&this.$Hso.bxgData.fringe){if(b&&this.$Hso.bxgData.fringe.background){return this.$Hso.bxgData.fringe.background}else{return this.$Hso.bxgData.id}}return null};bxg.CTileMap.$Z2B=function(e,c,g,f,a,d,j,b,i){this.$Hsp=bxg.CTileMap.$Z29(c,g,f);var h;i=i||{};for(this.$Hsq in i){i[this.$Hsq]=null}for(this.$Hsq=0;this.$Hsq<bxg.CTileMap.$Z2C.$93[this.$Hsp].length;this.$Hsq++){h=bxg.CTileMap.$BR[this.$Hsp][bxg.CTileMap.$Z2C.$93[this.$Hsp][this.$Hsq]];this.$Hss=j(e,g+h.x,f+h.y,a,d,b);if(this.$Hss){if(!i[this.$Hss]){i[this.$Hss]=true}if(b){this.$Hss=j(e,g+h.x,f+h.y,a,d,false);if(!i[this.$Hss]){i[this.$Hss]=true}}}}return i};bxg.CTileMap.$Z2C=function(i,d,b,g,f,a,e,c,j,h){if(g<0||f<0){return}h=h||{};this.$Hst=this.$Hst||new Array(10);this.$Hsu=bxg.CTileMap.$Z29(i,g,f);h.$__data=null;h.$__type="";for(this.$Hsv=0;this.$Hsv<bxg.CTileMap.$Z2C.$93[this.$Hsu].length;this.$Hsv++){this.$Hsw=bxg.CTileMap.$BR[this.$Hsu][bxg.CTileMap.$Z2C.$93[this.$Hsu][this.$Hsv]];this.$Hst[this.$Hsv+1]=j(d,b,g+this.$Hsw.x,f+this.$Hsw.y,a,e,c);if(this.$Hst[this.$Hsv+1]&&!h.$__data){h.$__data=this.$Hst[this.$Hsv+1]}}if(this.$Hst[1]&&!this.$Hst[2]&&!this.$Hst[8]){h.$__type+="c"}else{if(this.$Hst[2]&&!this.$Hst[8]){h.$__type+="h"}else{if(this.$Hst[2]&&this.$Hst[8]){h.$__type+="x"}else{if(!this.$Hst[2]&&this.$Hst[8]){h.$__type+="v"}else{h.$__type+="o"}}}}if(this.$Hst[3]&&!this.$Hst[2]&&!this.$Hst[4]){h.$__type+="c"}else{if(this.$Hst[2]&&!this.$Hst[4]){h.$__type+="h"}else{if(this.$Hst[2]&&this.$Hst[4]){h.$__type+="x"}else{if(!this.$Hst[2]&&this.$Hst[4]){h.$__type+="v"}else{h.$__type+="o"}}}}if(this.$Hst[5]&&!this.$Hst[4]&&!this.$Hst[6]){h.$__type+="c"}else{if(this.$Hst[4]&&!this.$Hst[6]){h.$__type+="v"}else{if(this.$Hst[4]&&this.$Hst[6]){h.$__type+="x"}else{if(!this.$Hst[4]&&this.$Hst[6]){h.$__type+="h"}else{h.$__type+="o"}}}}if(this.$Hst[7]&&!this.$Hst[8]&&!this.$Hst[6]){h.$__type+="c"}else{if(this.$Hst[6]&&!this.$Hst[8]){h.$__type+="h"}else{if(this.$Hst[6]&&this.$Hst[8]){h.$__type+="x"}else{if(!this.$Hst[6]&&this.$Hst[8]){h.$__type+="v"}else{h.$__type+="o"}}}}if(h.$__type!="oooo"){return h}else{return null}};bxg.CTileMap.$Z2C.$93=[[1,0,7,6,5,4,3,2],[2,1,0,7,6,5,4,3],[2,1,0,7,6,5,4,3]];bxg.WalkerTileMap={};bxg.WalkerTileMap.set=function(b,a){a=a||{};if(!a.tileMap&&b.control&&b.control.level&&b.control.level.getTileMap()){a.tileMap=b.control.level.getTileMap()}if(!a.offset&&b.data.bxgMap&&b.data.bxgMap.offset){a.offset=b.data.bxgMap.offset}if(!a.tileMap||!b.data.bxgMap){bxg.Trace.log("BXG","error","Only objects in the tilemap can be handled by by WalkerTileMapoptions. Error type:id="+b.type+":"+b.id,"WalkerTileMap.set");return}if(a.speed&&!a.steps){a.steps=a.speed}if(!a.steps){bxg.Trace.log("BXG","noProperty","options steps="+a.steps,"WalkerTileMap.set");bxg.Trace.data(a);return}b.data.$HtH=b.data.$HtH||{};b.data.$HtH.$5p=a;b.data.$HtH.$5p.offset=b.data.$HtH.$5p.offset||{left:0,top:0};b.data.$HtH.$5p.layer=b.data.bxgMap.layer;b.data.$HtH.$HtI=b.data.bxgMap.coord;b.data.$HtH.$HtJ=false;var c=b.data.$HtH.$5p.tileMap.toPixelCoord(b.data.$HtH.$HtI.x,b.data.$HtH.$HtI.y);a.tileMap.$D7(c,b.data.$HtH.$5p.offset,b.size);b.move(c.x,c.y);b.data.$HtH.$AQ=b.data.$HtH.$5p.tileMap.getZindex(b.data.$HtH.$5p.layer,"object");if(b.data.$HtH.$5p.tileMap.$82.perspective){b.setZindex(b.data.$HtH.$AQ+b.data.$HtH.$HtI.y*bxg.CTileMap.$AK+(b.data.$HtH.$5p.player?(bxg.CTileMap.$AK-1):0))}else{if(b.data.$HtH.$5p.player){b.setZindex(b.data.$HtH.$5p.tileMap.getZindex(b.data.$HtH.$5p.layer,"player"))}else{b.setZindex(b.data.$HtH.$AQ)}}};bxg.WalkerTileMap.isMoving=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","obj="+a,"WalkerTileMap.isMoving");return false}if(a.data.$HtH){return a.data.$HtH.$HtJ}else{return false}};bxg.WalkerTileMap.canMove=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","obj="+a,"WalkerTileMap.canMove")}if(a.data.$HtH){return a.data.$HtH.$HtK}else{bxg.Trace.log("BXG","warning","This object is not walking with WalkerTileMap, type="+a.id,"WalkerTileMap.canMove");return false}};bxg.WalkerTileMap.getGridPosition=function(a){if(!a){bxg.Trace.log("BXG","errorParameter","obj="+a,"WalkerTileMap.getGridPosition");return null}if(a.data.bxgMap){return a.data.bxgMap.coord}else{bxg.Trace.log("BXG","warning","This object is not walking with WalkerTileMap, type="+a.id,"WalkerTileMap.getGridPosition");return false}};bxg.WalkerTileMap.move=function(c,a,b){c.data.$HtH.$8V=false;c.data.$HtH.$HtK=false;if(a&&a.turnOnly){if(!isNaN(parseInt(a.dir))){c.data.$HtH.$5p.dir=a.dir}delete a.turnOnly;if(c.$79&&c.$79.onWalkerEnd){c.$79.onWalkerEnd(c,bxg.game.$9J)}}else{if(a&&!isNaN(parseInt(a.dir))&&!c.data.$HtH.$HtJ){if(a.turn&&a.dir!=c.data.$HtH.$5p.dir){c.data.$HtH.$5p.dir=a.dir;if(c.$79&&c.$79.onWalkerEnd){c.$79.onWalkerEnd(c,bxg.game.$9J)}}else{c.data.$HtH.$8Z=a.dir;c.data.$HtH.$AR=bxg.CTileMap.$Z29(c.data.$HtH.$5p.tileMap.getType(),c.data.$HtH.$HtI.x,c.data.$HtH.$HtI.y);c.data.$HtH.$BI=bxg.CTileMap.$BR[c.data.$HtH.$AR][a.dir];if(c.data.$HtH.$BI){c.data.$HtH.$AT=c.data.$HtH.$BI;c.data.$HtH.$8V=true}c.data.$HtH.__moveSteps=c.data.$HtH.$5p.steps}}}if(c.data.$HtH.$8V){c.data.$HtH.$91=c.data.$HtH.$AT.dstX*c.data.$HtH.$5p.tileMap.getGridSize().w/c.data.$HtH.__moveSteps;c.data.$HtH.$92=c.data.$HtH.$AT.dstY*c.data.$HtH.$5p.tileMap.getGridSize().h/c.data.$HtH.__moveSteps;c.data.$HtH.$C4=c.data.$HtH.$HtI.x+c.data.$HtH.$AT.x;c.data.$HtH.$C5=c.data.$HtH.$HtI.y+c.data.$HtH.$AT.y;c.data.$HtH.$BK=c.data.$HtH.$5p.tileMap.isObstacle(c.data.$HtH.$C4,c.data.$HtH.$C5);if(!c.data.$HtH.$BK&&c.data.$HtH.$5p.tiles&&c.data.$HtH.$5p.tiles.on){for(c.data.$HtH.$BJ in c.data.$HtH.$5p.tileMap.layers){if(c.data.$HtH.$5p.tileMap.map[c.data.$HtH.$BJ][c.data.$HtH.$C5][c.data.$HtH.$C4]&&c.data.$HtH.$5p.tileMap.map[c.data.$HtH.$BJ][c.data.$HtH.$C5][c.data.$HtH.$C4].bxgData){if(c.data.$HtH.$5p.tiles.on[c.data.$HtH.$5p.tileMap.map[c.data.$HtH.$BJ][c.data.$HtH.$C5][c.data.$HtH.$C4].bxgData.id]){c.data.$HtH.$BK=100;break}}}if(c.data.$HtH.$BK==100){c.data.$HtH.$BK=false}else{c.data.$HtH.$BK=true}}if(!c.data.$HtH.$BK&&c.data.$HtH.$5p.tiles&&c.data.$HtH.$5p.tiles.off){for(c.data.$HtH.$BJ in c.data.$HtH.$5p.tileMap.layers){if(c.data.$HtH.$5p.tileMap.map[c.data.$HtH.$BJ][c.data.$HtH.$C5][c.data.$HtH.$C4]&&c.data.$HtH.$5p.tileMap.map[c.data.$HtH.$BJ][c.data.$HtH.$C5][c.data.$HtH.$C4].bxgData){if(c.data.$HtH.$5p.tiles.on[c.data.$HtH.$5p.tileMap.map[c.data.$HtH.$BJ][c.data.$HtH.$C5][c.data.$HtH.$C4].bxgData.id]){c.data.$HtH.$BK=true;break}}}}if(c.data.$HtH.$8U||!c.data.$HtH.$BK){if(!b){c.data.$HtH.$HtJ=true;c.data.$HtH.$HtI.x=c.data.$HtH.$HtI.x+c.data.$HtH.$AT.x;c.data.$HtH.$HtI.y=c.data.$HtH.$HtI.y+c.data.$HtH.$AT.y;if(c.data.$HtH.$5p.tileMap.$82.perspective){c.setZindex(c.data.$HtH.$AQ+c.data.$HtH.$HtI.y*bxg.CTileMap.$AK+(c.data.$HtH.$5p.player?(bxg.CTileMap.$AK-1):0))}c.data.$HtH.$90=0}else{c.data.$HtH.$HtK=true}}else{if(c.$79&&c.$79.onWalkerEnd){c.$79.onWalkerEnd(c,bxg.game.$9J)}}if(!b){c.data.$HtH.$5p.dir=c.data.$HtH.$8Z}}if(c.data.$HtH.$HtJ){c.moveBy(c.data.$HtH.$91,c.data.$HtH.$92);c.data.$HtH.$90++;if(c.data.$HtH.$90==c.data.$HtH.__moveSteps){c.data.$HtH.$Hsx=c.data.$HtH.$Hsx||{};c.data.$HtH.$5p.tileMap.toPixelCoord(c.data.$HtH.$HtI.x,c.data.$HtH.$HtI.y,c.data.$HtH.$Hsx);c.data.$HtH.$5p.tileMap.$D7(c.data.$HtH.$Hsx,c.data.$HtH.$5p.offset,c.size);c.move(c.data.$HtH.$Hsx.x,c.data.$HtH.$Hsx.y);if(c.$79&&c.$79.onWalkerEnd){c.$79.onWalkerEnd(c,bxg.game.$9J)}else{bxg.Trace.log("BXG","warning","In most cases, WalkerTileMap needs onWalkerEnd() to contorol bxg.CObject. onWalkerEnd() is missing on manager of object="+c.type,"WalkerTileMap.move")}c.data.$HtH.$HtJ=false}}};bxg.Canvas=bxg.Canvas||{};bxg.Canvas.drawGrid=function(d,e,f,a,m){var g=y=0;var h;bxg.Canvas.pathBegin(d);if(e==bxg.CTileMap.$Z21){if(a&&a.w){while(g<=f.w){h=g==f.w&&(m&&m.fillEnd)?-1:0;bxg.Canvas.drawLine(d,f.x+g+h,f.y,f.x+g+h+0.5,f.y+f.h-1);g+=a.w}}if(a&&a.h){while(y<=f.h){h=y==f.h&&(m&&m.fillEnd)?-1:0;bxg.Canvas.drawLine(d,f.x,f.y+y+h,f.x+f.w-1,f.y+y+h);y+=a.h}}}else{if(e==bxg.CTileMap.$Z23){if(m&&m.diamond){var n=Math.floor(a.w/2),k=a.h-a.c;var c,b;for(c=0;c<m.diamond.w;c++){for(b=0;b<m.diamond.h;b++){g=c*n+b*n;y=k*(m.diamond.w-1)+b*k-c*k;bxg.Canvas.drawLine(d,f.x+g+Math.floor(a.w/2),f.y+y,f.x+g+a.w,f.y+y+a.c);bxg.Canvas.drawLine(d,f.x+g+a.w,f.y+y+a.c,f.x+g+a.w,f.y+y+(a.h-a.c));bxg.Canvas.drawLine(d,f.x+g+a.w,f.y+y+(a.h-a.c),f.x+g+Math.floor(a.w/2),f.y+y+a.h);bxg.Canvas.drawLine(d,f.x+g+Math.floor(a.w/2),f.y+y+a.h,f.x+g,f.y+y+(a.h-a.c));bxg.Canvas.drawLine(d,f.x+g,f.y+y+(a.h-a.c),f.x+g,f.y+y+a.c);bxg.Canvas.drawLine(d,f.x+g,f.y+y+a.c,f.x+g+Math.floor(a.w/2),f.y+y)}}}else{var l=0;y=-(a.h-a.c);while(y<=f.h){g=-((l+1)%2)*Math.floor(a.w/2);while(g<=f.w){bxg.Canvas.drawLine(d,f.x+g+Math.floor(a.w/2),f.y+y,f.x+g+a.w,f.y+y+a.c);bxg.Canvas.drawLine(d,f.x+g+a.w,f.y+y+a.c,f.x+g+a.w,f.y+y+(a.h-a.c));bxg.Canvas.drawLine(d,f.x+g+a.w,f.y+y+(a.h-a.c),f.x+g+Math.floor(a.w/2),f.y+y+a.h);bxg.Canvas.drawLine(d,f.x+g+Math.floor(a.w/2),f.y+y+a.h,f.x+g,f.y+y+(a.h-a.c));bxg.Canvas.drawLine(d,f.x+g,f.y+y+(a.h-a.c),f.x+g,f.y+y+a.c);bxg.Canvas.drawLine(d,f.x+g,f.y+y+a.c,f.x+g+Math.floor(a.w/2),f.y+y);g+=a.w}y+=(a.h-a.c);l++}}}else{if(m&&m.diamond){var n=Math.floor(a.w/2),k=Math.floor(a.h/2);var c,b;for(c=0;c<m.diamond.w;c++){for(b=0;b<m.diamond.h;b++){g=c*n+b*n;y=k*m.diamond.w+b*k-c*k;bxg.Canvas.drawLine(d,f.x+g,f.y+y,f.x+g+n,f.y+y-k);bxg.Canvas.drawLine(d,f.x+g+n,f.y+y-k,f.x+g+2*n,f.y+y);bxg.Canvas.drawLine(d,f.x+g+2*n,f.y+y,f.x+g+n,f.y+y+k);bxg.Canvas.drawLine(d,f.x+g+n,f.y+y+k,f.x+g,f.y+y)}}}else{g=-Math.ceil(f.w/a.w)*a.w+Math.floor(a.w/2);while(g<=f.w){bxg.Canvas.drawLine(d,f.x+g,f.y+0,f.x+g+f.h*(a.w/a.h),f.y+f.h);g+=a.w}g=-Math.floor(a.w/2);while(g<=f.w*2){bxg.Canvas.drawLine(d,f.x+g,f.y+0,f.x+g-f.h*(a.w/a.h),f.y+f.h);g+=a.w}}}}bxg.Canvas.pathEnd(d)};bxg.CTileMap.prototype.$Hsy=function(b,a,e){var c;if(c=this.map[b][e][a]){switch(c.bxgData.type){case bxg.CTileMap.TYPE_OBJECT:if(c.object){var d=this.getTilePosition(c.bxgData,a,e,c.obj.size);c.object.move(d.x,d.y);if(!c.object.active&&c.bxgData.activate==bxg.CTileMap.ACTIVATE_ON_CREATE){c.object.activate();if(!c.object.$79){c.object.render();c.object.show()}}}break}}};bxg.CTileMap.prototype.getPosition=bxg.CTileMap.prototype.toPixelCoord;bxg.CTileMap.prototype.getCoord=bxg.CTileMap.prototype.toGridCoord;bxg.module={LEVEL:1,MAP_DATA:2,SHARED:3,URI:4};bxg.module.load=function(j,d,f,k,c){var b=d+".js";var m=1;var n,h,l;if(c){if(j==bxg.module.LEVEL){n="levels"}else{if(j==bxg.module.MAP_DATA){n="maps"}else{if(f){f(false)}return false}}b=n+"/"+b}else{if(j==bxg.module.LEVEL){n="levels";b=n+"/"+b}else{if(j==bxg.module.MAP_DATA){n="map";b=n+"/"+d+"/"+b}else{if(j==bxg.module.SHARED){n="shared";b=bxg.module.$B2()+d+"/"+b}else{if(j==bxg.module.URI){b=d}else{if(f){f(false)}return false}}}}}b=bxg.module.applyPath(k,b);m=bxg.module.$BC(j==bxg.module.SHARED);if(bx.Loader.$6d){bxgrnif.getCurrentGameId(function e(o){l=o;bxgrnif.isResourceStored(l,b,g)})}else{return bx.HCL.importModule(b,m,false,i,a)}function g(o){if(o==true){try{h=bx.HCL.importData(b,i,a,{protocol:m,noCache:bxg.$6j});if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","[ret:"+h+"]stored:"+b,"module.load")}if(h==false){h=-1;a()}}catch(p){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","[ex:"+p+"]stored:"+b,"module.load")}if(h!==-1){a()}}}else{if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","NOT stored:"+b,"module.load")}a()}}function i(){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","OK import "+b+"(type:"+j+") by pr "+m,"module.load")}if(f){f(true)}}function a(){if(!bx.Loader.$6d){if(f){f(false)}return}var t=bxgrnif.getBXGDataUrl(l,n,d);switch(j){case bxg.module.LEVEL:bxgrnif.saveFile(t,l,n+"/"+d+".js",s,q);break;case bxg.module.MAP_DATA:bxgrnif.saveZipFile(t,l,n+"/"+d,s,q,o("map"));break;case bxg.module.SHARED:bxgrnif.saveZipFile(t,l,"../"+n+"/"+d,s,q,o("shared obj"));break;case bxg.module.URI:default:if(f){f(false)}return false}function q(){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Getting remote Fail:"+t,"module.load")}if(f){f(false)}}function o(u){bx.UX.messageBox("Loading "+u+"...")}function s(){bx.HCL.importData(b,r,p,{protocol:2,noCache:bxg.$6j})}function r(){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Remote load OK:"+t,"module.load")}if(f){f(true)}}function p(){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Remote load Fail:"+t,"module.load")}if(f){f(false)}}}};bxg.module.applyPath=function(a,b){if(b.indexOf("./")==0){b=b.substring(2)}if(a&&b.charAt(0)!="/"&&b.indexOf("..")==-1&&b.indexOf("data:")!=0&&b.indexOf("http:")!=0&&b.indexOf("https:")!=0&&b.indexOf("filesystem:")!=0&&b.indexOf("ftp:")!=0){return a+"/"+b}else{return b}};bxg.module.$B2=function(){if(location.protocol=="http:"||location.protocol=="https:"){return"/bxg/shared/"}else{return"../shared/"}};bxg.module.$BC=function(a){if(bxg.$CA=="local"||bxg.$CA=="bxg"){return 2}else{if(a){if(location.protocol=="http:"||location.protocol=="https:"){return 1}else{return 2}}else{return 1}}};bxg.mapDataMgr={active:null};bxg.mapDataMgr.register=function(mapData){if(!mapData){bxg.Trace.log("BXG","errorParameter","mapData="+mapData,"mapDataMgr.register");return false}if(!mapData.id||!mapData.type||!mapData.data){bxg.Trace.log("BXG","noProperty","MapData id="+mapData.id+", type="+mapData.type+", data="+mapData.data,"mapDataMgr.register");return false}if(!mapData.data.rows||!mapData.data.cols||!mapData.data.size){bxg.Trace.log("BXG","noProperty","MapData.data.rows="+mapData.data.rows+", cols="+mapData.data.cols+", size="+mapData.data.size,"mapDataMgr.register");return false}if(mapData.data.levels&&!mapData.data.controls){mapData.data.controls=mapData.data.levels}if(!mapData.data.controls||!mapData.data.layers||!mapData.data.tiles){bxg.Trace.log("BXG","noProperty","MapData.data.controls="+mapData.data.controls+", layers="+mapData.data.layers+", tiles="+mapData.data.tiles,"mapDataMgr.register");return false}if(mapData.version===undefined){mapData.version=3}if(!(mapData.version==1||mapData.version==2||mapData.version==3)){bxg.Trace.log("BXG","noProperty","Unknown MapData version="+mapData.version,"mapDataMgr.register");return false}for(var lyr in mapData.data.layers){mapData.data.tiles["_bxg$obstacle_"+lyr]={bxg$systemTile:{type:"obstacle"},obstacle:true,layer:lyr}}for(var i in mapData.data.tiles){mapData.data.tiles[i].id=i}if(mapData.data.controls){var cntrlInfo;for(cntrlInfo in mapData.data.controls){if(mapData.data.controls[cntrlInfo].level&&!mapData.data.controls[cntrlInfo].control){mapData.data.controls[cntrlInfo].control=mapData.data.controls[cntrlInfo].level}if(mapData.data.controls[cntrlInfo].control){try{mapData.data.controls[cntrlInfo].control.execClass=eval(mapData.data.controls[cntrlInfo].control.className)}catch(ex){bxg.Trace.log("BXG","unknownClass",mapData.data.controls[cntrlInfo].control.className,"mapDataMgr.register");return false}if(!mapData.data.controls[cntrlInfo].control.execClass){bxg.Trace.log("BXG","unknownClass",mapData.data.controls[cntrlInfo].control.className,"mapDataMgr.register");return false}if(mapData.data.controls[cntrlInfo].control.configure){mapData.data.controls[cntrlInfo].control.config=mapData.data.controls[cntrlInfo].control.configure()}}if(mapData.data.controls[cntrlInfo].logic){try{mapData.data.controls[cntrlInfo].logic.execClass=eval(mapData.data.controls[cntrlInfo].logic.className)}catch(ex){bxg.Trace.log("BXG","unknownClass",mapData.data.controls[cntrlInfo].logic.className,"mapDataMgr.register");return false}if(!mapData.data.controls[cntrlInfo].logic.execClass){bxg.Trace.log("BXG","unknownClass",mapData.data.controls[cntrlInfo].logic.className,"mapDataMgr.register");return false}if(mapData.data.controls[cntrlInfo].logic.configure){mapData.data.controls[cntrlInfo].logic.config=mapData.data.controls[cntrlInfo].logic.configure()}}}for(var cntrl in mapData.data.controls){if(mapData.data.controls[cntrl].control&&mapData.data.controls[cntrl].control.className){switch(mapData.data.controls[cntrl].control.className){case"bxg.CPagedScrollLevel":if(!mapData.data.page||!(mapData.data.page.h||mapData.data.page.w)){}else{var paneSize=0;mapData.data.controls[cntrl].control.config=mapData.data.controls[cntrl].control.config||{};if(mapData.data.page.h){paneSize=bxg.CTileMap.$Z24(bxg.CTileMapLevel.$Z25(mapData.type),mapData.data.size,0,0,1,mapData.data.page.h,{});mapData.data.controls[cntrl].control.config.paneSize=paneSize.h}else{if(mapData.data.page.w){paneSize=bxg.CTileMap.$Z24(bxg.CTileMapLevel.$Z25(mapData.type),mapData.data.size,0,0,mapData.data.page.w,1,{});mapData.data.controls[cntrl].control.config.paneSize=paneSize.w}}}break}}}}bxg.$7L[mapData.id]=mapData;return true};bxg.mapDataMgr.get=function(a){if(!bxg.$7L[a]){bxg.Trace.log("BXG","unknownMapData",a,"mapDataMgr.get")}return bxg.$7L[a]};bxg.mapDataMgr.$HA=function(a){return bxg.$7L[a]};bxg.mapDataMgr.applyImagePath=function(a,g){if(!g){return}var m;var e,d,c,b;if(!(m=bxg.mapDataMgr.get(a))){return false}function h(i){return bxg.module.applyPath(g,i)}function f(j,i){for(b=0;b<i.length;b++){i[b].img=h(i[b].img)}}if(m.data&&m.data.tiles){for(e in m.data.tiles){if(m.data.tiles[e].tile){if(m.data.tiles[e].tile.img){m.data.tiles[e].tile.img=h(m.data.tiles[e].tile.img)}else{if(m.data.tiles[e].tile.set){f(e,m.data.tiles[e].tile.set)}}}else{if(m.data.tiles[e].sprite&&m.data.tiles[e].sprite.img){m.data.tiles[e].sprite.img=h(m.data.tiles[e].sprite.img)}else{if(m.data.tiles[e].background){if(m.data.tiles[e].background.img){m.data.tiles[e].background.img=h(m.data.tiles[e].background.img)}else{if(m.data.tiles[e].background.set){f(e,m.data.tiles[e].background.set)}}}else{if(m.data.tiles[e].fringe&&m.data.tiles[e].fringe.imgs){for(d in m.data.tiles[e].fringe.imgs){if(m.data.tiles[e].fringe.imgs[d]){if(m.data.tiles[e].fringe.imgs[d] instanceof Array){for(c=0;c<m.data.tiles[e].fringe.imgs[d].length;c++){m.data.tiles[e].fringe.imgs[d][c]=h(m.data.tiles[e].fringe.imgs[d][c])}}else{m.data.tiles[e].fringe.imgs[d]=h(m.data.tiles[e].fringe.imgs[d])}}else{bxg.Trace.log("BXG","errorFringe","No '"+d+"' image of "+e,"mapDataMgr.applyImagePath")}}}else{if(m.data.tiles[e].connect&&m.data.tiles[e].connect.imgs){for(d in m.data.tiles[e].connect.imgs){if(m.data.tiles[e].connect.imgs[d]){if(m.data.tiles[e].connect.imgs[d] instanceof Array){for(c=0;c<m.data.tiles[e].connect.imgs[d].length;c++){m.data.tiles[e].connect.imgs[d][c]=h(m.data.tiles[e].connect.imgs[d][c])}}else{m.data.tiles[e].connect.imgs[d]=h(m.data.tiles[e].connect.imgs[d])}}else{bxg.Trace.log("BXG","errorFringe","No '"+d+"' image of "+e,"mapDataMgr.applyImagePath")}}}}}}}}}return true};bxg.mapDataMgr.load=function(g,e,d){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Call to load a Map Data of "+g,"mapDataMgr.load")}var f;var a=false;if(!(f=bxg.mapDataMgr.get(g))){return false}if(!bxg.imageLoader){bxg.imageLoader=new bxg.CImageLoader({},function(){});bxg.images=bxg.imageLoader.$HO();a=true}if(!a){this.$Hsz=this.$Hsz||new bx.CAsyncSessionManager();if(this.$Hsz.check(g,e,e)){return}}if(d&&d.imagePath){f.data.imagePath=bxg.module.applyPath(bxg.$C9,d.imagePath)}var c;if(!a){if(f.requires){c=c?c.concat(f.requires):f.requires}if(bxg.$B1&&f.editor&&f.editor.requires){c=c?c.concat(f.editor.requires):f.editor.requires}}if(c){bxg.mapDataMgr.$B3(c,b)}else{bxg.mapDataMgr.$B4(g,f,a,e,d)}function b(h,i){bxg.mapDataMgr.$B4(g,f,a,e,d)}return};bxg.mapDataMgr.$B4=function(a,q,m,o,r){if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Call to load a Map Data of "+a+" with "+m,"mapDataMgr.LD0")}if(!m){if(q.onPreLoad){q.onPreLoad()}}var e,c,b,d;var f={};var l=false;function h(j,i){f[q.id+"_"+j]={};f[q.id+"_"+j].url=i;l=true}function n(s,j){var i;for(i=0;i<j.length;i++){f[q.id+"_"+s+"_"+i]={};f[q.id+"_"+s+"_"+i].url=j[i].img;l=true}}bxg.mapDataMgr.applyImagePath(a,q.data.imagePath);if(q.data&&q.data.tiles){for(e in q.data.tiles){if(q.data.tiles[e].tile){if(q.data.tiles[e].tile.img){h(e,q.data.tiles[e].tile.img)}else{if(q.data.tiles[e].tile.set){n(e,q.data.tiles[e].tile.set)}}}else{if(q.data.tiles[e].sprite&&q.data.tiles[e].sprite.img){h(e,q.data.tiles[e].sprite.img)}else{if(q.data.tiles[e].background){if(q.data.tiles[e].background.img){h(e,q.data.tiles[e].background.img)}else{if(q.data.tiles[e].background.set){n(e,q.data.tiles[e].background.set)}}}else{if(q.data.tiles[e].fringe&&q.data.tiles[e].fringe.imgs){for(c in q.data.tiles[e].fringe.imgs){q.data.tiles[e].fringe.$Hsr=q.id+"_"+e;if(q.data.tiles[e].fringe.imgs[c]){if(q.data.tiles[e].fringe.imgs[c] instanceof Array){for(b=0;b<q.data.tiles[e].fringe.imgs[c].length;b++){f[q.id+"_"+e+"_"+c+"_"+b]={};f[q.id+"_"+e+"_"+c+"_"+b].url=q.data.tiles[e].fringe.imgs[c][b];l=true}}else{f[q.id+"_"+e+"_"+c+"_"+0]={};f[q.id+"_"+e+"_"+c+"_"+0].url=q.data.tiles[e].fringe.imgs[c];l=true}}else{bxg.Trace.log("BXG","errorFringe","No '"+c+"' image of "+e,"mapDataMgr.LD0")}}}else{if(q.data.tiles[e].connect&&q.data.tiles[e].connect.imgs){for(c in q.data.tiles[e].connect.imgs){if(q.data.tiles[e].connect.imgs[c]){if(q.data.tiles[e].connect.imgs[c] instanceof Array){for(b=0;b<q.data.tiles[e].connect.imgs[c].length;b++){f[q.id+"_"+e+"_"+c+"_"+b]={};f[q.id+"_"+e+"_"+c+"_"+b].url=q.data.tiles[e].connect.imgs[c][b];l=true}}else{f[q.id+"_"+e+"_"+c+"_"+0]={};f[q.id+"_"+e+"_"+c+"_"+0].url=q.data.tiles[e].connect.imgs[c];l=true}}else{bxg.Trace.log("BXG","errorFringe","No '"+c+"' image of "+e,"mapDataMgr.LD0")}}}}}}}}}if(!m){if(q.objects&&q.objects.length>0){for(e=0;e<q.objects.length;e++){if(typeof q.objects[e]=="string"){if(d=bxg.ObjectFactory.get(q.objects[e])){q.objects[e]=d}else{bxg.Trace.log("BXG","unknownObject",q.objects[e],"mapDataMgr.load");return false}}if(d=bxg.ObjectFactory.$HA(q.objects[e].id)){q.objects[e]=d}else{if(q.objects[e].imagePath&&q.data.imagePath){q.objects[e].imagePath=bxg.module.applyPath(q.data.imagePath,q.objects[e].imagePath)}else{if(!q.objects[e].imagePath&&q.data.imagePath){q.objects[e].imagePath=q.data.imagePath+"/"+q.objects[e].id}}}q.objects[e].$Hd=true;if(bxg.ObjectFactory.register(q.objects[e],false,true)||!q.objects[e].$B5){q.objects[e].$B5=true;if(q.objects[e].images){for(c in q.objects[e].images){f[c]=q.objects[e].images[c];l=true}}}}}}var g=this;function p(i,j){if(!m){if(q.init){q.init()}if(q.onLoad){q.onLoad()}if(q.data.controls){for(var s in q.data.controls){if(q.data.controls[s].control&&q.data.controls[s].control.className){switch(q.data.controls[s].control.className){case"bxg.CPagedScrollLevel":if(!q.data.page||!(q.data.page.h||q.data.page.w)){}else{var k=0;q.data.controls[s].control.config=q.data.controls[s].control.config||{};if(q.data.page.h){k=bxg.CTileMap.$Z24(bxg.CTileMapLevel.$Z25(q.type),q.data.size,0,0,1,q.data.page.h,{});q.data.controls[s].control.config.paneSize=k.h}else{if(q.data.page.w){k=bxg.CTileMap.$Z24(bxg.CTileMapLevel.$Z25(q.type),q.data.size,0,0,q.data.page.w,1,{});q.data.controls[s].control.config.paneSize=k.w}}}break}}}}bxg.mapDataMgr.active=q}if(g.$Hsz){g.$Hsz.dispatch(a,j==0)}else{if(o){o(j==0)}}}if(l){bxg.imageLoader.load(f,function(i,j){p(i,j)})}else{p(0,0)}return};bxg.mapDataMgr.parseObject=function(e){var b=e;var d="/*%%BXG_JSON_START*/";var c="/*%%BXG_JSON_END*/";var a=endPos=-1;a=e.indexOf(d);if(a!=-1){endPos=e.indexOf(c);if(endPos==-1){b=e.substring(a+d.length)}else{b=e.substring(a+d.length,endPos)}}return b};bxg.mapDataMgr.setActive=function(b){var a;if(!(a=bxg.mapDataMgr.get(b))){return null}this.active=a;return a};bxg.mapDataMgr.tileSetRatio=function(d){var a=0;var c=0;var b;for(b=0;b<d.length;b++){d[b].ratio=d[b].ratio||1;a+=d[b].ratio}for(b=0;b<d.length;b++){d[b].$9P=c;c+=d[b].ratio/a}};bxg.mapDataMgr.$Z26=function(c,a,b){if(!c||!c.length){bxg.Trace.log("BXG","emptyArrayError","set","mapDataMgr.TSA");return null}bxg.mapDataMgr.$Z26.$9Q=a||Math.random();bxg.mapDataMgr.$Z26.$9S=0;for(bxg.mapDataMgr.$Z26.$9S=0;bxg.mapDataMgr.$Z26.$9S<c.length;bxg.mapDataMgr.$Z26.$9S++){if(bxg.mapDataMgr.$Z26.$9S==c.length-1||bxg.mapDataMgr.$Z26.$9Q<c[bxg.mapDataMgr.$Z26.$9S+1].$9P){if(b){return""+bxg.mapDataMgr.$Z26.$9S}else{return c[bxg.mapDataMgr.$Z26.$9S].img}}}return null};bxg.mapDataMgr.$B3=function(e,d){bxg.mapDataMgr.$BD=bxg.mapDataMgr.$BD||{};var a=0,b=0;var g=0;function f(h){if(h){a++}else{b++}if(bxg.Trace.logging){bxg.Trace.log("BXG","debug","Loading requires status in (total/succ/fail) = "+g+"/"+a+"/"+b,"mapDataMgr.Requires")}if(a+b>=g){if(d){d(a,b)}}}for(var c=0;c<e.length;c++){if(e[c]&&!bxg.mapDataMgr.$BD[e[c].id]){g++}}if(g==0){if(d){d(0,0)}return}for(c=0;c<g;c++){if(e[c].uri){bxg.module.load(bxg.module.URI,e[c].uri,f,bxg.$C9)}else{bxg.module.load(bxg.module.SHARED,e[c].id,f,bxg.$C9)}}};bxg.mapDataMgr.getMapDataId=function(d){var c=bxg.levels[d];if(!c){bxg.Trace.log("BXG","unknownLevelData",d,"mapDataMgr.getMapDataId");return null}var a;var b;for(var a in c){if(!c[a].idMapData){bxg.Trace.log("BXG","errorLevelData","No idMapData in "+d,"runLevel.getMapDataId");return null}return c[a].idMapData}return null};bxg.CGameLevel=function(a,b){if(bx.inClassing){return}if(a){this.name=a}if(b){this.data=b}this.$Hus=null};bxg.CGameLevel.prototype.create=function(b,a){if(!b){bxg.Trace.log("BXG","errorParameter","cntrl=null","CGameLevel.create");return false}if(this.isCreated()){bxg.Trace.log("BXG","warning","Map is already created","CGameLevel.create");return false}this.$Hus=b;this.data=a||this.data;this.name=this.$Hus.name||this.name;if(this.$Hus.level){this.$Hus.level.unload()}return true};bxg.CGameLevel.prototype.unload=function(){};bxg.CGameLevel.prototype.load=function(){};bxg.CGameLevel.prototype.destroy=function(){if(this.$Hus&&this.$Hus.level==this){this.$Hus.$CG(null)}this.unload();if(this.name){delete this.name}if(this.data){delete this.data}if(this.$Hus){delete this.$Hus}return null};bxg.CGameLevel.prototype.getSize=function(){};bxg.CGameLevel.prototype.isCreated=function(){return false};bxg.CTileMapLevel=function(a,b){if(bx.inClassing){return}this.$CF=null;bxg.CGameLevel.call(this,a,b)};bx.$Inherit(bxg.CTileMapLevel,bxg.CGameLevel);bxg.CTileMapLevel.prototype.createFromFile=function(e,d){if(!d||!e){bxg.Trace.log("BXG","errorParameter","cntrl="+e+", data="+d,"CTileMapLevel.createFromFile");return}if(!d.idLevel||!d.onResult||!d.idControl){bxg.Trace.log("BXG","noProperty","for data, idLevel="+d.idLevel+" ,onResult="+d.onResult+", idControl="+d.idControl,"CTileMapLevel.createFromFile");return}if(this.isCreated()){bxg.Trace.log("BXG","warning","TileMap is already created","CTileMapLevel.createFromFile");d.onResult(false);return}if(e.name&&e.name!=d.idControl){bxg.Trace.log("BXG","warning","Given CControl already has 'name' property and it will be changed to data.idControl="+d.idControl,"CTileMapLevel.createFromFile")}e.name=d.idControl;var b;var g=this;function f(h){if(h&&g.create(e,bxg.levels[d.idLevel][d.idControl])){d.onResult(true)}else{bxg.Trace.log("BXG","error","Cannot load map data of id="+b,"CTileMapLevel.createFromFile");d.onResult(false)}}function a(h){if(h){if(!bxg.levels[d.idLevel][d.idControl]){bxg.Trace.log("BXG","errorLevelData","No control information of control_name="+d.idControl+" in level data="+d.idLevel,"CTileMapLevel.createFromFile");d.onResult(false);return}bxg.mapDataMgr.load(b,f,{imagePath:d.imagePath||"imgs"})}else{bxg.Trace.log("BXG","errorImport","for map id="+b,"CTileMapLevel.createFromFile");d.onResult(false)}}function c(h){if(h){b=bxg.mapDataMgr.getMapDataId(d.idLevel);if(bxg.mapDataMgr.$HA(b)){a(true)}else{bxg.module.load(bxg.module.MAP_DATA,b,a,undefined,true)}}else{bxg.Trace.log("BXG","errorImport","for level id="+d.idLevel,"CTileMapLevel.createFromFile");d.onResult(false)}}if(bxg.levels[d.idLevel]){c(true)}else{bxg.module.load(bxg.module.LEVEL,d.idLevel,c,undefined,true)}};bxg.CTileMapLevel.prototype.unload=function(){if(!this.$Ht0){bxg.Trace.log("BXG","warning","TileMap is not loaded to Control.","CTileMapLevel.unload");return}if(this.isCreated()){this.$CF.$Hur();this.$Ht0=false;return}bxg.Trace.log("BXG","warning","TileMap is not created yet.","CTileMapLevel.unload")};bxg.CTileMapLevel.prototype.load=function(){if(this.$Ht0){bxg.Trace.log("BXG","warning","TileMap is already loaded to Control.","CTileMapLevel.load");return false}if(this.isCreated()){this.$CF.$HtR();this.$Ht0=true;this.$Hs();return true}bxg.Trace.log("BXG","warning","TileMap is not created yet.","CTileMapLevel.load");return false};bxg.CTileMapLevel.prototype.destroy=function(){bxg.CGameLevel.prototype.destroy.call(this);if(this.isCreated()){this.$CF.destroy();delete this.$CF}return null};bxg.CTileMapLevel.prototype.getSize=function(){if(this.isCreated()){return this.$CF.getMapSize()}bxg.Trace.log("BXG","warning","TileMap is not created yet. This will return 'null'","CTileMapLevel.getSize");return null};bxg.CTileMapLevel.prototype.isCreated=function(){return this.$CF?true:false};bxg.CTileMapLevel.prototype.getTileMap=function(){return this.$CF};bxg.CTileMapLevel.$Z25=function(a){switch(a){case"orthogonal":case"tilemap":return bxg.CTileMap.$Z21;case"isometric":return bxg.CTileMap.$Z22;case"hexagonal":case"hexa":return bxg.CTileMap.$Z23;default:bxg.Trace.log("BXG","errorParameter","Unknown map type="+a,"CTileMapLevel.GT");return 0}};bxg.CTileMapLevel.prototype.create=function(f,d){if(!bxg.CGameLevel.prototype.create.call(this,f,d)){return false}var l;if(!(l=bxg.mapDataMgr.get(this.data.idMapData))){bxg.Trace.log("BXG","unknownMapData",this.data.idMapData,"CTileMapLevel.create");return false}if(this.isCreated()){bxg.Trace.log("BXG","warning","This is already created with data of name="+this.name,"CTileMapLevel.create")}else{var d={};var g,k,e;if(l.version){d.$Huq=l.version}d.tileInfo=l.data.tiles;if(!(d.type=bxg.CTileMapLevel.$Z25(l.type))){return false}if(this.data.size&&this.data.size.rows&&this.data.size.cols){d.rows=this.data.size.rows;d.cols=this.data.size.cols}else{d.rows=l.data.rows;d.cols=l.data.cols}d.size=l.data.size;d.layers=bx.$copyObject({},l.data.layers);if(l.data.controls[this.name]){d.perspective=l.data.controls[this.name].perspective;for(e in d.layers){if(!l.data.controls[this.name].layers[e]){delete d.layers[e]}}}else{bxg.Trace.log("BXG","errorMapData","No control information in map data="+this.data.idMapData+" for name="+this.name,"CTileMapLevel.create");return false}function c(n,i){if(!d.tiles){d.tiles={};var m;for(m in d.layers){d.tiles[m]=[]}}g=n;g.coord=n.pos;if(i.obstacle){g.obstacle=i.obstacle}if(i.size){g.size=i.size}if(n.offset&&(n.offset.left==0&&n.offset.top==0)){delete n.offset}g.id=i.id;if(i.fringe){if(d.type==bxg.CTileMap.$Z23){bxg.Trace.log("BXG","errorTile","Fringe tile is not supported yet for hexagonal tilemap.","CTileMapLevel.create");return}g.type=bxg.CTileMap.TYPE_FRINGE;g.fringe=i.fringe;if(i.fringe.imgs&&i.fringe.imgs.n){if(i.fringe.imgs.n instanceof Array){g.img=l.id+"_"+i.id+"_n_"+Math.floor(Math.random()*i.fringe.imgs.n.length)}else{g.img=l.id+"_"+i.id+"_n_0"}}else{bxg.Trace.log("BXG","errorFringe","No 'n' image of "+g.id,"CTileMapLevel.create")}}else{if(i.connect){if(d.type==bxg.CTileMap.$Z23){bxg.Trace.log("BXG","errorTile","Interconnection tile is not supported yet for hexagonal tilemap.","CTileMapLevel.create");return}g.type=bxg.CTileMap.TYPE_TILE;if(i.connect.imgs&&i.connect.imgs[n.fringeData.tile]){if(i.connect.imgs[n.fringeData.tile] instanceof Array){g.img=l.id+"_"+i.id+"_"+n.fringeData.tile+"_"+Math.floor(Math.random()*i.connect.imgs[n.fringeData.tile].length)}else{g.img=l.id+"_"+i.id+"_"+n.fringeData.tile+"_0"}}else{bxg.Trace.log("BXG","errorFringe","No '"+n.fringeData.tile+"' image of "+g.id,"CTileMapLevel.create")}g.object=i.connect.object;g.rotate=n.fringeData.angle}else{if(i.tile){if(i.tile.set){g.img=l.id+"_"+i.id+"_"+n.fringeData.tile}else{g.img=l.id+"_"+i.id}g.object=i.tile.object;g.type=bxg.CTileMap.TYPE_TILE}else{if(i.bxg$systemTile){g.type=bxg.CTileMap.TYPE_TILE;g.img=null}else{bxg.Trace.log("BXG","errorTile","Missed mandatory tile information, tile id="+i.id,"CTileMapLevel.create");bxg.Trace.data(i);return}}}}d.tiles[i.layer].push(g)}function h(n,i){if(!d.tiles){d.tiles={};var m;for(m in d.layers){d.tiles[m]=[]}}g={};if(i.object.npc){g.type=bxg.CTileMap.TYPE_NPC}else{g.type=bxg.CTileMap.TYPE_OBJECT;if(i.obstacle){g.obstacle=i.obstacle}}if(i.object.activate=="onCreate"){g.activate=bxg.CTileMap.ACTIVATE_ON_CREATE}else{if(i.object.activate=="onShow"){g.activate=bxg.CTileMap.ACTIVATE_ON_SHOW}else{if(i.object.activate=="onLogic"){g.activate=bxg.CTileMap.ACTIVATE_ON_LOGIC}else{if(typeof i.object.activate=="object"){if(i.object.activate.type=="onMark"){g.activate=bxg.CTileMap.ACTIVATE_ON_MARK;g.activateData=i.object.activate}}}}}g.coord=n.pos;if(i.size){g.size=i.size}if(n.offset&&(n.offset.left||n.offset.top)){g.offset=n.offset}g.id=i.object.id;if(i.object.configure){g.config=g.config||{};bx.$copyObject(g.config,i.object.configure())}else{if(i.object.config){g.config=g.config||{};bx.$copyObject(g.config,i.object.config)}}if(n.config){g.config=g.config||{};bx.$copyObject(g.config,n.config)}d.tiles[i.layer].push(g)}function b(n,i){if(!d.sprites){d.sprites={};var m;for(m in d.layers){d.sprites[m]=[]}}k={};k.coord={x:n.pos.x,y:n.pos.y};k.offset=n.offset;k.img=l.id+"_"+i.id;if(n.geo){k.$9W=n.geo.size;k.$2G=n.geo.zIndex;k.rotate=n.geo.rotate}d.sprites[i.layer].push(k)}function j(n,i){if(!d.$CH){d.$CH={};var m;for(m in d.layers){d.$CH[m]=[]}}item={};item.coord={x:n.pos.x,y:n.pos.y};item.data=i.bxg$system;d.$CH[i.layer].push(item)}var a;for(e=0;e<this.data.tiles.length;e++){a=l.data.tiles[this.data.tiles[e].idTileData];if(!a){bxg.Trace.log("BXG","unknownTile",this.data.tiles[e].idTileData,"CTileMapLevel.create");continue}if(!d.layers[a.layer]){bxg.Trace.log("BXG","errorTile","layer of "+this.data.tiles[e].idTileData,"CTileMapLevel.create");continue}if(a.object){h(this.data.tiles[e],a)}else{if(a.sprite){b(this.data.tiles[e],a)}else{if(a.bxg$system){j(this.data.tiles[e],a)}else{c(this.data.tiles[e],a)}}}}if(this.data.background&&l.data.tiles[this.data.background]){d.background={img:l.id+"_"+this.data.background}}d.playLayer=this.data.playLayer;this.$CF=new bxg.CTileMap(this.$Hus,d,bxg.CTileMapLevel.$Huz);this.$CF.create()}this.$Hus.$CG(this);return true};bxg.CTileMapLevel.$Huz=function(d,c,a){var b;if(a.config){b=b||{};bx.$copyObject(b,a.config)}if(bxg.ObjectFactory.$HA(a.id).factory){return bxg.ObjectFactory.build(a.id,undefined,undefined,b)}else{return bxg.ObjectFactory.build(a.id,a.options,b)}};bxg.CTileMapLevel.prototype.$Hs=function(){if(this.isCreated()&&this.$Ht0){return this.$CF.$Hsc(-this.$Hus.scrollPos.x,-this.$Hus.scrollPos.y,this.$Hus.area.w,this.$Hus.area.h)}};bxg.CSimpleTileMapLevel=function(){if(bx.inClassing){return}this.$CF=null;bxg.CGameLevel.call(this)};bx.$Inherit(bxg.CSimpleTileMapLevel,bxg.CGameLevel);bxg.CSimpleTileMapLevel.prototype.create=function(c,b){if(!bxg.CGameLevel.prototype.create.call(this,c,b)){return false}if(this.isCreated(this)){bxg.Trace.log("BXG","warning","This is already created with data of name="+this.name,"CTileMapLevel.create")}else{var a={};a.tileInfo={};if(!(a.type=bxg.CTileMapLevel.$Z25(b.type))){return false}a.$Huq=2;a.rows=b.rows;a.cols=b.cols;a.size=b.size;a.layers={base:{}};a.perspective=b.perspective;a.tiles={base:[]};this.$CF=new bxg.CTileMap(this.$Hus,a,bxg.CTileMapLevel.$Huz);this.$CF.create()}this.$Hus.$CG(this);return true};bxg.CSimpleTileMapLevel.prototype.unload=bxg.CTileMapLevel.prototype.unload;bxg.CSimpleTileMapLevel.prototype.load=bxg.CTileMapLevel.prototype.load;bxg.CSimpleTileMapLevel.prototype.destroy=bxg.CTileMapLevel.prototype.destroy;bxg.CSimpleTileMapLevel.prototype.getSize=bxg.CTileMapLevel.prototype.getSize;bxg.CSimpleTileMapLevel.prototype.isCreated=bxg.CTileMapLevel.prototype.isCreated;bxg.CSimpleTileMapLevel.prototype.getTileMap=bxg.CTileMapLevel.prototype.getTileMap;bxg.CSimpleTileMapLevel.prototype.$Hs=bxg.CTileMapLevel.prototype.$Hs;if(bxg.$Hp){bxg.CGameLevel.prototype.deactivate=bxg.CGameLevel.prototype.unload;bxg.CGameLevel.prototype.activate=bxg.CGameLevel.prototype.load;bxg.CLevelMapTile=bxg.CTileMapLevel;bxg.CTileMapLevel.prototype.getMap=bxg.CTileMapLevel.prototype.getTileMap;bxg.CTileMapLevel.prototype.activate=bxg.CTileMapLevel.prototype.load;bxg.CTileMapLevel.prototype.deactivate=bxg.CTileMapLevel.prototype.unload}bxg.CMiniMap=function(a){this.$9l=a||{};this.tag=undefined};bxg.CMiniMap.prototype.create=function(){if(!bxg.world){bxg.Trace.log("BXG","error","BXG needs to be initialized before this call.","CMiniMap.create");return this}if(!(bxg.$9I&bxg.$E8)){bxg.Trace.log("BXG","errorRenderer","CMiniMap","CMiniMap.create");return this}if((!this.$9l.width&&!this.$9l.height)||!this.$9l.control){bxg.Trace.log("BXG","errorParameter","Mandatory properties are missing in CMiniMap option","CMiniMap.create");bxg.Trace.data(this.$9l)}this.tag=bxg.world.$TAG("CANVAS",{},{position:"absolute",display:"none"});this.$9m={};this.$9n={};return this};bxg.CMiniMap.prototype.render=function(){if(!this.$3K){return}if(!this.tag){bxg.Trace.log("BXG","error","BXG needs to be initialized before this call.","CMiniMap.create");return}this.$6G=false;if(!this.$9o){this.$6G=true}if(this.$9o&&(this.$9o.w!=this.$9l.control.area.w||this.$9o.h!=this.$9l.control.area.h)){this.$6G=true}if(this.$9p&&(this.$9p.w!=this.$9l.control.scrollSize.w||this.$9p.h!=this.$9l.control.scrollSize.h)){this.$6G=true}if(this.$6G){if(this.$9l.width){this.$9n.w=this.$9l.width;this.$9P=this.$9l.width/this.$9l.control.scrollSize.w;this.$9n.h=Math.floor(this.$9l.control.scrollSize.h*this.$9P)}else{this.$9n.w=Math.floor(this.$9l.control.scrollSize.w*this.$9P);this.$9P=this.$9l.height/this.$9l.control.scrollSize.h;this.$9n.h=this.$9l.height}this.$9m.w=Math.floor(this.$9l.control.area.w*this.$9P);this.$9m.h=Math.floor(this.$9l.control.area.h*this.$9P);this.tag.style.width=this.$9n.w+"px";this.tag.style.height=this.$9n.h+"px";if(this.tag.tagName=="CANVAS"){this.tag.width=this.$9n.w;this.tag.height=this.$9n.h}}this.$9q=this.$9q||this.tag.getContext("2d");this.$9q.lineWidth=1;this.$9q.clearRect(0,0,this.tag.width,this.tag.height);if(this.$9r=this.$9l.control.$EM.$8d()){if(this.$9l.map&&this.$9l.map.opacity){this.$9q.globalAlpha=this.$9l.map.opacity}this.$9q.drawImage(this.$9r,0,0,this.$9r.width,this.$9r.height,0,0,this.$9q.canvas.width,this.$9q.canvas.height);this.$9q.globalAlpha=1}else{if(this.$9l.map){if(this.$9l.map.opacity){this.$9q.globalAlpha=this.$9l.map.opacity}if(this.$9l.map.fillStyle){this.$9q.fillStyle=this.$9l.map.fillStyle;this.$9q.fillRect(0,0,this.$9q.canvas.width,this.$9q.canvas.height)}this.$9q.globalAlpha=1}}if(this.$9l.objects){for(this.$GY in this.$9l.control.$67){this.$6i=this.$9l.control.$67[this.$GY];if(this.$6i.type&&this.$9l.objects[this.$6i.type]&&this.$6i.active&&this.$6i.$3K){if(this.$9l.objects[this.$6i.type].borderStyle){this.$9q.strokeStyle=this.$9l.objects[this.$6i.type].borderStyle;if(this.$9l.objects[this.$6i.type].shape=="circle"){this.$9q.beginPath();this.$9q.arc(this.$6i.center().x*this.$9P,this.$6i.center().y*this.$9P,Math.min((this.$6i.size.w/2)*this.$9P,(this.$6i.size.h/2)*this.$9P),0,Math.PI*2,true);this.$9q.closePath();this.$9q.stroke()}else{this.$9q.strokeRect(this.$6i.position().x*this.$9P,this.$6i.position().y*this.$9P,this.$6i.size.w*this.$9P,this.$6i.size.h*this.$9P)}}}}}if(this.$9l.view){if(this.$9l.view.opacity){this.$9q.globalAlpha=this.$9l.view.opacity}if(this.$9l.view.fillStyle){this.$9q.fillStyle=this.$9l.view.fillStyle;this.$9q.fillRect(-this.$9l.control.scrollPos.x*this.$9P,-this.$9l.control.scrollPos.y*this.$9P,this.$9m.w,this.$9m.h)}if(this.$9l.view.borderStyle){this.$9q.strokeStyle=this.$9l.view.borderStyle;this.$9q.strokeRect(-this.$9l.control.scrollPos.x*this.$9P,-this.$9l.control.scrollPos.y*this.$9P,this.$9m.w,this.$9m.h)}this.$9q.globalAlpha=1}this.$9o=this.$9o||{};this.$9o.w=this.$9l.control.area.w;this.$9o.h=this.$9l.control.area.h;this.$9p=this.$9p||{};this.$9p.w=this.$9l.control.scrollSize.w;this.$9p.h=this.$9l.control.scrollSize.h};bxg.CMiniMap.prototype.show=function(){if(this.tag){this.$3K=true;this.tag.style.display="block"}};bxg.CMiniMap.prototype.hide=function(){if(this.tag){this.$3K=false;this.tag.style.display="none"}};
"Release date: 01/10/2013 10:42:59"